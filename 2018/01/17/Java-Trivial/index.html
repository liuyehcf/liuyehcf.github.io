<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="阅读更多">
<meta property="og:type" content="article">
<meta property="og:title" content="Java-Trivial">
<meta property="og:url" content="http://example.com/2018/01/17/Java-Trivial/index.html">
<meta property="og:site_name" content="Liuye Notebook">
<meta property="og:description" content="阅读更多">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-01-17T01:30:44.000Z">
<meta property="article:modified_time" content="2025-04-03T15:30:58.000Z">
<meta property="article:author" content="Liuyehcf">
<meta property="article:tag" content="摘录">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2018/01/17/Java-Trivial/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Java-Trivial | Liuye Notebook</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Liuye Notebook</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-explore">

    <a href="/explore/" rel="section"><i class="fa fa-sitemap fa-fw"></i>发现</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/01/17/Java-Trivial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Liuyehcf">
      <meta itemprop="description" content="大音希声，大象无形">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liuye Notebook">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Java-Trivial
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-17 09:30:44" itemprop="dateCreated datePublished" datetime="2018-01-17T09:30:44+08:00">2018-01-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-03 23:30:58" itemprop="dateModified" datetime="2025-04-03T23:30:58+08:00">2025-04-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Java-Virtual-Machine/" itemprop="url" rel="index"><span itemprop="name">Java Virtual Machine</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Java-Virtual-Machine/Command-Line-Tool/" itemprop="url" rel="index"><span itemprop="name">Command Line Tool</span></a>
                </span>
            </span>

          
            <span id="/2018/01/17/Java-Trivial/" class="post-meta-item leancloud_visitors" data-flag-title="Java-Trivial" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/01/17/Java-Trivial/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/01/17/Java-Trivial/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><strong>阅读更多</strong></p>
<span id="more"></span>
<h1 id="1-install-jdk"><a class="markdownIt-Anchor" href="#1-install-jdk"></a> 1 Install JDK</h1>
<p>From <a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/downloads/">Java Downloads</a>, you can find <code>JDK 22</code>, <code>JDK 21</code>, <code>JDK 17</code>, and even <code>JDK 8</code></p>
<ul>
<li>
<p>For <code>JDK 8</code></p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># you need to login in first, can you can download, it is stupid</span></span><br><span class="line">tar -zxvf jdk-8u411-linux-x64.tar.gz -C /usr/lib/jvm</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>For <code>JDK 17</code></p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.tar.gz</span><br><span class="line">tar -zxvf jdk-17_linux-x64_bin.tar.gz -C /usr/lib/jvm</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>For <code>JDK 22</code></p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.oracle.com/java/22/latest/jdk-22_linux-x64_bin.tar.gz</span><br><span class="line">tar -zxvf jdk-22_linux-x64_bin.tar.gz -C /usr/lib/jvm</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://jdk.java.net/archive/">Archived OpenJDK General-Availability Releases</a></p>
<h1 id="2-builtin"><a class="markdownIt-Anchor" href="#2-builtin"></a> 2 Builtin</h1>
<h2 id="21-java"><a class="markdownIt-Anchor" href="#21-java"></a> 2.1 java</h2>
<h3 id="211-execute"><a class="markdownIt-Anchor" href="#211-execute"></a> 2.1.1 Execute</h3>
<p><strong>Use <code>-classpath</code> Options:</strong></p>
<ul>
<li><code>java -classpath /path/aaa.jar com.liuyehcf.demo.MyMain arg1 arg2</code></li>
<li><code>java -classpath /path/aaa.jar:/path/bbb.jar com.liuyehcf.demo.MyMain arg1 arg2</code></li>
<li><code>java -classpath &quot;/path/*&quot; com.liuyehcf.demo.MyMain arg1 arg2</code></li>
<li><code>java -classpath &quot;/path/*&quot;:&quot;/path2/*&quot; com.liuyehcf.demo.MyMain arg1 arg2</code></li>
</ul>
<p><strong>Use <code>-jar</code>: The jar file must has record Main class in <code>META-INF/MANIFEST.MF</code></strong></p>
<ul>
<li><code>java -jar /path/aaa.jar arg1 arg2</code></li>
</ul>
<p><strong>Use <code>-Djava.ext.dirs=</code> Options:</strong></p>
<ul>
<li><code>java -Djava.ext.dirs=/path/jar_dir/ com.liuyehcf.demo.MyMain arg1 arg2</code></li>
</ul>
<h3 id="212-enable-debug"><a class="markdownIt-Anchor" href="#212-enable-debug"></a> 2.1.2 Enable Debug</h3>
<p><strong>Java 1.4 及更早版本: <code>-Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=*:8000,suspend=n</code></strong></p>
<ul>
<li><code>-Xrunjdwp</code>：启动<code>JDWP, Java debug wire protocol</code>调试器</li>
<li><code>transport=dt_socket</code>：使用套接字作为传输方式</li>
<li><code>server=y</code>：作为调试服务器运行</li>
<li><code>address=*:8000</code>：在所有网络接口上监听<code>8000</code>端口。同<code>0.0.0.0</code>
<ul>
<li><code>8000</code></li>
<li><code>127.0.0.1:8000</code></li>
<li><code>0.0.0.0:8000</code></li>
</ul>
</li>
<li><code>suspend=n</code>：<code>JVM</code>启动后不挂起，立即运行</li>
</ul>
<p><strong>Java 1.5 (JDK 5): <code>-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:8000</code></strong></p>
<ul>
<li><code>-agentlib:jdwp</code>：使用<code>jdwp</code>库启动<code>JDWP</code>调试器，且不需要额外指定<code>-Xdebug</code></li>
<li><code>transport=dt_socket</code>：使用套接字作为传输方式</li>
<li><code>server=y</code>：作为调试服务器运行</li>
<li><code>suspend=n</code>：<code>JVM</code>启动后不挂起，立即运行</li>
<li><code>address=*:8000</code>：在所有网络接口上监听<code>8000</code>端口。同<code>0.0.0.0</code></li>
</ul>
<h2 id="22-jps"><a class="markdownIt-Anchor" href="#22-jps"></a> 2.2 jps</h2>
<p>列出正在运行的虚拟机进程，并显示虚拟机执行主类名称以及这些进程的<strong>本地虚拟机唯一<code>ID(Local Virtual Machine Identifier, LVMID)</code></strong></p>
<p>虽然功能比较单一，但它是使用频率最高的<code>JDK</code>命令行工具，因为其他<code>JDK</code>工具大多需要输入它查询到的<code>LVMID</code>来确定要监控的是哪一个虚拟机进程</p>
<p><strong>对本地虚拟机来说，<code>LVMID</code>与操作系统的进程<code>ID(Process Identifier，PID)</code>是一致的</strong>，使用<code>Windows</code>的任务管理器或者<code>UNIX</code>的<code>ps</code>命令也可以查询到虚拟机进程的<code>LVMID</code>，如果同时启动了多个虚拟机进程，无法根据进程名称定位时，就只能依赖<code>jps</code>命令显示主类的功能才能区分了</p>
<p><strong>格式：</strong></p>
<ul>
<li><code>jps [options] [hostid]</code></li>
</ul>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>-q</code>：只输出<code>LVMID</code>，省略主类的名称</li>
<li><code>-m</code>：输出虚拟机进程启动时传递给主类<code>main()</code>函数的参数</li>
<li><code>-l</code>：输出主类的全名，如果进程执行的是<code>Jar</code>包，输出<code>Jar</code>路径</li>
<li><code>-v</code>：输出虚拟机进程启动时的<code>JVM</code>参数</li>
</ul>
<h2 id="23-jstat"><a class="markdownIt-Anchor" href="#23-jstat"></a> 2.3 jstat</h2>
<p><code>jstat(JVM Statistics Monitoring Tool)</code>是用于监视虚拟机各种运行状态信息的命令行工具</p>
<p><code>jstat</code>可以显示本地或者远程虚拟机进程中的类装载、内存、垃圾收集、<code>JIT</code>编译等运行数据，在没有<code>GUI</code>图形界面，只提供了纯文本控制台环境的服务器上，它将是运行期定位虚拟机性能问题的首选工具</p>
<p><strong>格式：</strong></p>
<ul>
<li><code>jstat [option &lt;vmid&gt; [interval [s|ms] [count] ] ]</code></li>
</ul>
<p><strong>参数说明：</strong></p>
<ul>
<li>如果是本地虚拟机进程，<code>VMID</code>与<code>LVMID</code>是一致的，如果是远程虚拟机进程，那<code>VMID</code>的格式应当是
<ul>
<li><code>[protocol:] [//] lvmid [@hostname[:port]/servername]</code></li>
</ul>
</li>
<li><code>interval</code>和<code>count</code>代表查询间隔和次数，如果省略这两个参数，说明只查询一次
<ul>
<li><code>jstat -gc 2764 250 20</code>：每<code>250</code>毫秒查询一次进程<code>2764</code>垃圾收集情况，一共查询<code>20</code>次</li>
</ul>
</li>
<li><code>-class</code>：监视类装载、卸载数量、总空间以及类装载所耗费的时间</li>
<li><code>-gc</code>：监视<code>Java</code>堆状况，包括<code>Eden</code>区、两个<code>survivor</code>区、老年代、永久代等的容量、已用空间、<code>GC</code>时间合计等信息</li>
<li><code>-gccapacity</code>：监视内容与<code>-gc</code>基本相同，但输出主要关注<code>Java</code>堆各个区域使用到的最大、最小空间</li>
<li><code>-gcutil</code>：监视内容与<code>-gc</code>基本相同，但输出主要关注已使用空间占总空间的百分比</li>
<li><code>-gccause</code>：与<code>-gcutil</code>功能一样，但是会额外输出导致上一次<code>GC</code>产生的原因</li>
<li><code>-gcnew</code>：监视新生代<code>GC</code>状况</li>
<li><code>-gcnewcapacity</code>：监视内容与<code>-gcnew</code>基本相同，输出主要关注使用到的最大、最小空间</li>
<li><code>-gcold</code>：监视老年代<code>GC</code>状况</li>
<li><code>-gcoldcapacity</code>：监视内容与<code>-gcold</code>基本相同，输出主要关注使用到的最大、最小空间</li>
<li><code>-gcpermcapacity</code>：输出永久代使用到的最大、最小空间</li>
<li><code>-compiler</code>：输出<code>JIT</code>编译器编译过的方法、耗时等信息</li>
<li><code>-printcompilation</code>：输出已经被<code>JIT</code>编译的方法</li>
</ul>
<p><strong>输出内容意义：</strong></p>
<ul>
<li><code>E</code>：新生代区<code>Eden</code></li>
<li><code>S0\S1</code>：<code>Survivor0</code>、<code>Survivor1</code>这两个<code>Survivor</code>区</li>
<li><code>O</code>：老年代<code>Old</code></li>
<li><code>P</code>：永久代<code>Permanet</code></li>
<li><code>YGC</code>：<code>Young GC</code></li>
<li><code>YGCT</code>：<code>Yount GC Time</code></li>
<li><code>FGC</code>：<code>Full GC</code></li>
<li><code>FTCG</code>：<code>Full GC Time</code></li>
<li><code>GCT</code>：<code>Minor GC</code>与<code>Full GC</code>总耗时</li>
</ul>
<p><strong>示例：</strong></p>
<ul>
<li><strong><code>jstat -gc &lt;vmid&gt; 1000 1000</code>：查看<code>JVM</code>内存使用</strong></li>
<li><strong><code>jstat -gcutil &lt;vmid&gt; 1000 1000</code>：查看<code>JVM</code>内存使用（百分比）</strong></li>
</ul>
<h2 id="24-jinfo"><a class="markdownIt-Anchor" href="#24-jinfo"></a> 2.4 jinfo</h2>
<p><code>jinfo(Configuration Info for Java)</code>的作用是实时地查看和调整虚拟机各项参数</p>
<p>使用<code>jps</code>命令的<code>-v</code>参数可以查看虚拟机启动时显示指定的参数列表，<strong>但如果想知道未被显式指定的参数的系统默认值，除了去查找资料外，就只能用<code>jinfo</code>的<code>-flag</code>选项进行查询</strong></p>
<p>如果<code>JDK1.6</code>或者以上版本，可以使用<code>-XX:+PrintFlagsFinal</code>查看参数默认值</p>
<p><code>jinfo</code>还可以使用<code>-sysprops</code>选项把虚拟机进程的<code>System.getProperties()</code>的内容打印出来</p>
<p><strong>格式：</strong></p>
<ul>
<li><code>jinfo [option] &lt;vmid&gt;</code></li>
</ul>
<p><strong>参数说明</strong></p>
<ul>
<li><code>-flag</code>：显式默认值
<ul>
<li><code>jinfo -flags 1874</code>：显式所有项的默认值</li>
<li><code>jinfo -flag CICompilerCount 1874</code>：显示指定项的默认值</li>
</ul>
</li>
<li><code>-sysprops</code>：把虚拟机进程的System.getProperties()的内容打印出来</li>
</ul>
<h2 id="25-jmap"><a class="markdownIt-Anchor" href="#25-jmap"></a> 2.5 jmap</h2>
<p><code>jmap(Memory Map for Java)</code>命令用于生成堆转储快照(一般称为<code>heapdump</code>或<code>dump</code>文件)</p>
<p><code>jmap</code>的作用并不仅仅为了获取<code>dump</code>文件，它还可以查询<code>finalize</code>执行队列、<code>Java</code>堆和永久代的详细信息，如空间使用率、当前用的是哪种收集器等</p>
<p><strong>格式：</strong></p>
<ul>
<li><code>jmap [option] &lt;vmid&gt;</code></li>
</ul>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>-dump</code>：生成Java堆转储快照，格式为<code>-dump:[live, ]format=b, file=&lt;filename&gt;</code>，其中<code>live</code>子参数说明是否只<code>dump</code>出存活对象</li>
<li><code>-finalizerinfo</code>：显示在<code>F-Queue</code>中等待<code>Finalizer</code>线程执行<code>finalize</code>方法的对象</li>
<li><code>-heap</code>：显示<code>Java</code>堆详细信息，如使用哪种回收器，参数配置，分代状况等</li>
<li><code>-histo</code>：显示堆中对象统计信息，包括类、实例数量、合计容量</li>
<li><code>-permstat</code>：以<code>ClassLoader</code>为统计口径显示永久代内存状态</li>
<li><code>-F</code>：当虚拟机进程对<code>-dump</code>选项没有响应时，可使用这个选项强制生成<code>dump</code>快照</li>
</ul>
<p><strong>示例</strong></p>
<ul>
<li><code>jmap -dump:format=b,file=&lt;dump_文件名&gt; &lt;java进程号&gt;</code>：<code>dump</code>进程所有对象的堆栈</li>
<li><code>jmap -dump:live,format=b,file=&lt;dump_文件名&gt; &lt;java进程号&gt;</code>：<code>dump</code>进程中存活对象的堆栈，会触发<code>full gc</code></li>
<li><code>jmap -histo:live &lt;vmid&gt;</code>：触发<code>full gc</code></li>
<li><code>jmap -histo &lt;vmid&gt; | sort -k 2 -g -r | less</code>：统计堆栈中对象的内存信息，按照对象实例个数降序打印</li>
<li><code>jmap -histo &lt;vmid&gt; | sort -k 3 -g -r | less</code>：统计堆栈中对象的内存信息，按照对象占用内存大小降序打印</li>
</ul>
<h2 id="26-jhat"><a class="markdownIt-Anchor" href="#26-jhat"></a> 2.6 jhat</h2>
<p><code>jhat</code>是虚拟机堆转储快照分析工具</p>
<p><code>Sun JDK</code>提供<code>jhat(JVM Heap Analysis Tool)</code>命令与<code>jmap</code>搭配使用，来分析<code>jmap</code>生成的堆转储快照</p>
<p><code>jhat</code>内置了一个微型的<code>HTTP/HTML</code>服务器，生成<code>dump</code>文件的分析结果后，可以在浏览器中查看</p>
<p>不过在实际工作中，除非真的没有别的工具可用，否则一般不会直接使用<code>jhat</code>命令来分析<code>dump</code>文件，原因如下</p>
<ul>
<li>一般不会再部署应用程序的服务器上直接分析<code>dump</code>文件，即使可以这样做，也会尽量将<code>dump</code>文件复制到其他机器上进行分析，因为分析工作是一个耗时而且消耗硬件资源的过程，既然都要在其他机器上进行，就没有必要受到命令工具的限制了</li>
<li><code>jhat</code>的分析功能相对来说比较简陋，<code>VisualVM</code>，以及专业用于分析<code>dump</code>文件的<code>Eclipse Memory Analyzer</code>、<code>IBM HeapAnalyzer</code>等工具，都能实现比<code>jhat</code>更强大更专业的分析功能</li>
</ul>
<p><strong>配合jmap的例子</strong></p>
<ol>
<li><code>jmap -dump:format=b,file=dump.bin 1874</code>
<ul>
<li>文件相对路径为<code>dump.bin</code></li>
<li><code>vmid</code>为1874</li>
</ul>
</li>
<li><code>jhat dump.bin</code>
<ul>
<li>在接下来的输出中会指定端口<code>7000</code></li>
<li>在浏览器中键入<code>http://localhost:7000/</code>就可以看到分析结果，拉到最下面，包含如下导航：
<ul>
<li>All classes including platform</li>
<li>Show all members of the rootset</li>
<li>Show instance counts for all classes (including platform)</li>
<li>Show instance counts for all classes (excluding platform)</li>
<li>Show heap histogram</li>
<li>Show finalizer summary</li>
<li>Execute Object Query Language (OQL) query</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="27-jstack"><a class="markdownIt-Anchor" href="#27-jstack"></a> 2.7 jstack</h2>
<p><code>jstack</code>是<code>Java</code>堆栈跟踪工具</p>
<p><code>jstack(Stack Trace for Java)</code>命令用于生成虚拟机当前时刻的线程快照(一般称为<code>trheaddump</code>或者<code>javacore</code>文件)</p>
<p>线程快照就是当前虚拟机每一条线程正在执行的方法堆栈的集合，生成线程快照的主要目的是定位线程出现长时间停顿的原因，如线程死锁、死循环、请求外部资源导致的长时间等待都是导致线程长时间停顿的常见原因</p>
<p>线程出现停顿的时候通过<code>jstack</code>来查看各个线程的调用堆栈，就可以知道没有响应的线程到底在后台做了什么，或者等待什么资源</p>
<p><strong>格式：</strong></p>
<ul>
<li><code>jstack [option] &lt;vmid&gt;</code></li>
</ul>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>-F</code>：当正常输出的请求不被响应时，强制输出线程堆栈</li>
<li><code>-l</code>：除堆栈外，显示关于锁的附加信息</li>
<li><code>-m</code>：如果调用本地方法的话，可以显示C/C++的堆栈</li>
</ul>
<p><strong>在JDK1.5中，java.lang.Thread类新增一个getAllStackTraces()方法用于获取虚拟机中所有线程的StackTraceElement对象，使用这个对象可以通过简单的几行代码就能完成jstack的大部分功能，在实际项目中不妨调用这个方法做个管理员页面，可以随时使用浏览器来查看线程堆栈</strong></p>
<h2 id="28-java_home"><a class="markdownIt-Anchor" href="#28-java_home"></a> 2.8 java_home</h2>
<p><strong><code>/usr/libexec/java_home -V</code>：用于查看本机上所有版本java的安装目录</strong></p>
<h2 id="29-jar"><a class="markdownIt-Anchor" href="#29-jar"></a> 2.9 jar</h2>
<p><strong>Creating an archive file: <code>jar cvf xxx.jar -C $&#123;target_dir1&#125; $&#123;dir_or_file1&#125; -C $&#123;target_dir2&#125; $&#123;dir_or_file2&#125; ...</code></strong></p>
<ul>
<li><strong>Note that <code>-C</code> only applies to the argument immediately following it</strong></li>
<li><code>jar cvf xxx.jar .</code></li>
<li><code>jar cvf xxx.jar org com/test/A.class</code></li>
<li><code>jar cvf xxx.jar -C classes org -C classes com</code></li>
</ul>
<p><strong>Extracting an archive file: <code>jar xvf xxx.jar</code></strong></p>
<ul>
<li><code>jar xvf /path/xxx.jar</code></li>
<li><code>jar xvf /path/xxx.jar xxx.class</code></li>
</ul>
<p><strong>Viewing an archive file: <code>jar tf xxx.jar</code></strong></p>
<h3 id="291-jar-file-specification"><a class="markdownIt-Anchor" href="#291-jar-file-specification"></a> 2.9.1 JAR File Specification</h3>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/17/docs/specs/jar/jar.html">JAR File Specification</a></p>
<ul>
<li>The META-INF directory
<ul>
<li><code>service</code>: Service Provider Interface, SPI</li>
<li><code>MANIFEST.MF</code>: Main-Class</li>
</ul>
</li>
<li>…</li>
</ul>
<h2 id="210-jdb"><a class="markdownIt-Anchor" href="#210-jdb"></a> 2.10 jdb</h2>
<p>Debug tool like <code>gdb</code></p>
<h1 id="3-monitor"><a class="markdownIt-Anchor" href="#3-monitor"></a> 3 Monitor</h1>
<h2 id="31-arthas"><a class="markdownIt-Anchor" href="#31-arthas"></a> 3.1 Arthas</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas">Arthas</a></p>
<p><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/commands.html">commands</a></p>
<h2 id="32-visualvm"><a class="markdownIt-Anchor" href="#32-visualvm"></a> 3.2 VisualVM</h2>
<p><a target="_blank" rel="noopener" href="https://visualvm.github.io/">All-in-One Java Troubleshooting Tool</a></p>
<h3 id="321-shallow-size-vs-retained-size"><a class="markdownIt-Anchor" href="#321-shallow-size-vs-retained-size"></a> 3.2.1 Shallow Size vs. Retained Size</h3>
<p><code>Shallow Size</code>: This is the amount of memory allocated to store the object itself, not including the objects it references. This includes the memory used by the object’s fields (for primitive types) and the memory used to store the references to other objects (for reference types). It does not include the memory used by the objects those references point to. Tools like VisualVM generally show the shallow size by default.</p>
<p><code>Retained Size</code>: This is the total amount of memory that would be freed if the object were garbage collected. This includes the shallow size of the object itself plus the shallow size of any objects that are exclusively referenced by this object (i.e., objects that would be garbage collected if this object were). The retained size provides a more complete picture of the “true” memory impact of an object but can be more complex to calculate. Some profiling tools provide this information, but it may require additional analysis or plugins.</p>
<h1 id="4-java-decompiler"><a class="markdownIt-Anchor" href="#4-java-decompiler"></a> 4 Java Decompiler</h1>
<p><a target="_blank" rel="noopener" href="http://www.javadecompilers.com/">Java Decompilers</a></p>
<h2 id="41-cfr"><a class="markdownIt-Anchor" href="#41-cfr"></a> 4.1 CFR</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/leibnitz27/cfr">Class File Reader, CFR</a>: Another Java Decompiler, it will decompile modern Java features - including much of Java <code>9</code>, <code>12</code> &amp; <code>14</code>, but is written entirely in Java <code>6</code>, so will work anywhere!</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/leibnitz27/cfr/releases/download/0.152/cfr-0.152.jar</span><br><span class="line">java -jar cfr-0.152.jar xxx.class</span><br></pre></td></tr></table></figure>
<h2 id="42-jd"><a class="markdownIt-Anchor" href="#42-jd"></a> 4.2 JD</h2>
<p><a target="_blank" rel="noopener" href="http://java-decompiler.github.io/">Java Decompiler project, JD Project</a>: Aims to develop tools in order to decompile and analyze Java 5 “byte code” and the later versions.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/java-decompiler/jd-gui/releases/download/v1.6.6/jd-gui-1.6.6.jar</span><br><span class="line">java -jar jd-gui-1.6.6.jar</span><br></pre></td></tr></table></figure>
<h2 id="43-jad"><a class="markdownIt-Anchor" href="#43-jad"></a> 4.3 JAD</h2>
<p><a target="_blank" rel="noopener" href="http://www.javadecompilers.com/jad">JAD</a>: It is dead, and yes, it was not Open Source anyway。</p>
<h2 id="44-fernflower"><a class="markdownIt-Anchor" href="#44-fernflower"></a> 4.4 Fernflower</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/JetBrains/intellij-community/tree/master/plugins/java-decompiler/engine">Fernflower</a>: The first actually working analytical decompiler for Java and probably for a high-level programming language in general.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/fesh0r/fernflower">Unofficial mirror of FernFlower</a></li>
<li>Requires Java version &gt;= 17</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/fesh0r/fernflower.git</span><br><span class="line"><span class="built_in">cd</span> fernflower</span><br><span class="line">gradle build</span><br><span class="line"></span><br><span class="line">java -jar build/libs/fernflower.jar -dgs=<span class="literal">true</span> /path_source_dir /path_target_dir</span><br></pre></td></tr></table></figure>
<h1 id="5-java-environment-manager"><a class="markdownIt-Anchor" href="#5-java-environment-manager"></a> 5 Java Environment Manager</h1>
<h2 id="51-jenv"><a class="markdownIt-Anchor" href="#51-jenv"></a> 5.1 jenv</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/jenv/jenv">jenv</a></p>
<ul>
<li>
<p>For mac</p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">brew install jenv</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PATH=&quot;$HOME/.jenv/bin:$PATH&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;eval &quot;$(jenv init -)&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Export JAVA_HOME path</span></span><br><span class="line">jenv enable-plugin <span class="built_in">export</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Diagnosis</span></span><br><span class="line">jenv doctor</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add java version</span></span><br><span class="line">jenv add /Library/Java/JavaVirtualMachines/jdk-17.jdk/Contents/Home</span><br><span class="line">jenv add /Library/Java/JavaVirtualMachines/jdk-22.jdk/Contents/Home</span><br><span class="line"></span><br><span class="line"><span class="comment"># List all available versions</span></span><br><span class="line">jenv versions</span><br><span class="line"></span><br><span class="line"><span class="comment"># Switch to specific version</span></span><br><span class="line"><span class="comment"># shell has highest priority(`JENV_VERSION`) and global has lowest priority. local refers to current directory(`.java-version`)</span></span><br><span class="line">jenv global 17</span><br><span class="line">jenv <span class="built_in">local</span> 22</span><br><span class="line">jenv shell 22</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>For Linux</p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/jenv/jenv.git ~/.jenv</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PATH=&quot;$HOME/.jenv/bin:$PATH&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;eval &quot;$(jenv init -)&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Export JAVA_HOME path</span></span><br><span class="line">jenv enable-plugin <span class="built_in">export</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Diagnosis</span></span><br><span class="line">jenv doctor</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add java version</span></span><br><span class="line">jenv add /usr/lib/jvm/java-8-openjdk-amd64</span><br><span class="line">jenv add /usr/lib/jvm/java-17-openjdk-amd64</span><br><span class="line"></span><br><span class="line"><span class="comment"># List all available versions</span></span><br><span class="line">jenv versions</span><br><span class="line"></span><br><span class="line"><span class="comment"># Switch to specific version</span></span><br><span class="line"><span class="comment"># shell has highest priority(`JENV_VERSION`) and global has lowest priority. local refers to current directory(`.java-version`)</span></span><br><span class="line">jenv global 17</span><br><span class="line">jenv <span class="built_in">local</span> 1.8</span><br><span class="line">jenv shell 1.8</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>Tips:</strong></p>
<ul>
<li>
<p><code>jenv global/local/shell --unset</code></p>
</li>
<li>
<p>For x86 container running on <code>OSX</code> with M-chips, the default <code>jenv init -</code> will encounter strange problem, because the shell command turns out to be <code>/run/rosetta/rosetta /usr/local/bin/zsh zsh</code>, rather than <code>zsh</code> in most cases. And the shell parse step (list as below) in <code>~/.jenv/libexec/jenv-init</code> cannot work correctly. <strong>So the solution is using <code>jenv init - zsh</code> instead of <code>jenv init -</code> by specifying the shell command to skip the pass step</strong></p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">shell=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$shell</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">shell=<span class="string">&quot;<span class="subst">$(ps -p <span class="string">&quot;<span class="variable">$PPID</span>&quot;</span> -o &#x27;args=&#x27; 2&gt;/dev/null || true)</span>&quot;</span></span><br><span class="line">shell=<span class="string">&quot;<span class="variable">$&#123;shell%% *&#125;</span>&quot;</span></span><br><span class="line">shell=<span class="string">&quot;<span class="variable">$&#123;shell##-&#125;</span>&quot;</span></span><br><span class="line">shell=<span class="string">&quot;<span class="variable">$&#123;shell:-<span class="variable">$SHELL</span>&#125;</span>&quot;</span></span><br><span class="line">shell=<span class="string">&quot;<span class="variable">$&#123;shell##*/&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>How to list all versions: <code>jenv versions</code> can only listed all the valid versions</p>
<ul>
<li><code>ls ~/.jenv/versions</code></li>
</ul>
</li>
</ul>
<h1 id="6-class-isolation"><a class="markdownIt-Anchor" href="#6-class-isolation"></a> 6 Class Isolation</h1>
<p>Here’s an example of how to use module class loader to create a isolated environment.</p>
<ul>
<li><code>module1</code> and <code>module2</code> both have the log dependencies.</li>
<li>Each module will init its own log context in an isolated environment.</li>
</ul>
<p>The structure of the project:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── common</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   └── src</span><br><span class="line">│       └── main</span><br><span class="line">│           └── java</span><br><span class="line">│               └── org</span><br><span class="line">│                   └── liuyehcf</span><br><span class="line">│                       └── moduleisolation</span><br><span class="line">│                           ├── TestMain.java</span><br><span class="line">│                           └── loader</span><br><span class="line">│                               ├── ClassFactory.java</span><br><span class="line">│                               └── ModuleClassLoader.java</span><br><span class="line">├── module1</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   └── src</span><br><span class="line">│       └── main</span><br><span class="line">│           ├── java</span><br><span class="line">│           │   └── org</span><br><span class="line">│           │       └── liuyehcf</span><br><span class="line">│           │           └── moduleisolation</span><br><span class="line">│           │               └── module1</span><br><span class="line">│           │                   ├── Function.java</span><br><span class="line">│           │                   └── ModuleClassFactory.java</span><br><span class="line">│           └── resources</span><br><span class="line">│               └── module1_log4j2.xml</span><br><span class="line">├── module2</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   └── src</span><br><span class="line">│       └── main</span><br><span class="line">│           ├── java</span><br><span class="line">│           │   └── org</span><br><span class="line">│           │       └── liuyehcf</span><br><span class="line">│           │           └── moduleisolation</span><br><span class="line">│           │               └── module2</span><br><span class="line">│           │                   ├── Function.java</span><br><span class="line">│           │                   └── ModuleClassFactory.java</span><br><span class="line">│           └── resources</span><br><span class="line">│               └── module2_log4j2.xml</span><br><span class="line">└── pom.xml</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> class_isolation_demo</span><br><span class="line"><span class="built_in">cd</span> class_isolation_demo</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p common/src/main/java/org/liuyehcf/moduleisolation/loader</span><br><span class="line"><span class="built_in">mkdir</span> -p module1/src/main/java/org/liuyehcf/moduleisolation/module1</span><br><span class="line"><span class="built_in">mkdir</span> -p module1/src/main/resources</span><br><span class="line"><span class="built_in">mkdir</span> -p module2/src/main/java/org/liuyehcf/moduleisolation/module2</span><br><span class="line"><span class="built_in">mkdir</span> -p module2/src/main/resources</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; pom.xml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.liuyehcf&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;ModuleIsolcation&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;/packaging&gt;</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;common&lt;/module&gt;</span><br><span class="line">        &lt;module&gt;module1&lt;/module&gt;</span><br><span class="line">        &lt;module&gt;module2&lt;/module&gt;</span><br><span class="line">    &lt;/modules&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;compiler-plugin.version&gt;3.8.1&lt;/compiler-plugin.version&gt;</span><br><span class="line">        &lt;shade-plugin.version&gt;3.2.4&lt;/shade-plugin.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;pluginManagement&gt;</span><br><span class="line">            &lt;plugins&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;<span class="variable">$&#123;compiler-plugin.version&#125;</span>&lt;/version&gt;</span><br><span class="line">                    &lt;configuration&gt;</span><br><span class="line">                        &lt;<span class="built_in">source</span>&gt;<span class="variable">$&#123;maven.compiler.source&#125;</span>&lt;/source&gt;</span><br><span class="line">                        &lt;target&gt;<span class="variable">$&#123;maven.compiler.target&#125;</span>&lt;/target&gt;</span><br><span class="line">                    &lt;/configuration&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;groupId&gt;net.revelc.code.formatter&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;formatter-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;<span class="variable">$&#123;shade-plugin.version&#125;</span>&lt;/version&gt;</span><br><span class="line">                    &lt;executions&gt;</span><br><span class="line">                        &lt;execution&gt;</span><br><span class="line">                            &lt;configuration&gt;</span><br><span class="line">                                &lt;filters&gt;</span><br><span class="line">                                    &lt;filter&gt;</span><br><span class="line">                                        &lt;artifact&gt;*:*&lt;/artifact&gt;</span><br><span class="line">                                        &lt;excludes&gt;</span><br><span class="line">                                            &lt;exclude&gt;META-INF/*.SF&lt;/exclude&gt;</span><br><span class="line">                                            &lt;exclude&gt;META-INF/*.DSA&lt;/exclude&gt;</span><br><span class="line">                                            &lt;exclude&gt;META-INF/*.RSA&lt;/exclude&gt;</span><br><span class="line">                                        &lt;/excludes&gt;</span><br><span class="line">                                    &lt;/filter&gt;</span><br><span class="line">                                &lt;/filters&gt;</span><br><span class="line">                                &lt;finalName&gt;<span class="variable">$&#123;project.build.finalName&#125;</span>-jar-with-dependencies&lt;/finalName&gt;</span><br><span class="line">                            &lt;/configuration&gt;</span><br><span class="line">                            &lt;goals&gt;</span><br><span class="line">                                &lt;goal&gt;shade&lt;/goal&gt;</span><br><span class="line">                            &lt;/goals&gt;</span><br><span class="line">                            &lt;phase&gt;package&lt;/phase&gt;</span><br><span class="line">                        &lt;/execution&gt;</span><br><span class="line">                    &lt;/executions&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">            &lt;/plugins&gt;</span><br><span class="line">        &lt;/pluginManagement&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; common/pom.xml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.liuyehcf&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;ModuleIsolcation&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;common&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;log4j.version&gt;2.17.1&lt;/log4j.version&gt;</span><br><span class="line">        &lt;slf4j.version&gt;1.7.32&lt;/slf4j.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="variable">$&#123;slf4j.version&#125;</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;log4j-slf4j-impl&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="variable">$&#123;log4j.version&#125;</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;log4j-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="variable">$&#123;log4j.version&#125;</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="variable">$&#123;log4j.version&#125;</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/project&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; common/src/main/java/org/liuyehcf/moduleisolation/TestMain.java &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">package org.liuyehcf.moduleisolation;</span><br><span class="line"></span><br><span class="line">import org.liuyehcf.moduleisolation.loader.ClassFactory;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line">public class TestMain &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        runModule(<span class="string">&quot;module1&quot;</span>);</span><br><span class="line">        runModule(<span class="string">&quot;module2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void runModule(String moduleName) throws Exception &#123;</span><br><span class="line">        Class&lt;?&gt; classFactoryClass = ClassLoader.getSystemClassLoader().loadClass(</span><br><span class="line">                String.format(<span class="string">&quot;org.liuyehcf.moduleisolation.%s.ModuleClassFactory&quot;</span>, moduleName));</span><br><span class="line">        ClassFactory classFactory = (ClassFactory) classFactoryClass.newInstance();</span><br><span class="line">        classFactory.initModuleContext();</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; clazz = classFactory.getClass(</span><br><span class="line">                String.format(<span class="string">&quot;org.liuyehcf.moduleisolation.%s.Function&quot;</span>, moduleName));</span><br><span class="line">        Method run = clazz.getMethod(<span class="string">&quot;run&quot;</span>);</span><br><span class="line">        Object <span class="keyword">function</span> = clazz.newInstance();</span><br><span class="line">        run.invoke(<span class="keyword">function</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; common/src/main/java/org/liuyehcf/moduleisolation/loader/ClassFactory.java &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">package org.liuyehcf.moduleisolation.loader;</span><br><span class="line"></span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line">import org.apache.logging.log4j.core.config.Configuration;</span><br><span class="line">import org.apache.logging.log4j.core.config.ConfigurationSource;</span><br><span class="line">import org.apache.logging.log4j.core.config.xml.XmlConfiguration;</span><br><span class="line"></span><br><span class="line">import java.io.FileNotFoundException;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.net.URL;</span><br><span class="line"></span><br><span class="line">public abstract class ClassFactory &#123;</span><br><span class="line"></span><br><span class="line">    protected ModuleClassLoader classLoader;</span><br><span class="line"></span><br><span class="line">    protected <span class="function"><span class="title">ClassFactory</span></span>() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            classLoader = ModuleClassLoader.create(getModuleName());</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            rethrow(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @SuppressWarnings(<span class="string">&quot;unchecked&quot;</span>)</span><br><span class="line">    public static &lt;T extends Throwable&gt; void rethrow(Throwable t) throws T &#123;</span><br><span class="line">        throw (T) t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Name of module</span><br><span class="line">     */</span><br><span class="line">    protected abstract String getModuleName();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Entry to get class of current module</span><br><span class="line">     */</span><br><span class="line">    public final Class&lt;?&gt; getClass(String className) throws ClassNotFoundException &#123;</span><br><span class="line">        <span class="built_in">return</span> classLoader.loadClass(className);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Initialize the isolated context of this module</span><br><span class="line">     */</span><br><span class="line">    public final void initModuleContext() throws Exception &#123;</span><br><span class="line">        initLog4j2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * This method is used to initialize the isolated context of log4j2, avoiding conflict between</span><br><span class="line">     * different modules.</span><br><span class="line">     */</span><br><span class="line">    private void initLog4j2() throws Exception &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = getClass(</span><br><span class="line">                <span class="string">&quot;org.liuyehcf.moduleisolation.loader.ClassFactory<span class="variable">$Log4jContextInitializer</span>&quot;</span>);</span><br><span class="line">        clazz.getMethod(<span class="string">&quot;init&quot;</span>, String.class).invoke(null, getModuleName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class Log4jContextInitializer &#123;</span><br><span class="line">        public static void init(String moduleName) throws IOException &#123;</span><br><span class="line">            URL resource = Log4jContextInitializer.class.getClassLoader()</span><br><span class="line">                    .getResource(String.format(<span class="string">&quot;%s_log4j2.xml&quot;</span>, moduleName));</span><br><span class="line">            <span class="keyword">if</span> (resource == null) &#123;</span><br><span class="line">                throw new FileNotFoundException(</span><br><span class="line">                        String.format(<span class="string">&quot;Cannot find log4j2.xml in module %s&quot;</span>, moduleName));</span><br><span class="line">            &#125;</span><br><span class="line">            ConfigurationSource <span class="built_in">source</span> = new ConfigurationSource(resource.openStream(), resource);</span><br><span class="line">            LoggerContext context = (LoggerContext) LogManager.getContext(<span class="literal">false</span>);</span><br><span class="line">            Configuration config = new XmlConfiguration(context, <span class="built_in">source</span>);</span><br><span class="line">            context.start(config);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; common/src/main/java/org/liuyehcf/moduleisolation/loader/ModuleClassLoader.java &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">package org.liuyehcf.moduleisolation.loader;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.net.MalformedURLException;</span><br><span class="line">import java.net.URL;</span><br><span class="line">import java.net.URLClassLoader;</span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.Enumeration;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">public class ModuleClassLoader extends URLClassLoader &#123;</span><br><span class="line">    private static final String MODULE_JAR_FILE_PATTERN = <span class="string">&quot;%s-jar-with-dependencies.jar&quot;</span>;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        ClassLoader.registerAsParallelCapable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private final File jarFile;</span><br><span class="line">    private final ClassLoaderWrapper parent;</span><br><span class="line"></span><br><span class="line">    private ModuleClassLoader(URL[] urls) &#123;</span><br><span class="line">        super(urls, null);</span><br><span class="line">        this.jarFile = new File(urls[0].getPath());</span><br><span class="line">        this.parent = new ClassLoaderWrapper(ClassLoader.getSystemClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ModuleClassLoader create(String moduleName) throws MalformedURLException &#123;</span><br><span class="line">        String jarNameSuffix = String.format(MODULE_JAR_FILE_PATTERN, moduleName);</span><br><span class="line">        String classpath = System.getProperty(<span class="string">&quot;java.class.path&quot;</span>);</span><br><span class="line">        String[] moduleJarFiles = classpath.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">        String targetJarFile = null;</span><br><span class="line">        <span class="keyword">for</span> (String jarFile : moduleJarFiles) &#123;</span><br><span class="line">            <span class="keyword">if</span> (jarFile.endsWith(jarNameSuffix)) &#123;</span><br><span class="line">                targetJarFile = jarFile;</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (targetJarFile == null) &#123;</span><br><span class="line">            throw new RuntimeException(</span><br><span class="line">                    String.format(<span class="string">&quot;Cannot find &#x27;%s&#x27; in classpath &#x27;%s&#x27;&quot;</span>, jarNameSuffix, classpath));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> new ModuleClassLoader(new URL[] &#123;new File(targetJarFile).toURI().toURL()&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public File <span class="function"><span class="title">getJarFile</span></span>() &#123;</span><br><span class="line">        <span class="built_in">return</span> jarFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean isValidParentResource(URL url) &#123;</span><br><span class="line">        <span class="built_in">return</span> url != null &amp;&amp; !url.getPath().contains(<span class="string">&quot;-reader-jar-with-dependencies.jar&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            <span class="built_in">return</span> super.loadClass(name, resolve);</span><br><span class="line">        &#125; catch (ClassNotFoundException cnf) &#123;</span><br><span class="line">            <span class="built_in">return</span> parent.loadClass(name, resolve);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Enumeration&lt;URL&gt; getResources(String name) throws IOException &#123;</span><br><span class="line">        // Load resource from current module classLoader</span><br><span class="line">        List&lt;URL&gt; urls = Collections.list(super.getResources(name));</span><br><span class="line">        // Load resource from parent classLoader but exclude other module resources</span><br><span class="line">        urls.addAll(Collections.list(parent.getResources(name)).stream()</span><br><span class="line">                .filter(this::isValidParentResource).collect(Collectors.toList()));</span><br><span class="line">        <span class="built_in">return</span> Collections.enumeration(urls);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public URL getResource(String name) &#123;</span><br><span class="line">        // Load resource from current module classLoader</span><br><span class="line">        URL url = super.getResource(name);</span><br><span class="line">        <span class="keyword">if</span> (url == null) &#123;</span><br><span class="line">            // Load resource from parent classLoader but exclude other module resources</span><br><span class="line">            url = parent.getResource(name);</span><br><span class="line">            <span class="keyword">if</span> (!isValidParentResource(url)) &#123;</span><br><span class="line">                <span class="built_in">return</span> null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * The only <span class="keyword">function</span> of this wrapper is changing access modifiers of loadClass from protected to</span><br><span class="line">     * public</span><br><span class="line">     */</span><br><span class="line">    private static final class ClassLoaderWrapper extends ClassLoader &#123;</span><br><span class="line">        static &#123;</span><br><span class="line">            ClassLoader.registerAsParallelCapable();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public ClassLoaderWrapper(ClassLoader parent) &#123;</span><br><span class="line">            super(parent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123;</span><br><span class="line">            <span class="built_in">return</span> super.findClass(name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException &#123;</span><br><span class="line">            <span class="built_in">return</span> super.loadClass(name, resolve);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; module1/pom.xml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.liuyehcf&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;ModuleIsolcation&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;module1&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;</span><br><span class="line">        &lt;compiler-plugin.version&gt;3.8.1&lt;/compiler-plugin.version&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.liuyehcf&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;common&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;finalName&gt;module1&lt;/finalName&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; module1/src/main/java/org/liuyehcf/moduleisolation/module1/Function.java &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">package org.liuyehcf.moduleisolation.module1;</span><br><span class="line"></span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line">public class Function &#123;</span><br><span class="line">    private static final Logger LOGGER = LoggerFactory.getLogger(Function.class);</span><br><span class="line"></span><br><span class="line">    public void <span class="function"><span class="title">run</span></span>() &#123;</span><br><span class="line">        LOGGER.info(<span class="string">&quot;This is an info log, classLoader=&#123;&#125;, ObjectClass=&#123;&#125;, LoggerFactoryClass=&#123;&#125;&quot;</span>,</span><br><span class="line">                getClass().getClassLoader(), getClassString(Object.class),</span><br><span class="line">                getClassString(LoggerFactory.class));</span><br><span class="line">        LOGGER.error(<span class="string">&quot;This is an error log&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private String getClassString(Class&lt;?&gt; clazz) &#123;</span><br><span class="line">        <span class="built_in">return</span> clazz.getName() + <span class="string">&quot;@&quot;</span> + Integer.toHexString(System.identityHashCode(clazz));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; module1/src/main/java/org/liuyehcf/moduleisolation/module1/ModuleClassFactory.java &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">package org.liuyehcf.moduleisolation.module1;</span><br><span class="line"></span><br><span class="line">import org.liuyehcf.moduleisolation.loader.ClassFactory;</span><br><span class="line"></span><br><span class="line">public class ModuleClassFactory extends ClassFactory &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected String <span class="function"><span class="title">getModuleName</span></span>() &#123;</span><br><span class="line">        <span class="built_in">return</span> <span class="string">&quot;module1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; module1/src/main/resources/module1_log4j2.xml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;Configuration status=<span class="string">&quot;WARN&quot;</span>&gt;</span><br><span class="line">    &lt;Properties&gt;</span><br><span class="line">        &lt;Property name=<span class="string">&quot;LOG_DIR&quot;</span>&gt;<span class="variable">$&#123;env:MODULE_LOG_DIR:-/tmp/module_isloation&#125;</span>&lt;/Property&gt;</span><br><span class="line">        &lt;Property name=<span class="string">&quot;LOG_LEVEL&quot;</span>&gt;<span class="variable">$&#123;env:MODULE_LOG_LEVEL:-info&#125;</span>&lt;/Property&gt;</span><br><span class="line">        &lt;Property name=<span class="string">&quot;LOG_PATTERN&quot;</span>&gt;%d&#123;yyyy-MM-<span class="built_in">dd</span> HH:mm:ss.SSS&#125; %style&#123;[%thread]&#125;&#123;bright&#125; %highlight&#123;[%-5level] [%X&#123;QueryId&#125;] %logger&#123;36&#125;&#125;&#123;STYLE=Logback&#125; - %msg%n</span><br><span class="line">        &lt;/Property&gt;</span><br><span class="line">    &lt;/Properties&gt;</span><br><span class="line">    &lt;Appenders&gt;</span><br><span class="line">        &lt;RollingRandomAccessFile name=<span class="string">&quot;DefaultAppender&quot;</span> fileName=<span class="string">&quot;<span class="variable">$&#123;LOG_DIR&#125;</span>/module1/default.log&quot;</span></span><br><span class="line">                                 filePattern=<span class="string">&quot;<span class="variable">$&#123;LOG_DIR&#125;</span>/module1/default-%d&#123;yyyy-MM-dd&#125;-%i.log&quot;</span>&gt;</span><br><span class="line">            &lt;PatternLayout</span><br><span class="line">                    pattern=<span class="string">&quot;<span class="variable">$&#123;LOG_PATTERN&#125;</span>&quot;</span>/&gt;</span><br><span class="line">            &lt;Policies&gt;</span><br><span class="line">                &lt;TimeBasedTriggeringPolicy interval=<span class="string">&quot;1&quot;</span> modulate=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">                &lt;SizeBasedTriggeringPolicy size=<span class="string">&quot;1000MB&quot;</span>/&gt;</span><br><span class="line">            &lt;/Policies&gt;</span><br><span class="line">            &lt;DefaultRolloverStrategy max=<span class="string">&quot;7&quot;</span>/&gt;</span><br><span class="line">        &lt;/RollingRandomAccessFile&gt;</span><br><span class="line">        &lt;RollingRandomAccessFile name=<span class="string">&quot;ErrorAppender&quot;</span> fileName=<span class="string">&quot;<span class="variable">$&#123;LOG_DIR&#125;</span>/module1/error.log&quot;</span></span><br><span class="line">                                 filePattern=<span class="string">&quot;<span class="variable">$&#123;LOG_DIR&#125;</span>/module1/error-%d&#123;yyyy-MM-dd&#125;-%i.log&quot;</span>&gt;</span><br><span class="line">            &lt;ThresholdFilter level=<span class="string">&quot;ERROR&quot;</span> onMatch=<span class="string">&quot;ACCEPT&quot;</span> onMismatch=<span class="string">&quot;DENY&quot;</span>/&gt;</span><br><span class="line">            &lt;PatternLayout</span><br><span class="line">                    pattern=<span class="string">&quot;<span class="variable">$&#123;LOG_PATTERN&#125;</span>&quot;</span>/&gt;</span><br><span class="line">            &lt;Policies&gt;</span><br><span class="line">                &lt;TimeBasedTriggeringPolicy interval=<span class="string">&quot;1&quot;</span> modulate=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">                &lt;SizeBasedTriggeringPolicy size=<span class="string">&quot;1000MB&quot;</span>/&gt;</span><br><span class="line">            &lt;/Policies&gt;</span><br><span class="line">            &lt;DefaultRolloverStrategy max=<span class="string">&quot;7&quot;</span>/&gt;</span><br><span class="line">        &lt;/RollingRandomAccessFile&gt;</span><br><span class="line">        &lt;Async name=<span class="string">&quot;AsyncDefaultAppender&quot;</span>&gt;</span><br><span class="line">            &lt;AppenderRef ref=<span class="string">&quot;DefaultAppender&quot;</span>/&gt;</span><br><span class="line">            &lt;AppenderRef ref=<span class="string">&quot;ErrorAppender&quot;</span>/&gt;</span><br><span class="line">        &lt;/Async&gt;</span><br><span class="line">    &lt;/Appenders&gt;</span><br><span class="line">    &lt;Loggers&gt;</span><br><span class="line">        &lt;Root level=<span class="string">&quot;<span class="variable">$&#123;LOG_LEVEL&#125;</span>&quot;</span>&gt;</span><br><span class="line">            &lt;AppenderRef ref=<span class="string">&quot;AsyncDefaultAppender&quot;</span>/&gt;</span><br><span class="line">        &lt;/Root&gt;</span><br><span class="line">    &lt;/Loggers&gt;</span><br><span class="line">&lt;/Configuration&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> -f module1/pom.xml module2/pom.xml</span><br><span class="line"><span class="built_in">cp</span> -f module1/src/main/java/org/liuyehcf/moduleisolation/module1/Function.java module2/src/main/java/org/liuyehcf/moduleisolation/module2/Function.java</span><br><span class="line"><span class="built_in">cp</span> -f module1/src/main/java/org/liuyehcf/moduleisolation/module1/ModuleClassFactory.java module2/src/main/java/org/liuyehcf/moduleisolation/module2/ModuleClassFactory.java</span><br><span class="line"><span class="built_in">cp</span> -f module1/src/main/resources/module1_log4j2.xml module2/src/main/resources/module2_log4j2.xml</span><br><span class="line">sed -i <span class="string">&#x27;s/module1/module2/g&#x27;</span> module2/pom.xml</span><br><span class="line">sed -i <span class="string">&#x27;s/module1/module2/g&#x27;</span> module2/src/main/java/org/liuyehcf/moduleisolation/module2/Function.java</span><br><span class="line">sed -i <span class="string">&#x27;s/module1/module2/g&#x27;</span> module2/src/main/java/org/liuyehcf/moduleisolation/module2/ModuleClassFactory.java</span><br><span class="line">sed -i <span class="string">&#x27;s/module1/module2/g&#x27;</span> module2/src/main/resources/module2_log4j2.xml</span><br><span class="line"></span><br><span class="line">mvn clean package -DskipTests</span><br><span class="line"><span class="built_in">rm</span> -rf /tmp/module_isloation</span><br><span class="line">java -classpath ./module2/target/module2-jar-with-dependencies.jar:./module1/target/module1-jar-with-dependencies.jar org.liuyehcf.moduleisolation.TestMain</span><br><span class="line"><span class="built_in">cat</span> /tmp/module_isloation/module1/default.log</span><br><span class="line"><span class="built_in">cat</span> /tmp/module_isloation/module1/error.log</span><br><span class="line"><span class="built_in">cat</span> /tmp/module_isloation/module2/default.log</span><br><span class="line"><span class="built_in">cat</span> /tmp/module_isloation/module2/error.log</span><br></pre></td></tr></table></figure>
<p>You can find each module share the same <code>Object.class</code> instance, but has unique instance of <code>LoggerFactory.class</code></p>
<h1 id="7-tips"><a class="markdownIt-Anchor" href="#7-tips"></a> 7 Tips</h1>
<h2 id="71-find-jdk-install-path"><a class="markdownIt-Anchor" href="#71-find-jdk-install-path"></a> 7.1 Find JDK Install Path</h2>
<p>For linux, the directory usually is: <code>/usr/lib/jvm</code></p>
<ol>
<li><code>readlink -f $(which java)</code></li>
<li><code>update-alternatives --config java</code></li>
<li><code>update-alternatives --display java</code></li>
</ol>
<p>For MacOS, the directory usually is: <code>/Library/Java/JavaVirtualMachines</code></p>
<ol>
<li><code>readlink -f $(which java)</code></li>
</ol>
<h2 id="72-how-to-check-whether-jar-file-contains-specific-class-file"><a class="markdownIt-Anchor" href="#72-how-to-check-whether-jar-file-contains-specific-class-file"></a> 7.2 How to check whether jar file contains specific class file</h2>
<ul>
<li><code>unzip -l &lt;jar&gt; | grep xxx.class</code></li>
<li><code>jar tf &lt;jar&gt; | grep xxx.class</code></li>
</ul>
<h2 id="73-how-to-extract-jar-file-to-specific-directory"><a class="markdownIt-Anchor" href="#73-how-to-extract-jar-file-to-specific-directory"></a> 7.3 How to extract jar file to specific directory</h2>
<ul>
<li><code>cd &lt;target_dir&gt;; jar -xf &lt;jar&gt;</code></li>
<li><code>unzip &lt;jar&gt; -d &lt;target_dir&gt;</code></li>
</ul>
<h2 id="74-how-to-breakthrough-checked-exception-limitation"><a class="markdownIt-Anchor" href="#74-how-to-breakthrough-checked-exception-limitation"></a> 7.4 How to breakthrough checked exception limitation</h2>
<p>If you want to throw an checked exception, but you don’t want to add <code>throws clause</code> to the method signature, there are several ways can make it happen:</p>
<ol>
<li>
<p>Use Type Erasure</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Throwable</span>&gt; <span class="keyword">void</span> <span class="title function_">throwException</span><span class="params">(Throwable exception)</span> <span class="keyword">throws</span> T &#123;</span><br><span class="line">    <span class="keyword">throw</span> (T) exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Use <code>Unsafe.throwException</code></p>
</li>
</ol>
<h2 id="75-how-jvm-use-classpath"><a class="markdownIt-Anchor" href="#75-how-jvm-use-classpath"></a> 7.5 How JVM use classpath</h2>
<p>Assume the classpath is: <code>/path/to/a.jar:/path/to/b.jar</code>, and <code>a.jar</code> exists while <code>b.jar</code> doesn’t exist.</p>
<p>The following steps can work well:</p>
<ol>
<li>Load some class <code>A</code> from <code>a.jar</code></li>
<li>Put <code>b.jar</code> to the right place, i.e <code>/path/to/b.jar</code></li>
<li>Load some class <code>B</code> from <code>b.jar</code></li>
</ol>
<p><strong>And the same process won’t work if the classpath is reverted, i.e. <code>/path/to/b.jar:/path/to/a.jar</code>, because when JVM load class <code>A</code> it already searched <code>b.jar</code> and remember it’s not existed.</strong></p>
<h1 id="8-参考"><a class="markdownIt-Anchor" href="#8-参考"></a> 8 参考</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://my.oschina.net/feichexia/blog/196575">JVM性能调优监控工具jps、jstack、jmap、jhat、jstat、hprof使用详解</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lzmrex/articles/12579862.html">Java应用打开debug端口</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ky4y1j73x/">别嘲笑我，工作几年的程序员也不一定会远程debug代码</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%91%98%E5%BD%95/" rel="tag"># 摘录</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/01/16/vim/" rel="prev" title="vim">
      <i class="fa fa-chevron-left"></i> vim
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/01/19/Summary-of-Key-Points/" rel="next" title="Summary-of-Key-Points">
      Summary-of-Key-Points <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-livere">livere</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane livere" id="comment-livere">
              
  <div class="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC8zMzY0My8xMDE5OA=="></div>
  </div>
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-install-jdk"><span class="nav-text"> 1 Install JDK</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-builtin"><span class="nav-text"> 2 Builtin</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#21-java"><span class="nav-text"> 2.1 java</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#211-execute"><span class="nav-text"> 2.1.1 Execute</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#212-enable-debug"><span class="nav-text"> 2.1.2 Enable Debug</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-jps"><span class="nav-text"> 2.2 jps</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#23-jstat"><span class="nav-text"> 2.3 jstat</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#24-jinfo"><span class="nav-text"> 2.4 jinfo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#25-jmap"><span class="nav-text"> 2.5 jmap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#26-jhat"><span class="nav-text"> 2.6 jhat</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#27-jstack"><span class="nav-text"> 2.7 jstack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#28-java_home"><span class="nav-text"> 2.8 java_home</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#29-jar"><span class="nav-text"> 2.9 jar</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#291-jar-file-specification"><span class="nav-text"> 2.9.1 JAR File Specification</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#210-jdb"><span class="nav-text"> 2.10 jdb</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-monitor"><span class="nav-text"> 3 Monitor</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#31-arthas"><span class="nav-text"> 3.1 Arthas</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#32-visualvm"><span class="nav-text"> 3.2 VisualVM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#321-shallow-size-vs-retained-size"><span class="nav-text"> 3.2.1 Shallow Size vs. Retained Size</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-java-decompiler"><span class="nav-text"> 4 Java Decompiler</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#41-cfr"><span class="nav-text"> 4.1 CFR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#42-jd"><span class="nav-text"> 4.2 JD</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#43-jad"><span class="nav-text"> 4.3 JAD</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#44-fernflower"><span class="nav-text"> 4.4 Fernflower</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-java-environment-manager"><span class="nav-text"> 5 Java Environment Manager</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#51-jenv"><span class="nav-text"> 5.1 jenv</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-class-isolation"><span class="nav-text"> 6 Class Isolation</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-tips"><span class="nav-text"> 7 Tips</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#71-find-jdk-install-path"><span class="nav-text"> 7.1 Find JDK Install Path</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#72-how-to-check-whether-jar-file-contains-specific-class-file"><span class="nav-text"> 7.2 How to check whether jar file contains specific class file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#73-how-to-extract-jar-file-to-specific-directory"><span class="nav-text"> 7.3 How to extract jar file to specific directory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#74-how-to-breakthrough-checked-exception-limitation"><span class="nav-text"> 7.4 How to breakthrough checked exception limitation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#75-how-jvm-use-classpath"><span class="nav-text"> 7.5 How JVM use classpath</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-%E5%8F%82%E8%80%83"><span class="nav-text"> 8 参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Liuyehcf"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Liuyehcf</p>
  <div class="site-description" itemprop="description">大音希声，大象无形</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">285</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liuyehcf</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  

<script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'qhEhLuMeMOy1zgcBhkqUS6P8-gzGzoHsz',
      appKey     : 'uhkruDLNLNdL5rQjRBY2X9Ke',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
