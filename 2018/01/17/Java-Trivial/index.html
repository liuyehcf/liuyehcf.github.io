<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="阅读更多">
<meta property="og:type" content="article">
<meta property="og:title" content="Java-Trivial">
<meta property="og:url" content="http://example.com/2018/01/17/Java-Trivial/index.html">
<meta property="og:site_name" content="Liuye Notebook">
<meta property="og:description" content="阅读更多">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-01-17T01:30:44.000Z">
<meta property="article:modified_time" content="2024-05-15T13:21:23.000Z">
<meta property="article:author" content="Liuyehcf">
<meta property="article:tag" content="摘录">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2018/01/17/Java-Trivial/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Java-Trivial | Liuye Notebook</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Liuye Notebook</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-explore">

    <a href="/explore/" rel="section"><i class="fa fa-sitemap fa-fw"></i>发现</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/01/17/Java-Trivial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Liuyehcf">
      <meta itemprop="description" content="大音希声，大象无形">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liuye Notebook">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Java-Trivial
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-17 09:30:44" itemprop="dateCreated datePublished" datetime="2018-01-17T09:30:44+08:00">2018-01-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-05-15 21:21:23" itemprop="dateModified" datetime="2024-05-15T21:21:23+08:00">2024-05-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Java-Virtual-Machine/" itemprop="url" rel="index"><span itemprop="name">Java Virtual Machine</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Java-Virtual-Machine/Command-Line-Tool/" itemprop="url" rel="index"><span itemprop="name">Command Line Tool</span></a>
                </span>
            </span>

          
            <span id="/2018/01/17/Java-Trivial/" class="post-meta-item leancloud_visitors" data-flag-title="Java-Trivial" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/01/17/Java-Trivial/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/01/17/Java-Trivial/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><strong>阅读更多</strong></p>
<span id="more"></span>
<h1 id="1-java"><a class="markdownIt-Anchor" href="#1-java"></a> 1 java</h1>
<h2 id="11-execute"><a class="markdownIt-Anchor" href="#11-execute"></a> 1.1 Execute</h2>
<ul>
<li><code>java -cp /path/aaa.jar com.liuyehcf.demo.MyMain arg1 arg2</code>：将<code>/path/aaa.jar</code>添加到<code>classpath</code>中</li>
<li><code>java -cp /path/aaa.jar:/path/bbb.jar com.liuyehcf.demo.MyMain arg1 arg2</code>：将<code>/path/aaa.jar</code>和<code>/path/bbb.jar</code>添加到<code>classpath</code>中</li>
<li><code>java -cp &quot;/path/*&quot; com.liuyehcf.demo.MyMain arg1 arg2</code>：将<code>/path</code>目录下的所谓<code>class</code>文件以及<code>jar</code>文件都添加到<code>classpath</code>中。这里要用引号，否则<code>*</code>展开后，第二项会被作为<code>main</code>函数所在的类</li>
<li><code>java -cp &quot;/path/*&quot;:&quot;/path2/*&quot; com.liuyehcf.demo.MyMain arg1 arg2</code>：将<code>/path</code>以及<code>/path2</code>目录下的所谓<code>class</code>文件以及<code>jar</code>文件都添加到<code>classpath</code>中</li>
<li><code>java -jar /path/aaa.jar arg1 arg2</code>：运行jar归档文件中指定的<code>main</code>函数</li>
</ul>
<h2 id="12-enable-debug"><a class="markdownIt-Anchor" href="#12-enable-debug"></a> 1.2 Enable Debug</h2>
<p><strong><code>java -Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=8000,suspend=n [其他参数]</code></strong></p>
<ul>
<li><code>-Xrunjdwp</code>：通知JVM使用<code>Java debug wire protocol</code>运行调试环境</li>
<li><code>transport</code>：指定了调试数据的传送方式，<code>dt_socket</code>是指用<code>SOCKET</code>模式</li>
<li><code>address</code>：调试服务器的地址
<ul>
<li><code>8000</code></li>
<li><code>127.0.0.1:8000</code></li>
<li><code>0.0.0.0:8000</code></li>
</ul>
</li>
<li><code>server=y/n</code>：y表示当前是调试服务端，n表示当前是调试客户端</li>
<li><code>suspend</code>：表示启动时不中断。一般用于调试启动不了的问题</li>
</ul>
<h1 id="2-jps"><a class="markdownIt-Anchor" href="#2-jps"></a> 2 jps</h1>
<p>列出正在运行的虚拟机进程，并显示虚拟机执行主类名称以及这些进程的<strong>本地虚拟机唯一<code>ID(Local Virtual Machine Identifier, LVMID)</code></strong></p>
<p>虽然功能比较单一，但它是使用频率最高的<code>JDK</code>命令行工具，因为其他<code>JDK</code>工具大多需要输入它查询到的<code>LVMID</code>来确定要监控的是哪一个虚拟机进程</p>
<p><strong>对本地虚拟机来说，<code>LVMID</code>与操作系统的进程<code>ID(Process Identifier，PID)</code>是一致的</strong>，使用<code>Windows</code>的任务管理器或者<code>UNIX</code>的<code>ps</code>命令也可以查询到虚拟机进程的<code>LVMID</code>，如果同时启动了多个虚拟机进程，无法根据进程名称定位时，就只能依赖<code>jps</code>命令显示主类的功能才能区分了</p>
<p><strong>格式：</strong></p>
<ul>
<li><code>jps [options] [hostid]</code></li>
</ul>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>-q</code>：只输出<code>LVMID</code>，省略主类的名称</li>
<li><code>-m</code>：输出虚拟机进程启动时传递给主类<code>main()</code>函数的参数</li>
<li><code>-l</code>：输出主类的全名，如果进程执行的是<code>Jar</code>包，输出<code>Jar</code>路径</li>
<li><code>-v</code>：输出虚拟机进程启动时的<code>JVM</code>参数</li>
</ul>
<h1 id="3-jstat"><a class="markdownIt-Anchor" href="#3-jstat"></a> 3 jstat</h1>
<p><code>jstat(JVM Statistics Monitoring Tool)</code>是用于监视虚拟机各种运行状态信息的命令行工具</p>
<p><code>jstat</code>可以显示本地或者远程虚拟机进程中的类装载、内存、垃圾收集、<code>JIT</code>编译等运行数据，在没有<code>GUI</code>图形界面，只提供了纯文本控制台环境的服务器上，它将是运行期定位虚拟机性能问题的首选工具</p>
<p><strong>格式：</strong></p>
<ul>
<li><code>jstat [option &lt;vmid&gt; [interval [s|ms] [count] ] ]</code></li>
</ul>
<p><strong>参数说明：</strong></p>
<ul>
<li>如果是本地虚拟机进程，<code>VMID</code>与<code>LVMID</code>是一致的，如果是远程虚拟机进程，那<code>VMID</code>的格式应当是
<ul>
<li><code>[protocol:] [//] lvmid [@hostname[:port]/servername]</code></li>
</ul>
</li>
<li><code>interval</code>和<code>count</code>代表查询间隔和次数，如果省略这两个参数，说明只查询一次
<ul>
<li><code>jstat -gc 2764 250 20</code>：每<code>250</code>毫秒查询一次进程<code>2764</code>垃圾收集情况，一共查询<code>20</code>次</li>
</ul>
</li>
<li><code>-class</code>：监视类装载、卸载数量、总空间以及类装载所耗费的时间</li>
<li><code>-gc</code>：监视<code>Java</code>堆状况，包括<code>Eden</code>区、两个<code>survivor</code>区、老年代、永久代等的容量、已用空间、<code>GC</code>时间合计等信息</li>
<li><code>-gccapacity</code>：监视内容与<code>-gc</code>基本相同，但输出主要关注<code>Java</code>堆各个区域使用到的最大、最小空间</li>
<li><code>-gcutil</code>：监视内容与<code>-gc</code>基本相同，但输出主要关注已使用空间占总空间的百分比</li>
<li><code>-gccause</code>：与<code>-gcutil</code>功能一样，但是会额外输出导致上一次<code>GC</code>产生的原因</li>
<li><code>-gcnew</code>：监视新生代<code>GC</code>状况</li>
<li><code>-gcnewcapacity</code>：监视内容与<code>-gcnew</code>基本相同，输出主要关注使用到的最大、最小空间</li>
<li><code>-gcold</code>：监视老年代<code>GC</code>状况</li>
<li><code>-gcoldcapacity</code>：监视内容与<code>-gcold</code>基本相同，输出主要关注使用到的最大、最小空间</li>
<li><code>-gcpermcapacity</code>：输出永久代使用到的最大、最小空间</li>
<li><code>-compiler</code>：输出<code>JIT</code>编译器编译过的方法、耗时等信息</li>
<li><code>-printcompilation</code>：输出已经被<code>JIT</code>编译的方法</li>
</ul>
<p><strong>输出内容意义：</strong></p>
<ul>
<li><code>E</code>：新生代区<code>Eden</code></li>
<li><code>S0\S1</code>：<code>Survivor0</code>、<code>Survivor1</code>这两个<code>Survivor</code>区</li>
<li><code>O</code>：老年代<code>Old</code></li>
<li><code>P</code>：永久代<code>Permanet</code></li>
<li><code>YGC</code>：<code>Young GC</code></li>
<li><code>YGCT</code>：<code>Yount GC Time</code></li>
<li><code>FGC</code>：<code>Full GC</code></li>
<li><code>FTCG</code>：<code>Full GC Time</code></li>
<li><code>GCT</code>：<code>Minor GC</code>与<code>Full GC</code>总耗时</li>
</ul>
<p><strong>示例：</strong></p>
<ul>
<li><strong><code>jstat -gc &lt;vmid&gt; 1000 1000</code>：查看<code>JVM</code>内存使用</strong></li>
<li><strong><code>jstat -gcutil &lt;vmid&gt; 1000 1000</code>：查看<code>JVM</code>内存使用（百分比）</strong></li>
</ul>
<h1 id="4-jinfo"><a class="markdownIt-Anchor" href="#4-jinfo"></a> 4 jinfo</h1>
<p><code>jinfo(Configuration Info for Java)</code>的作用是实时地查看和调整虚拟机各项参数</p>
<p>使用<code>jps</code>命令的<code>-v</code>参数可以查看虚拟机启动时显示指定的参数列表，<strong>但如果想知道未被显式指定的参数的系统默认值，除了去查找资料外，就只能用<code>jinfo</code>的<code>-flag</code>选项进行查询</strong></p>
<p>如果<code>JDK1.6</code>或者以上版本，可以使用<code>-XX:+PrintFlagsFinal</code>查看参数默认值</p>
<p><code>jinfo</code>还可以使用<code>-sysprops</code>选项把虚拟机进程的<code>System.getProperties()</code>的内容打印出来</p>
<p><strong>格式：</strong></p>
<ul>
<li><code>jinfo [option] &lt;vmid&gt;</code></li>
</ul>
<p><strong>参数说明</strong></p>
<ul>
<li><code>-flag</code>：显式默认值
<ul>
<li><code>jinfo -flags 1874</code>：显式所有项的默认值</li>
<li><code>jinfo -flag CICompilerCount 1874</code>：显示指定项的默认值</li>
</ul>
</li>
<li><code>-sysprops</code>：把虚拟机进程的System.getProperties()的内容打印出来</li>
</ul>
<h1 id="5-jmap"><a class="markdownIt-Anchor" href="#5-jmap"></a> 5 jmap</h1>
<p><code>jmap(Memory Map for Java)</code>命令用于生成堆转储快照(一般称为<code>heapdump</code>或<code>dump</code>文件)</p>
<p><code>jmap</code>的作用并不仅仅为了获取<code>dump</code>文件，它还可以查询<code>finalize</code>执行队列、<code>Java</code>堆和永久代的详细信息，如空间使用率、当前用的是哪种收集器等</p>
<p><strong>格式：</strong></p>
<ul>
<li><code>jmap [option] &lt;vmid&gt;</code></li>
</ul>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>-dump</code>：生成Java堆转储快照，格式为<code>-dump:[live, ]format=b, file=&lt;filename&gt;</code>，其中<code>live</code>子参数说明是否只<code>dump</code>出存活对象</li>
<li><code>-finalizerinfo</code>：显示在<code>F-Queue</code>中等待<code>Finalizer</code>线程执行<code>finalize</code>方法的对象</li>
<li><code>-heap</code>：显示<code>Java</code>堆详细信息，如使用哪种回收器，参数配置，分代状况等</li>
<li><code>-histo</code>：显示堆中对象统计信息，包括类、实例数量、合计容量</li>
<li><code>-permstat</code>：以<code>ClassLoader</code>为统计口径显示永久代内存状态</li>
<li><code>-F</code>：当虚拟机进程对<code>-dump</code>选项没有响应时，可使用这个选项强制生成<code>dump</code>快照</li>
</ul>
<p><strong>示例</strong></p>
<ul>
<li><code>jmap -dump:format=b,file=&lt;dump_文件名&gt; &lt;java进程号&gt;</code>：<code>dump</code>进程所有对象的堆栈</li>
<li><code>jmap -dump:live,format=b,file=&lt;dump_文件名&gt; &lt;java进程号&gt;</code>：<code>dump</code>进程中存活对象的堆栈，会触发<code>full gc</code></li>
<li><code>jmap -histo:live &lt;vmid&gt;</code>：触发<code>full gc</code></li>
<li><code>jmap -histo &lt;vmid&gt; | sort -k 2 -g -r | less</code>：统计堆栈中对象的内存信息，按照对象实例个数降序打印</li>
<li><code>jmap -histo &lt;vmid&gt; | sort -k 3 -g -r | less</code>：统计堆栈中对象的内存信息，按照对象占用内存大小降序打印</li>
</ul>
<h1 id="6-jhat"><a class="markdownIt-Anchor" href="#6-jhat"></a> 6 jhat</h1>
<p><code>jhat</code>是虚拟机堆转储快照分析工具</p>
<p><code>Sun JDK</code>提供<code>jhat(JVM Heap Analysis Tool)</code>命令与<code>jmap</code>搭配使用，来分析<code>jmap</code>生成的堆转储快照</p>
<p><code>jhat</code>内置了一个微型的<code>HTTP/HTML</code>服务器，生成<code>dump</code>文件的分析结果后，可以在浏览器中查看</p>
<p>不过在实际工作中，除非真的没有别的工具可用，否则一般不会直接使用<code>jhat</code>命令来分析<code>dump</code>文件，原因如下</p>
<ul>
<li>一般不会再部署应用程序的服务器上直接分析<code>dump</code>文件，即使可以这样做，也会尽量将<code>dump</code>文件复制到其他机器上进行分析，因为分析工作是一个耗时而且消耗硬件资源的过程，既然都要在其他机器上进行，就没有必要受到命令工具的限制了</li>
<li><code>jhat</code>的分析功能相对来说比较简陋，<code>VisualVM</code>，以及专业用于分析<code>dump</code>文件的<code>Eclipse Memory Analyzer</code>、<code>IBM HeapAnalyzer</code>等工具，都能实现比<code>jhat</code>更强大更专业的分析功能</li>
</ul>
<p><strong>配合jmap的例子</strong></p>
<ol>
<li><code>jmap -dump:format=b,file=dump.bin 1874</code>
<ul>
<li>文件相对路径为<code>dump.bin</code></li>
<li><code>vmid</code>为1874</li>
</ul>
</li>
<li><code>jhat dump.bin</code>
<ul>
<li>在接下来的输出中会指定端口<code>7000</code></li>
<li>在浏览器中键入<code>http://localhost:7000/</code>就可以看到分析结果，拉到最下面，包含如下导航：
<ul>
<li>All classes including platform</li>
<li>Show all members of the rootset</li>
<li>Show instance counts for all classes (including platform)</li>
<li>Show instance counts for all classes (excluding platform)</li>
<li>Show heap histogram</li>
<li>Show finalizer summary</li>
<li>Execute Object Query Language (OQL) query</li>
</ul>
</li>
</ul>
</li>
</ol>
<h1 id="7-jstack"><a class="markdownIt-Anchor" href="#7-jstack"></a> 7 jstack</h1>
<p><code>jstack</code>是<code>Java</code>堆栈跟踪工具</p>
<p><code>jstack(Stack Trace for Java)</code>命令用于生成虚拟机当前时刻的线程快照(一般称为<code>trheaddump</code>或者<code>javacore</code>文件)</p>
<p>线程快照就是当前虚拟机每一条线程正在执行的方法堆栈的集合，生成线程快照的主要目的是定位线程出现长时间停顿的原因，如线程死锁、死循环、请求外部资源导致的长时间等待都是导致线程长时间停顿的常见原因</p>
<p>线程出现停顿的时候通过<code>jstack</code>来查看各个线程的调用堆栈，就可以知道没有响应的线程到底在后台做了什么，或者等待什么资源</p>
<p><strong>格式：</strong></p>
<ul>
<li><code>jstack [option] &lt;vmid&gt;</code></li>
</ul>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>-F</code>：当正常输出的请求不被响应时，强制输出线程堆栈</li>
<li><code>-l</code>：除堆栈外，显示关于锁的附加信息</li>
<li><code>-m</code>：如果调用本地方法的话，可以显示C/C++的堆栈</li>
</ul>
<p><strong>在JDK1.5中，java.lang.Thread类新增一个getAllStackTraces()方法用于获取虚拟机中所有线程的StackTraceElement对象，使用这个对象可以通过简单的几行代码就能完成jstack的大部分功能，在实际项目中不妨调用这个方法做个管理员页面，可以随时使用浏览器来查看线程堆栈</strong></p>
<h1 id="8-jad"><a class="markdownIt-Anchor" href="#8-jad"></a> 8 jad</h1>
<p>Java反编译工具，<a target="_blank" rel="noopener" href="http://www.javadecompilers.com/jad">下载地址</a></p>
<h1 id="9-java_home"><a class="markdownIt-Anchor" href="#9-java_home"></a> 9 java_home</h1>
<p><strong><code>/usr/libexec/java_home -V</code>：用于查看本机上所有版本java的安装目录</strong></p>
<h1 id="10-jar"><a class="markdownIt-Anchor" href="#10-jar"></a> 10 jar</h1>
<p><strong>制作归档文件：：<code>jar cvf xxx.jar -C $&#123;target_dir1&#125; $&#123;dir_or_file1&#125; -C $&#123;target_dir2&#125; $&#123;dir_or_file2&#125; ...</code></strong></p>
<ul>
<li><strong>注意<code>-C</code>只对后面一个参数有效</strong></li>
<li><code>jar cvf xxx.jar .</code></li>
<li><code>jar cvf xxx.jar org com/test/A.class</code></li>
<li><code>jar cvf xxx.jar -C classes org -C classes com</code></li>
</ul>
<p><strong>解压归档文件：<code>jar xvf xxx.jar</code></strong></p>
<ul>
<li>不支持解压到指定目录</li>
</ul>
<p><strong>查看归档文件：<code>jar tf xxx.jar</code></strong></p>
<h1 id="11-arthas"><a class="markdownIt-Anchor" href="#11-arthas"></a> 11 Arthas</h1>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas">Arthas</a></p>
<p><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/commands.html">commands</a></p>
<h1 id="12-visualvm"><a class="markdownIt-Anchor" href="#12-visualvm"></a> 12 VisualVM</h1>
<p><a target="_blank" rel="noopener" href="https://visualvm.github.io/">All-in-One Java Troubleshooting Tool</a></p>
<h2 id="121-shallow-size-vs-retained-size"><a class="markdownIt-Anchor" href="#121-shallow-size-vs-retained-size"></a> 12.1 Shallow Size vs. Retained Size</h2>
<p><code>Shallow Size</code>: This is the amount of memory allocated to store the object itself, not including the objects it references. This includes the memory used by the object’s fields (for primitive types) and the memory used to store the references to other objects (for reference types). It does not include the memory used by the objects those references point to. Tools like VisualVM generally show the shallow size by default.</p>
<p><code>Retained Size</code>: This is the total amount of memory that would be freed if the object were garbage collected. This includes the shallow size of the object itself plus the shallow size of any objects that are exclusively referenced by this object (i.e., objects that would be garbage collected if this object were). The retained size provides a more complete picture of the “true” memory impact of an object but can be more complex to calculate. Some profiling tools provide this information, but it may require additional analysis or plugins.</p>
<h1 id="13-assorted"><a class="markdownIt-Anchor" href="#13-assorted"></a> 13 Assorted</h1>
<h2 id="131-install-jdk"><a class="markdownIt-Anchor" href="#131-install-jdk"></a> 13.1 Install JDK</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase/jdk17-archive-downloads.html">Java SE 17 Archive Downloads</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.oracle.com/java/17/archive/jdk-17.0.10_linux-x64_bin.tar.gz</span><br><span class="line">tar -zxvf jdk-17.0.10_linux-x64_bin.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure>
<h2 id="132-find-jdk-install-path"><a class="markdownIt-Anchor" href="#132-find-jdk-install-path"></a> 13.2 Find JDK Install Path</h2>
<h3 id="1321-linux"><a class="markdownIt-Anchor" href="#1321-linux"></a> 13.2.1 Linux</h3>
<p>一般来说是<code>/usr/lib/jvm</code></p>
<ol>
<li><code>readlink -f $(which java)</code></li>
<li><code>update-alternatives --config java</code></li>
<li><code>update-alternatives --display java</code></li>
</ol>
<h3 id="1322-macos"><a class="markdownIt-Anchor" href="#1322-macos"></a> 13.2.2 MacOS</h3>
<p><code>/Library/Java/JavaVirtualMachines</code></p>
<h1 id="14-参考"><a class="markdownIt-Anchor" href="#14-参考"></a> 14 参考</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://my.oschina.net/feichexia/blog/196575">JVM性能调优监控工具jps、jstack、jmap、jhat、jstat、hprof使用详解</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lzmrex/articles/12579862.html">Java应用打开debug端口</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ky4y1j73x/">别嘲笑我，工作几年的程序员也不一定会远程debug代码</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%91%98%E5%BD%95/" rel="tag"># 摘录</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/01/16/vim/" rel="prev" title="vim">
      <i class="fa fa-chevron-left"></i> vim
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/01/19/Summary-of-Key-Points/" rel="next" title="Summary-of-Key-Points">
      Summary-of-Key-Points <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-livere">livere</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane livere" id="comment-livere">
              
  <div class="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC8zMzY0My8xMDE5OA=="></div>
  </div>
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-java"><span class="nav-text"> 1 java</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#11-execute"><span class="nav-text"> 1.1 Execute</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-enable-debug"><span class="nav-text"> 1.2 Enable Debug</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-jps"><span class="nav-text"> 2 jps</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-jstat"><span class="nav-text"> 3 jstat</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-jinfo"><span class="nav-text"> 4 jinfo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-jmap"><span class="nav-text"> 5 jmap</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-jhat"><span class="nav-text"> 6 jhat</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-jstack"><span class="nav-text"> 7 jstack</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-jad"><span class="nav-text"> 8 jad</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-java_home"><span class="nav-text"> 9 java_home</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-jar"><span class="nav-text"> 10 jar</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-arthas"><span class="nav-text"> 11 Arthas</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12-visualvm"><span class="nav-text"> 12 VisualVM</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#121-shallow-size-vs-retained-size"><span class="nav-text"> 12.1 Shallow Size vs. Retained Size</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#13-assorted"><span class="nav-text"> 13 Assorted</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#131-install-jdk"><span class="nav-text"> 13.1 Install JDK</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#132-find-jdk-install-path"><span class="nav-text"> 13.2 Find JDK Install Path</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1321-linux"><span class="nav-text"> 13.2.1 Linux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1322-macos"><span class="nav-text"> 13.2.2 MacOS</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#14-%E5%8F%82%E8%80%83"><span class="nav-text"> 14 参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Liuyehcf"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Liuyehcf</p>
  <div class="site-description" itemprop="description">大音希声，大象无形</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">288</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">98</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liuyehcf</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  

<script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'qhEhLuMeMOy1zgcBhkqUS6P8-gzGzoHsz',
      appKey     : 'uhkruDLNLNdL5rQjRBY2X9Ke',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
