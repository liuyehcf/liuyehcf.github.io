<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="阅读更多">
<meta property="og:type" content="article">
<meta property="og:title" content="Cpp-相关知识点">
<meta property="og:url" content="http://example.com/2021/08/19/Cpp-%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9/index.html">
<meta property="og:site_name" content="Liuye Blog">
<meta property="og:description" content="阅读更多">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-08-19T01:38:42.000Z">
<meta property="article:modified_time" content="2021-08-22T07:33:02.816Z">
<meta property="article:author" content="Liuyehcf">
<meta property="article:tag" content="原创">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2021/08/19/Cpp-%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Cpp-相关知识点 | Liuye Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Liuye Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-explore">

    <a href="/explore/" rel="section"><i class="fa fa-sitemap fa-fw"></i>发现</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/19/Cpp-%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Liuyehcf">
      <meta itemprop="description" content="大音希声，大象无形">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liuye Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Cpp-相关知识点
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-19 09:38:42" itemprop="dateCreated datePublished" datetime="2021-08-19T09:38:42+08:00">2021-08-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-22 15:33:02" itemprop="dateModified" datetime="2021-08-22T15:33:02+08:00">2021-08-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
                </span>
            </span>

          
            <span id="/2021/08/19/Cpp-%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9/" class="post-meta-item leancloud_visitors" data-flag-title="Cpp-相关知识点" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/19/Cpp-%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/19/Cpp-%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><strong>阅读更多</strong></p>
<a id="more"></a>
<h1 id="1-标准库"><a class="markdownIt-Anchor" href="#1-标准库"></a> 1 标准库</h1>
<h2 id="11-stdfunction"><a class="markdownIt-Anchor" href="#11-stdfunction"></a> 1.1 std::function</h2>
<h2 id="12-stdbind"><a class="markdownIt-Anchor" href="#12-stdbind"></a> 1.2 std::bind</h2>
<h2 id="13-stdlock_guard"><a class="markdownIt-Anchor" href="#13-stdlock_guard"></a> 1.3 std::lock_guard</h2>
<p>一般的使用方法，如果getVar方法抛出异常了，那么就会导致<code>m.unlock()</code>方法无法执行，可能会造成死锁</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mutex m;</span><br><span class="line">m.<span class="built_in">lock</span>();</span><br><span class="line">sharedVariable= <span class="built_in">getVar</span>();</span><br><span class="line">m.<span class="built_in">unlock</span>();</span><br></pre></td></tr></table></figure>
<p>一种优雅的方式是使用<code>std::lock_guard</code>，该对象的析构方法中会进行锁的释放，需要将串行部分放到一个<code>&#123;&#125;</code>中，当退出该作用域时，<code>std::lock_guard</code>对象会析构，并释放锁，在任何正常或异常情况下都能够释放锁</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  std::mutex m,</span><br><span class="line">  <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lockGuard</span><span class="params">(m)</span></span>;</span><br><span class="line">  sharedVariable= <span class="built_in">getVar</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="14-参考"><a class="markdownIt-Anchor" href="#14-参考"></a> 1.4 参考</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f191e88dcc80">C++11 中的std::function和std::bind</a></li>
</ul>
<h1 id="2-宏"><a class="markdownIt-Anchor" href="#2-宏"></a> 2 宏</h1>
<h2 id="21-do-while0-in-macros"><a class="markdownIt-Anchor" href="#21-do-while0-in-macros"></a> 2.1 do while(0) in macros</h2>
<p>考虑下面的宏定义</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> foo(x) bar(x); baz(x)</span></span><br></pre></td></tr></table></figure>
<p>然后我们调用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">foo</span>(wolf);</span><br></pre></td></tr></table></figure>
<p>会被展开为</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bar</span>(wolf); <span class="built_in">baz</span>(wolf);</span><br></pre></td></tr></table></figure>
<p>看起来没有问题，我们接着考虑另一个情况</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition) </span><br><span class="line">    <span class="built_in">foo</span>(wolf);</span><br></pre></td></tr></table></figure>
<p>会被展开为</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition) </span><br><span class="line">    <span class="built_in">bar</span>(wolf);</span><br><span class="line"><span class="built_in">baz</span>(wolf);</span><br></pre></td></tr></table></figure>
<p>这并不符合我们的预期，为了避免出现这种问题，需要用一个作用域将宏包围起来，避免语句的作用域发生偏移，于是我们进一步将宏表示为如下形式</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> foo(x) &#123; bar(x); baz(x); &#125;</span></span><br></pre></td></tr></table></figure>
<p>然后我们调用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition)</span><br><span class="line">    <span class="built_in">foo</span>(wolf);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">bin</span>(wolf);</span><br></pre></td></tr></table></figure>
<p>会被展开为</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition) &#123;</span><br><span class="line">    <span class="built_in">bar</span>(wolf);</span><br><span class="line">    <span class="built_in">baz</span>(wolf);</span><br><span class="line">&#125;; <span class="comment">// syntax error</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">bin</span>(wolf);</span><br></pre></td></tr></table></figure>
<p>最终，我们将宏优化成如下形式</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> foo(x) do &#123; bar(x); baz(x); &#125; while (0)</span></span><br></pre></td></tr></table></figure>
<h2 id="22-参考"><a class="markdownIt-Anchor" href="#22-参考"></a> 2.2 参考</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://hownot2code.com/2016/12/05/do-while-0-in-macros/">do {…} while (0) in macros</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/c/PRE10-C.+Wrap+multistatement+macros+in+a+do-while+loop">PRE10-C. Wrap multistatement macros in a do-while loop</a></li>
</ul>
<h1 id="3-三方库"><a class="markdownIt-Anchor" href="#3-三方库"></a> 3 三方库</h1>
<h2 id="31-头文件如何查找"><a class="markdownIt-Anchor" href="#31-头文件如何查找"></a> 3.1 头文件如何查找</h2>
<h2 id="32-参考"><a class="markdownIt-Anchor" href="#32-参考"></a> 3.2 参考</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/guotianqing/article/details/104224439">Linux下c/c++头文件和库文件的查找路径</a></li>
</ul>
<h1 id="4-make"><a class="markdownIt-Anchor" href="#4-make"></a> 4 Make</h1>
<p><strong>代码变成可执行文件，叫做编译<code>compile</code>；先编译这个，还是先编译那个（即编译的安排），叫做构建<code>build</code></strong></p>
<h2 id="41-makefile文件的格式"><a class="markdownIt-Anchor" href="#41-makefile文件的格式"></a> 4.1 Makefile文件的格式</h2>
<p><strong><code>Makefile</code>文件由一系列规则<code>rules</code>构成。每条规则的形式如下：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;target&gt; : &lt;prerequisites&gt; </span><br><span class="line">[tab]  &lt;commands&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>target</code>：目标，是必须的</li>
<li><code>prerequisites</code>：前置条件，不是必须的，但是<code>prerequisites</code>与<code>commands</code>至少有一个是必须的</li>
<li><code>commands</code>：即完成目标需要执行的命令，不是必须的，但是<code>prerequisites</code>与<code>commands</code>至少有一个是必须的</li>
</ul>
<h3 id="411-target"><a class="markdownIt-Anchor" href="#411-target"></a> 4.1.1 target</h3>
<p>一个目标<code>target</code>就构成一条规则。<strong>目标通常是文件名</strong>，指明<code>make</code>命令所要构建的对象。目标可以是一个文件名，也可以是多个文件名，之间用空格分隔</p>
<p><strong>除了文件名，目标还可以是某个操作的名字，这称为「伪目标」<code>phony target</code>，例如</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm *.o</span><br></pre></td></tr></table></figure>
<p>但是，项目中可能有名为<code>clean</code>的文件名，<code>make</code>发现<code>clean</code>文件已经存在，就认为没有必要重新构建了，因此可以明确声明「伪目标」</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: clean</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm *.o temp</span><br></pre></td></tr></table></figure>
<p><strong>如果<code>make</code>命令运行时没有指定目标，默认会执行<code>Makefile</code>文件的第一个目标</strong></p>
<h3 id="412-prerequisites"><a class="markdownIt-Anchor" href="#412-prerequisites"></a> 4.1.2 prerequisites</h3>
<p>前置条件通常是一组文件名，之间用空格分隔。它指定了目标是否重新构建的判断标准：只要有一个前置文件不存在，或者有过更新（前置文件的<code>last-modification</code>时间戳比目标的时间戳新），目标就需要重新构建</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">result.txt: source.txt</span></span><br><span class="line">    cp source.txt result.txt</span><br></pre></td></tr></table></figure>
<p>上面代码中，构建<code>result.txt</code>的前置条件是<code>source.txt</code>。如果当前目录中，<code>source.txt</code>已经存在，那么<code>make result.txt</code>可以正常运行，否则必须再写一条规则，来生成<code>source.txt</code></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">source.txt:</span></span><br><span class="line">    echo <span class="string">&quot;this is the source&quot;</span> &gt; source.txt</span><br></pre></td></tr></table></figure>
<p>连续执行两次<code>make result.txt</code>。第一次执行会先新建<code>source.txt</code>，然后再新建<code>result.txt</code>。第二次执行，<code>make</code>发现<code>source.txt</code>没有变动（时间戳晚于<code>result.txt</code>），就不会执行任何操作，<code>result.txt</code>也不会重新生成</p>
<p>如果需要生成多个文件，往往采用下面的写法</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">source: file1 file2 file3</span></span><br></pre></td></tr></table></figure>
<p>这样仅需要执行<code>make source</code>便可生成3个文件，而无需执行<code>make file1</code>、<code>make file2</code>、<code>make file3</code></p>
<h3 id="413-commands"><a class="markdownIt-Anchor" href="#413-commands"></a> 4.1.3 commands</h3>
<p>命令<code>commands</code>表示如何更新目标文件，由一行或多行的<code>shell</code>命令组成。它是构建目标的具体指令，它的运行结果通常就是生成目标文件</p>
<p>每行命令之前必须有一个<code>tab</code>键。如果想用其他键，可以用内置变量<code>.RECIPEPREFIX</code>声明</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.RECIPEPREFIX = &gt;</span><br><span class="line"><span class="section">all:</span></span><br><span class="line">&gt; echo Hello, world</span><br></pre></td></tr></table></figure>
<p><strong>需要注意的是，每行命令在一个单独的<code>shell</code>中执行。这些<code>shell</code>之间没有继承关系</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">var-lost:</span></span><br><span class="line">    <span class="keyword">export</span> foo=bar</span><br><span class="line">    echo <span class="string">&quot;foo=[$$foo]&quot;</span></span><br></pre></td></tr></table></figure>
<p>一个解决办法是将两行命令写在一行，中间用分号分隔</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">var-kept:</span></span><br><span class="line">    <span class="keyword">export</span> foo=bar; echo <span class="string">&quot;foo=[$$foo]&quot;</span></span><br></pre></td></tr></table></figure>
<p>另一个解决办法是在换行符前加反斜杠转义</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">var-kept:</span></span><br><span class="line">    <span class="keyword">export</span> foo=bar; \</span><br><span class="line">    echo <span class="string">&quot;foo=[$$foo]&quot;</span></span><br></pre></td></tr></table></figure>
<p>更好的方法是加上<code>.ONESHELL:</code>命令</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">.ONESHELL:</span></span><br><span class="line"><span class="section">var-kept:</span></span><br><span class="line">    <span class="keyword">export</span> foo=bar; </span><br><span class="line">    echo <span class="string">&quot;foo=[$$foo]&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="42-makefile文件的语法"><a class="markdownIt-Anchor" href="#42-makefile文件的语法"></a> 4.2 Makefile文件的语法</h2>
<h3 id="421-注释"><a class="markdownIt-Anchor" href="#421-注释"></a> 4.2.1 注释</h3>
<p>井号<code>#</code>在<code>Makefile</code>中表示注释</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这是注释</span></span><br><span class="line"><span class="section">result.txt: source.txt</span></span><br><span class="line">    <span class="comment"># 这是注释</span></span><br><span class="line">    cp source.txt result.txt <span class="comment"># 这也是注释</span></span><br></pre></td></tr></table></figure>
<h3 id="422-回声echoing"><a class="markdownIt-Anchor" href="#422-回声echoing"></a> 4.2.2 回声（echoing）</h3>
<p>正常情况下，<code>make</code>会打印每条命令，然后再执行，这就叫做回声<code>echoing</code></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">test:</span></span><br><span class="line">    <span class="comment"># 这是测试</span></span><br></pre></td></tr></table></figure>
<p>执行上面的规则，会得到下面的结果</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ make <span class="built_in">test</span></span><br><span class="line"><span class="comment"># 这是测试</span></span><br></pre></td></tr></table></figure>
<p>在命令的前面加上<code>@</code>，就可以关闭回声</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">test:</span></span><br><span class="line">    @<span class="comment"># 这是测试</span></span><br></pre></td></tr></table></figure>
<h3 id="423-通配符"><a class="markdownIt-Anchor" href="#423-通配符"></a> 4.2.3 通配符</h3>
<p>通配符<code>wildcard</code>用来指定一组符合条件的文件名。<code>Makefile</code>的通配符与 <code>Bash</code>一致，主要有星号<code>*</code>、问号<code>？</code>和<code>...</code>。比如，<code>*.o</code>表示所有后缀名为<code>o</code>的文件</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">clean:</span></span><br><span class="line">        rm -f *.o</span><br></pre></td></tr></table></figure>
<h3 id="424-模式匹配"><a class="markdownIt-Anchor" href="#424-模式匹配"></a> 4.2.4 模式匹配</h3>
<p><code>make</code>命令允许对文件名，进行类似正则运算的匹配，主要用到的匹配符是<code>%</code>。比如，假定当前目录下有<code>f1.c</code>和<code>f2.c</code>两个源码文件，需要将它们编译为对应的对象文件</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%.o: %.c</span></span><br></pre></td></tr></table></figure>
<p>等同于下面的写法</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">f1.o: f1.c</span></span><br><span class="line"><span class="section">f2.o: f2.c</span></span><br></pre></td></tr></table></figure>
<p><strong>使用匹配符<code>%</code>，可以将大量同类型的文件，只用一条规则就完成构建</strong></p>
<h3 id="425-变量和赋值符"><a class="markdownIt-Anchor" href="#425-变量和赋值符"></a> 4.2.5 变量和赋值符</h3>
<p><code>Makefile</code>允许使用等号自定义变量</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">txt = Hello World</span><br><span class="line"><span class="section">test:</span></span><br><span class="line">    @echo <span class="variable">$(txt)</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，变量<code>txt</code>等于<code>Hello World</code>。<strong>调用时，变量需要放在<code>$()</code>之中</strong></p>
<p><strong>调用<code>shell</code>变量，需要在<code>$</code>前，再加一个<code>$</code>，这是因为<code>make</code>命令会对<code>$</code>转义</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">test:</span></span><br><span class="line">    @echo $$HOME</span><br></pre></td></tr></table></figure>
<h3 id="426-内置变量implicit-variables"><a class="markdownIt-Anchor" href="#426-内置变量implicit-variables"></a> 4.2.6 内置变量（Implicit Variables）</h3>
<p><code>make</code>命令提供一系列内置变量，比如，<code>$(CC)</code>指向当前使用的编译器，<code>$(MAKE)</code>指向当前使用的<code>make</code>工具。这主要是为了跨平台的兼容性，详细的内置变量清单见<a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Implicit-Variables.html">手册</a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">output:</span></span><br><span class="line">    <span class="variable">$(CC)</span> -o output input.c</span><br></pre></td></tr></table></figure>
<h3 id="427-自动变量automatic-variables"><a class="markdownIt-Anchor" href="#427-自动变量automatic-variables"></a> 4.2.7 自动变量（Automatic Variables）</h3>
<p><code>make</code>命令还提供一些自动变量，它们的值与当前规则有关。主要有以下几个，可以参考<a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html">手册</a></p>
<h4 id="4271"><a class="markdownIt-Anchor" href="#4271"></a> 4.2.7.1 <code>$@</code></h4>
<p><code>$@</code>指代当前目标，就是<code>make</code>命令当前构建的那个目标。比如，<code>make foo</code>的<code>$@</code>就指代<code>foo</code></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.txt b.txt: </span><br><span class="line">    touch <span class="variable">$@</span></span><br></pre></td></tr></table></figure>
<p>等同于下面的写法</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">a.txt:</span></span><br><span class="line">    touch a.txt</span><br><span class="line"><span class="section">b.txt:</span></span><br><span class="line">    touch b.txt</span><br></pre></td></tr></table></figure>
<h4 id="4272"><a class="markdownIt-Anchor" href="#4272"></a> 4.2.7.2 <code>$&lt;</code></h4>
<p><code>$&lt;</code>指代第一个前置条件。比如，规则为<code>t: p1 p2</code>，那么<code>$&lt;</code>就指代<code>p1</code></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">a.txt: b.txt c.txt</span></span><br><span class="line">    cp <span class="variable">$&lt;</span> <span class="variable">$@</span> </span><br></pre></td></tr></table></figure>
<p>等同于下面的写法</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">a.txt: b.txt c.txt</span></span><br><span class="line">    cp b.txt a.txt </span><br></pre></td></tr></table></figure>
<h4 id="4273"><a class="markdownIt-Anchor" href="#4273"></a> 4.2.7.3 <code>$?</code></h4>
<p><code>$?</code>指代比目标更新的所有前置条件，之间以空格分隔。比如，规则为<code>t: p1 p2</code>，其中<code>p2</code>的时间戳比<code>t</code>新，<code>$?</code>就指代<code>p2</code></p>
<h4 id="4274"><a class="markdownIt-Anchor" href="#4274"></a> 4.2.7.4 <code>$^</code></h4>
<p><code>$^</code>指代所有前置条件，之间以空格分隔。比如，规则为<code>t: p1 p2</code>，那么<code>$^</code>就指代<code>p1 p2</code></p>
<h4 id="4275"><a class="markdownIt-Anchor" href="#4275"></a> 4.2.7.5 <code>$*</code></h4>
<p><code>$*</code>指代匹配符<code>%</code>匹配的部分，比如<code>%.txt</code>匹配<code>f1.txt</code>中的<code>f1</code>，<code>$*</code>就表示<code>f1</code></p>
<h4 id="4276-df"><a class="markdownIt-Anchor" href="#4276-df"></a> 4.2.7.6 <code>$(@D)/$(@F)</code></h4>
<p><code>$(@D)</code>和<code>$(@F)</code>分别指向<code>$@</code>的目录名和文件名。比如，<code>$@</code>是<code>src/input.c</code>，那么<code>$(@D)</code>的值为<code>src</code>，<code>$(@F)</code>的值为<code>input.c</code></p>
<h4 id="4277-df"><a class="markdownIt-Anchor" href="#4277-df"></a> 4.2.7.7 <code>$(&lt;D)/$(&lt;F)</code></h4>
<p><code>$(&lt;D)</code>和<code>$(&lt;F)</code>分别指向<code>$&lt;</code>的目录名和文件名</p>
<h4 id="4278-例子"><a class="markdownIt-Anchor" href="#4278-例子"></a> 4.2.7.8 例子</h4>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">dest/%.txt: src/%.txt</span></span><br><span class="line">    @[ -d dest ] || mkdir dest</span><br><span class="line">    cp <span class="variable">$&lt;</span> <span class="variable">$@</span></span><br></pre></td></tr></table></figure>
<p>上面代码将<code>src</code>目录下的<code>txt</code>文件，拷贝到<code>dest</code>目录下。首先判断<code>dest</code>目录是否存在，如果不存在就新建，然后，<code>$&lt;</code>指代前置文件<code>src/%.txt</code>，<code>$@</code>指代目标文件<code>dest/%.txt</code></p>
<h3 id="428-判断和循环"><a class="markdownIt-Anchor" href="#428-判断和循环"></a> 4.2.8 判断和循环</h3>
<p><code>Makefile</code>使用<code>Bash</code>语法，完成判断和循环</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(CC)</span>,gcc)</span><br><span class="line">  libs=<span class="variable">$(libs_for_gcc)</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  libs=<span class="variable">$(normal_libs)</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">LIST = one two three</span><br><span class="line"><span class="section">all:</span></span><br><span class="line">    for i in <span class="variable">$(LIST)</span>; do \</span><br><span class="line">        echo $$i; \</span><br><span class="line">    done</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等同于</span></span><br><span class="line"></span><br><span class="line"><span class="section">all:</span></span><br><span class="line">    for i in one two three; do \</span><br><span class="line">        echo $$i; \</span><br><span class="line">    done</span><br></pre></td></tr></table></figure>
<h3 id="429-函数"><a class="markdownIt-Anchor" href="#429-函数"></a> 4.2.9 函数</h3>
<p><code>Makefile</code>还可以使用函数，格式如下</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(function arguments)</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">$&#123;function arguments&#125;</span><br></pre></td></tr></table></figure>
<p><code>Makefile</code>提供了许多<a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Functions.html">内置函数</a>，可供调用</p>
<h2 id="43-参考"><a class="markdownIt-Anchor" href="#43-参考"></a> 4.3 参考</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2015/02/make.html">Make 命令教程</a></li>
</ul>
<h1 id="5-cmake"><a class="markdownIt-Anchor" href="#5-cmake"></a> 5 CMake</h1>
<h2 id="51-tutorial"><a class="markdownIt-Anchor" href="#51-tutorial"></a> 5.1 tutorial</h2>
<h3 id="511-step1-a-basic-starting-point"><a class="markdownIt-Anchor" href="#511-step1-a-basic-starting-point"></a> 5.1.1 step1: A Basic Starting Point</h3>
<p><code>tutorial.cxx</code>内容如下：</p>
<h2 id="-code40-"><a class="markdownIt-Anchor" href="#-code40-"></a> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; number&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// convert input to double</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> inputValue = <span class="built_in">atof</span>(argv[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// calculate square root</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> outputValue = <span class="built_in">sqrt</span>(inputValue);</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;The square root of &quot;</span> &lt;&lt; inputValue &lt;&lt; <span class="string">&quot; is &quot;</span> &lt;&lt; outputValue</span><br><span class="line">            &lt;&lt; std::endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2>
<p><code>CMakeLists.txt</code>内容如下：</p>
<ul>
<li><code>cmake_minimum_required</code>：用于指定<code>cmake</code>的最小版本，避免出现兼容性问题（包含了高级版本的特性，但是实际的<code>cmake</code>版本较小）</li>
<li><code>project</code>：用于设置项目名称，并存储到<code>CMAKE_PROJECT_NAME</code>变量中，<code>cmake</code>中的一些环境变量会以这里指定的项目名称作为前缀，例如
<ul>
<li><code>PROJECT_SOURCE_DIR</code>、<code>&lt;PROJECT-NAME&gt;_SOURCE_DIR</code></li>
<li><code>PROJECT_BINARY_DIR</code>、<code>&lt;PROJECT-NAME&gt;_BINARY_DIR</code></li>
</ul>
</li>
<li><code>set</code>：用于设置一些变量</li>
<li><code>add_executable</code>：添加目标可执行文件</li>
</ul>
<h2 id="-code41-"><a class="markdownIt-Anchor" href="#-code41-"></a> <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># set the project name and version</span></span><br><span class="line"><span class="keyword">project</span>(Tutorial VERSION <span class="number">1.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># specify the C++ standard</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the executable</span></span><br><span class="line"><span class="keyword">add_executable</span>(Tutorial tutorial.cxx)</span><br></pre></td></tr></table></figure></h2>
<p>此时文件结构如下：</p>
<h2 id="-code42-"><a class="markdownIt-Anchor" href="#-code42-"></a> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">└── tutorial.cxx</span><br></pre></td></tr></table></figure></h2>
<p>测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">./Tutorial 256</span><br></pre></td></tr></table></figure>
<h3 id="512-step2-adding-a-library-and-adding-usage-requirements-for-a-library"><a class="markdownIt-Anchor" href="#512-step2-adding-a-library-and-adding-usage-requirements-for-a-library"></a> 5.1.2 step2: Adding a Library and Adding Usage Requirements for a Library</h3>
<p>接下来，我们用自己实现的求开方的函数替换标准库中的实现。创建<code>MathFunctions</code>子目录，并在该子目录添加<code>MathFunctions.h</code>以及<code>mysqrt.cxx</code>、<code>CMakeLists.txt</code>三个文件</p>
<p><code>MathFunctions/MathFunctions.h</code>内容如下：</p>
<h2 id="-code44-"><a class="markdownIt-Anchor" href="#-code44-"></a> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">mysqrt</span><span class="params">(<span class="keyword">double</span> x)</span></span>;</span><br></pre></td></tr></table></figure></h2>
<p><code>MathFunctions/mysqrt.cxx</code>内容如下：</p>
<h2 id="-code45-"><a class="markdownIt-Anchor" href="#-code45-"></a> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// a hack square root calculation using simple operations</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">mysqrt</span><span class="params">(<span class="keyword">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">double</span> result = x;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// do ten iterations</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (result &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      result = <span class="number">0.1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">double</span> delta = x - (result * result);</span><br><span class="line">    result = result + <span class="number">0.5</span> * delta / result;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Computing sqrt of &quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot; to be &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2>
<p><code>MathFunctions/CMakeLists.txt</code>内容如下：</p>
<h2 id="-code46-"><a class="markdownIt-Anchor" href="#-code46-"></a> <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(MathFunctions mysqrt.cxx)</span><br></pre></td></tr></table></figure></h2>
<p>添加<code>TutorialConfig.h.in</code>文件，内容如下：</p>
<h2 id="-code47-"><a class="markdownIt-Anchor" href="#-code47-"></a> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#cmakedefine USE_MYMATH</span></span><br></pre></td></tr></table></figure></h2>
<p>修改<code>tutorial.cxx</code>文件，内容如下：</p>
<h2 id="-code48-"><a class="markdownIt-Anchor" href="#-code48-"></a> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;TutorialConfig.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> USE_MYMATH</span></span><br><span class="line"><span class="meta">#  <span class="meta-keyword">include</span> <span class="meta-string">&quot;MathFunctions.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; number&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// convert input to double</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> inputValue = <span class="built_in">atof</span>(argv[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// calculate square root</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> USE_MYMATH</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> outputValue = <span class="built_in">mysqrt</span>(inputValue);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> outputValue = <span class="built_in">sqrt</span>(inputValue);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;The square root of &quot;</span> &lt;&lt; inputValue &lt;&lt; <span class="string">&quot; is &quot;</span> &lt;&lt; outputValue</span><br><span class="line">            &lt;&lt; std::endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2>
<p>修改<code>CMakeLists.txt</code>文件，内容如下：</p>
<ul>
<li><code>option</code>：用于添加<code>cmake</code>选项，可以通过<code>-D&lt;OPTION-NAME&gt;=ON/OFF</code>参数来选择打开或者关闭该选项
<ul>
<li>例如<code>cmake .. -DUSE_MYMATH=OFF</code></li>
</ul>
</li>
<li><code>configure_file</code>：一般用于根据cmake选项动态生成头文件</li>
<li><code>if statement</code>：控制流</li>
<li><code>add_subdirectory</code>：用于将子目录添加到构建任务中</li>
<li><code>list</code>：容器相关的操作</li>
<li><code>target_link_libraries</code>：指定库文件</li>
<li><code>target_include_directories</code>：指定头文件搜索路径</li>
</ul>
<h2 id="-code49-"><a class="markdownIt-Anchor" href="#-code49-"></a> <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># set the project name and version</span></span><br><span class="line"><span class="keyword">project</span>(Tutorial VERSION <span class="number">1.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># specify the C++ standard</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span>(USE_MYMATH <span class="string">&quot;Use tutorial provided math implementation&quot;</span> <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># configure a header file to pass some of the CMake settings</span></span><br><span class="line"><span class="comment"># to the source code</span></span><br><span class="line"><span class="keyword">configure_file</span>(TutorialConfig.h.in TutorialConfig.h)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(USE_MYMATH)</span><br><span class="line">  <span class="keyword">add_subdirectory</span>(MathFunctions)</span><br><span class="line">  <span class="keyword">list</span>(APPEND EXTRA_LIBS MathFunctions)</span><br><span class="line">  <span class="keyword">list</span>(APPEND EXTRA_INCLUDES <span class="string">&quot;$&#123;PROJECT_SOURCE_DIR&#125;/MathFunctions&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the executable</span></span><br><span class="line"><span class="keyword">add_executable</span>(Tutorial tutorial.cxx)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(Tutorial PUBLIC <span class="variable">$&#123;EXTRA_LIBS&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the binary tree to the search path for include files</span></span><br><span class="line"><span class="comment"># so that we will find TutorialConfig.h</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(Tutorial PUBLIC</span><br><span class="line">                           <span class="string">&quot;$&#123;PROJECT_BINARY_DIR&#125;&quot;</span></span><br><span class="line">                           <span class="variable">$&#123;EXTRA_INCLUDES&#125;</span></span><br><span class="line">                           )</span><br></pre></td></tr></table></figure></h2>
<p>此时目录结构如下：</p>
<h2 id="-code50-"><a class="markdownIt-Anchor" href="#-code50-"></a> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── MathFunctions</span><br><span class="line">│   ├── CMakeLists.txt</span><br><span class="line">│   ├── MathFunctions.h</span><br><span class="line">│   └── mysqrt.cxx</span><br><span class="line">├── TutorialConfig.h.in</span><br><span class="line">└── tutorial.cxx</span><br></pre></td></tr></table></figure></h2>
<p>测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用的是自定义的sqrt函数</span></span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">./Tutorial 256</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用的是标准库的sqrt函数</span></span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DUSE_MYMATH=OFF</span><br><span class="line">make</span><br><span class="line">./Tutorial 256</span><br></pre></td></tr></table></figure>
<h3 id="513-step3-installing"><a class="markdownIt-Anchor" href="#513-step3-installing"></a> 5.1.3 step3: Installing</h3>
<p>现在，我们要安装<code>make</code>后产生的二进制、库文件、头文件</p>
<p>在<code>step2</code>的基础上，修改<code>MathFunctions/CMakeLists.txt</code>文件，追加如下内容：</p>
<ul>
<li>其中这里指定了两个相对路径<code>lib</code>、<code>include</code>。前缀由<code>cmake</code>变量<code>CMAKE_INSTALL_PREFIX</code>确定，默认值为<code>/usr/local</code></li>
</ul>
<h2 id="-code52-"><a class="markdownIt-Anchor" href="#-code52-"></a> <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add the install targets</span></span><br><span class="line"><span class="keyword">install</span> (TARGETS MathFunctions DESTINATION bin)</span><br><span class="line"><span class="keyword">install</span>(FILES MathFunctions.h DESTINATION <span class="keyword">include</span>)</span><br></pre></td></tr></table></figure></h2>
<p>在<code>step2</code>的基础上，修改<code>CMakeLists.txt</code>文件，追加如下内容：</p>
<h2 id="-code53-"><a class="markdownIt-Anchor" href="#-code53-"></a> <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add the install targets</span></span><br><span class="line"><span class="keyword">install</span> (TARGETS Tutorial DESTINATION bin)</span><br><span class="line"><span class="keyword">install</span> (FILES <span class="string">&quot;$&#123;PROJECT_BINARY_DIR&#125;/TutorialConfig.h&quot;</span> DESTINATION <span class="keyword">include</span>)</span><br></pre></td></tr></table></figure></h2>
<p>测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用默认的安装路径</span></span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定安装路径</span></span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=/tmp/mydir</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h3 id="514-step4-testing"><a class="markdownIt-Anchor" href="#514-step4-testing"></a> 5.1.4 step4: Testing</h3>
<p>接下来，增加测试功能。在<code>step2</code>的基础上，修改<code>CMakeLists.txt</code>文件，追加如下内容：</p>
<ul>
<li><code>add_test</code>：用于增加测试，其中<code>NAME</code>指定的是测试用例的名称，<code>RUN</code>指定的是测试的命令</li>
<li><code>function</code>：用于定义一个方法</li>
<li><code>set_tests_properties</code>：用于设置测试项的属性，这里指定了测试结果的通配符</li>
</ul>
<h2 id="-code55-"><a class="markdownIt-Anchor" href="#-code55-"></a> <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enable_testing</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># does the application run</span></span><br><span class="line"><span class="keyword">add_test</span>(NAME Runs <span class="keyword">COMMAND</span> Tutorial <span class="number">25</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># does the usage message work?</span></span><br><span class="line"><span class="keyword">add_test</span>(NAME Usage <span class="keyword">COMMAND</span> Tutorial)</span><br><span class="line"><span class="keyword">set_tests_properties</span>(Usage</span><br><span class="line">  PROPERTIES PASS_REGULAR_EXPRESSION <span class="string">&quot;Usage:.*number&quot;</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment"># define a function to simplify adding tests</span></span><br><span class="line"><span class="keyword">function</span>(do_test <span class="keyword">target</span> arg result)</span><br><span class="line">  <span class="keyword">add_test</span>(NAME Comp_<span class="variable">$&#123;arg&#125;</span> <span class="keyword">COMMAND</span> <span class="variable">$&#123;target&#125;</span> <span class="variable">$&#123;arg&#125;</span>)</span><br><span class="line">  <span class="keyword">set_tests_properties</span>(Comp_<span class="variable">$&#123;arg&#125;</span></span><br><span class="line">    PROPERTIES PASS_REGULAR_EXPRESSION <span class="variable">$&#123;result&#125;</span></span><br><span class="line">    )</span><br><span class="line"><span class="keyword">endfunction</span>(do_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># do a bunch of result based tests</span></span><br><span class="line">do_test(Tutorial <span class="number">4</span> <span class="string">&quot;4 is 2&quot;</span>)</span><br><span class="line">do_test(Tutorial <span class="number">9</span> <span class="string">&quot;9 is 3&quot;</span>)</span><br><span class="line">do_test(Tutorial <span class="number">5</span> <span class="string">&quot;5 is 2.236&quot;</span>)</span><br><span class="line">do_test(Tutorial <span class="number">7</span> <span class="string">&quot;7 is 2.645&quot;</span>)</span><br><span class="line">do_test(Tutorial <span class="number">25</span> <span class="string">&quot;25 is 5&quot;</span>)</span><br><span class="line">do_test(Tutorial -<span class="number">25</span> <span class="string">&quot;-25 is [-nan|nan|0]&quot;</span>)</span><br><span class="line">do_test(Tutorial <span class="number">0.0001</span> <span class="string">&quot;0.0001 is 0.01&quot;</span>)</span><br></pre></td></tr></table></figure></h2>
<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">make test</span><br></pre></td></tr></table></figure>
<h3 id="515-step5-adding-system-introspection"><a class="markdownIt-Anchor" href="#515-step5-adding-system-introspection"></a> 5.1.5 step5: Adding System Introspection</h3>
<p>同一个库，在不同平台上的实现可能不同，例如A平台有方法<code>funcA</code>，而B平台没有<code>funcA</code>，因此我们需要有一种机制来检测这种差异</p>
<p>接下来，增加测试功能。在<code>step2</code>的基础上，修改<code>MathFunctions/CMakeLists.txt</code>文件，追加如下内容：</p>
<ul>
<li><code>include</code>：加载<code>cmake</code>模块，这里加载了<code>CheckSymbolExists</code>模块，该模块用于检测指定文件中的指定符号是否存在</li>
</ul>
<h2 id="-code57-"><a class="markdownIt-Anchor" href="#-code57-"></a> <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(CheckSymbolExists)</span><br><span class="line">check_symbol_exists(log <span class="string">&quot;math.h&quot;</span> HAVE_LOG)</span><br><span class="line">check_symbol_exists(exp <span class="string">&quot;math.h&quot;</span> HAVE_EXP)</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> (HAVE_LOG <span class="keyword">AND</span> HAVE_EXP))</span><br><span class="line">  <span class="keyword">unset</span>(HAVE_LOG CACHE)</span><br><span class="line">  <span class="keyword">unset</span>(HAVE_EXP CACHE)</span><br><span class="line">  <span class="keyword">set</span>(CMAKE_REQUIRED_LIBRARIES <span class="string">&quot;m&quot;</span>)</span><br><span class="line">  check_symbol_exists(log <span class="string">&quot;math.h&quot;</span> HAVE_LOG)</span><br><span class="line">  check_symbol_exists(exp <span class="string">&quot;math.h&quot;</span> HAVE_EXP)</span><br><span class="line">  <span class="keyword">if</span>(HAVE_LOG <span class="keyword">AND</span> HAVE_EXP)</span><br><span class="line">    <span class="keyword">target_link_libraries</span>(MathFunctions PRIVATE m)</span><br><span class="line">  <span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(HAVE_LOG <span class="keyword">AND</span> HAVE_EXP)</span><br><span class="line">  <span class="keyword">target_compile_definitions</span>(MathFunctions</span><br><span class="line">                             PRIVATE <span class="string">&quot;HAVE_LOG&quot;</span> <span class="string">&quot;HAVE_EXP&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure></h2>
<p>修改<code>MathFunctions/mysqrt.cxx</code>文件，内容如下：</p>
<h2 id="-code58-"><a class="markdownIt-Anchor" href="#-code58-"></a> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// a hack square root calculation using simple operations</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">mysqrt</span><span class="params">(<span class="keyword">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(HAVE_LOG) &amp;&amp; defined(HAVE_EXP)</span></span><br><span class="line">  <span class="keyword">double</span> result = <span class="built_in">exp</span>(<span class="built_in">log</span>(x) * <span class="number">0.5</span>);</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Computing sqrt of &quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot; to be &quot;</span> &lt;&lt; result</span><br><span class="line">            &lt;&lt; <span class="string">&quot; using log and exp&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  <span class="keyword">double</span> result = x;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// do ten iterations</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (result &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      result = <span class="number">0.1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">double</span> delta = x - (result * result);</span><br><span class="line">    result = result + <span class="number">0.5</span> * delta / result;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Computing sqrt of &quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot; to be &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2>
<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">./Tutorial 25</span><br></pre></td></tr></table></figure>
<h2 id="52-target"><a class="markdownIt-Anchor" href="#52-target"></a> 5.2 target</h2>
<p><code>cmake</code>可以使用<code>add_executable</code>、<code>add_library</code>或<code>add_custom_target</code>等命令来定义目标<code>target</code>。与变量不同，目标在每个作用域都可见，且可以使用<code>get_property</code>和<code>set_property</code>获取或设置其属性</p>
<h2 id="53-property"><a class="markdownIt-Anchor" href="#53-property"></a> 5.3 property</h2>
<h3 id="531-include_directories"><a class="markdownIt-Anchor" href="#531-include_directories"></a> 5.3.1 INCLUDE_DIRECTORIES</h3>
<ol>
<li><code>include_directories</code>：该方法会在全局维度添加<code>include</code>的搜索路径。这些搜索路径会被添加到所有<code>target</code>中去（包括所有<code>sub target</code>），会追加到所有<code>target</code>的<code>INCLUDE_DIRECTORIES</code>属性中去</li>
<li><code>target_include_directories</code>：该方法为指定<code>target</code>添加<code>include</code>的搜索路径，会追加到该<code>target</code>的<code>INCLUDE_DIRECTORIES</code>属性中去</li>
</ol>
<p>如何查看全局维度以及target维度的<code>INCLUDE_DIRECTORIES</code>属性值</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get_property</span>(dirs DIRECTORY <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span> PROPERTY <span class="keyword">INCLUDE_DIRECTORIES</span>)</span><br><span class="line"><span class="keyword">foreach</span>(dir <span class="variable">$&#123;dirs&#125;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;dir of include_directories=&#x27;$&#123;dir&#125;&#x27;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">get_target_property</span>(target_dirs &lt;<span class="keyword">TARGET</span>-NAME&gt; <span class="keyword">INCLUDE_DIRECTORIES</span>)</span><br><span class="line"><span class="keyword">foreach</span>(target_dir <span class="variable">$&#123;target_dirs&#125;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;dir of target_include_directories=&#x27;$&#123;target_dir&#125;&#x27;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>
<h2 id="54-command"><a class="markdownIt-Anchor" href="#54-command"></a> 5.4 command</h2>
<h3 id="541-message"><a class="markdownIt-Anchor" href="#541-message"></a> 5.4.1 message</h3>
<p>用于打印信息</p>
<p>格式：<code>message([&lt;mode&gt;] &quot;message text&quot; ...)</code></p>
<p>合法的<code>mode</code>包括</p>
<ul>
<li><code>FATAL_ERROR</code>：致命错误，终止构建</li>
<li><code>SEND_ERROR</code>：继续构建，终止<code>generation</code></li>
<li><code>WARNING</code>：告警信息，继续构建</li>
<li><code>AUTHOR_WARNING</code>：告警信息，继续构建</li>
<li><code>DEPRECATION</code>：当<code>CMAKE_ERROR_DEPRECATED</code>或<code>CMAKE_WARN_DEPRECATED</code>参数启用时，若使用了<code>deprecated</code>的特性，会打印<code>error</code>或者<code>warn</code>信息</li>
<li><code>NOTICE</code>：通过<code>stderr</code>打印的信息</li>
<li><strong><code>STATUS</code>：用户最应该关注的信息</strong></li>
<li><code>VERBOSE</code>：项目构建者需要关注的信息</li>
<li><code>DEBUG</code>：项目调试需要关注的信息</li>
<li><code>TRACE</code>：最低级别的信息</li>
</ul>
<h3 id="542-set"><a class="markdownIt-Anchor" href="#542-set"></a> 5.4.2 set</h3>
<p><code>set</code>用于设置：<code>cmake</code>变量或环境变量</p>
<p>格式：</p>
<ul>
<li><code>cmake</code>变量：<code>set(&lt;variable&gt; &lt;value&gt;... [PARENT_SCOPE])</code></li>
<li>环境变量：<code>set(ENV&#123;&lt;variable&gt;&#125; [&lt;value&gt;]</code></li>
</ul>
<p>变量如何引用：</p>
<ul>
<li><code>cmake</code>变量：<code>$&#123;&lt;variable&gt;&#125;</code></li>
<li>环境变量：<code>$ENV&#123;&lt;variable&gt;&#125;</code></li>
</ul>
<h3 id="543-option"><a class="markdownIt-Anchor" href="#543-option"></a> 5.4.3 option</h3>
<p><code>option</code>用于设置构建选项</p>
<p>格式：<code>option(&lt;variable&gt; &quot;&lt;help_text&gt;&quot; [value])</code></p>
<ul>
<li>其中<code>value</code>的可选值就是<code>ON</code>和<code>OFF</code>，其中<code>OFF</code>是默认值</li>
</ul>
<h3 id="544-find_package"><a class="markdownIt-Anchor" href="#544-find_package"></a> 5.4.4 find_package</h3>
<p><strong>本小节转载摘录自<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/97369704">Cmake之深入理解find_package()的用法</a></strong></p>
<p>为了方便我们在项目中引入外部依赖包，<code>cmake</code>官方为我们预定义了许多寻找依赖包的<code>Module</code>，他们存储在<code>path_to_your_cmake/share/cmake-&lt;version&gt;/Modules</code>目录下。每个以<code>Find&lt;LibaryName&gt;.cmake</code>命名的文件都可以帮我们找到一个包。<strong>注意，<code>find_package(&lt;LibaryName&gt;)</code>与<code>Find&lt;LibaryName&gt;.cmake</code>中的<code>&lt;LibaryName&gt;</code>部分，大小写必须完全一致</strong></p>
<p>我们以<code>curl</code>库为例，假设我们项目需要引入这个库，从网站中请求网页到本地，我们看到官方已经定义好了<code>FindCURL.cmake</code>。所以我们在<code>CMakeLists.txt</code>中可以直接用<code>find_pakcage</code>进行引用</p>
<p>对于系统预定义的<code>Find&lt;LibaryName&gt;.cmake</code>模块，使用方法如下，每一个模块都会定义以下几个变量（这些信息会在<code>Find&lt;LibaryName&gt;.cmake</code>文件的最上方注释中说明）。<strong>注意，这些变量命名只是规范，命名中<code>&lt;LibaryName&gt;</code>部分是全部大写还是包含大小写完全由<code>Find&lt;LibaryName&gt;.cmake</code>文件决定。一般来说是大写的，例如<code>FindDemo.cmake</code>中定义的变量名为<code>DEMO_FOUND</code></strong></p>
<ul>
<li><code>&lt;LibaryName&gt;_FOUND</code></li>
<li><code>&lt;LibaryName&gt;_INCLUDE_DIR</code></li>
<li><code>&lt;LibaryName&gt;_LIBRARY</code></li>
<li><code>&lt;LibaryName&gt;_STATIC_LIB</code></li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(CURL)</span><br><span class="line"><span class="keyword">add_executable</span>(curltest curltest.cc)</span><br><span class="line"><span class="keyword">if</span>(CURL_FOUND)</span><br><span class="line">    <span class="keyword">target_include_directories</span>(clib PRIVATE <span class="variable">$&#123;CURL_INCLUDE_DIR&#125;</span>)</span><br><span class="line">    <span class="keyword">target_link_libraries</span>(curltest <span class="variable">$&#123;CURL_LIBRARY&#125;</span>)</span><br><span class="line"><span class="keyword">else</span>(CURL_FOUND)</span><br><span class="line">    <span class="keyword">message</span>(FATAL_ERROR ”CURL library <span class="keyword">not</span> found”)</span><br><span class="line"><span class="keyword">endif</span>(CURL_FOUND)</span><br></pre></td></tr></table></figure>
<p>你可以通过<code>&lt;LibaryName&gt;_FOUND</code>来判断模块是否被找到，如果没有找到，按照工程的需要关闭某些特性、给出提醒或者中止编译，上面的例子就是报出致命错误并终止构建。如果<code>&lt;LibaryName&gt;_FOUND</code>为真，则将<code>&lt;LibaryName&gt;_INCLUDE_DIR</code>加入<code>INCLUDE_DIRECTORIES</code></p>
<h4 id="5441-引入非官方的库"><a class="markdownIt-Anchor" href="#5441-引入非官方的库"></a> 5.4.4.1 引入非官方的库</h4>
<p><strong>通过<code>find_package</code>引入非官方的库，该方式只对支持cmake编译安装的库有效</strong></p>
<p>假设此时我们需要引入<code>glog</code>库来进行日志的记录，我们在<code>Module</code>目录下并没有找到<code>FindGlog.cmake</code>。所以我们需要自行安装<code>glog</code>库，再进行引用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clone该项目</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/google/glog.git </span><br><span class="line"><span class="comment"># 切换到需要的版本 </span></span><br><span class="line"><span class="built_in">cd</span> glog</span><br><span class="line">git checkout v0.40  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据官网的指南进行安装</span></span><br><span class="line">cmake -H. -Bbuild -G <span class="string">&quot;Unix Makefiles&quot;</span></span><br><span class="line">cmake --build build</span><br><span class="line">cmake --build build --target install</span><br></pre></td></tr></table></figure>
<p>此时我们便可以通过与引入<code>curl</code>库一样的方式引入<code>glog</code>库了</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(GLOG)</span><br><span class="line"><span class="keyword">add_executable</span>(glogtest glogtest.cc)</span><br><span class="line"><span class="keyword">if</span>(GLOG_FOUND)</span><br><span class="line">    <span class="comment"># 由于glog在连接时将头文件直接链接到了库里面，所以这里不用显示调用target_include_directories</span></span><br><span class="line">    <span class="keyword">target_link_libraries</span>(glogtest glog::glog)</span><br><span class="line"><span class="keyword">else</span>(GLOG_FOUND)</span><br><span class="line">    <span class="keyword">message</span>(FATAL_ERROR ”GLOG library <span class="keyword">not</span> found”)</span><br><span class="line"><span class="keyword">endif</span>(GLOG_FOUND)</span><br></pre></td></tr></table></figure>
<h4 id="5442-module模式与config模式"><a class="markdownIt-Anchor" href="#5442-module模式与config模式"></a> 5.4.4.2 Module模式与Config模式</h4>
<p>通过上文我们了解了通过<code>cmake</code>引入依赖库的基本用法。知其然也要知其所以然，<code>find_package</code>对我们来说是一个黑盒子，那么它是具体通过什么方式来查找到我们依赖的库文件的路径的呢。到这里我们就不得不聊到<code>find_package</code>的两种模式，一种是<code>Module</code>模式，也就是我们引入<code>curl</code>库的方式。另一种叫做<code>Config</code>模式，也就是引入<code>glog</code>库的模式。下面我们来详细介绍着两种方式的运行机制</p>
<p>在<code>Module</code>模式中，<code>cmake</code>需要找到一个叫做<code>Find&lt;LibraryName&gt;.cmake</code>的文件。这个文件负责找到库所在的路径，为我们的项目引入头文件路径和库文件路径。<code>cmake</code>搜索这个文件的路径有两个，一个是上文提到的<code>cmake</code>安装目录下的<code>share/cmake-&lt;version&gt;/Modules</code>目录，另一个使我们指定的<code>CMAKE_MODULE_PATH</code>的所在目录</p>
<p>如果<code>Module</code>模式搜索失败，没有找到对应的<code>Find&lt;LibraryName&gt;.cmake</code>文件，则转入<code>Config</code>模式进行搜索。它主要通过<code>&lt;LibraryName&gt;Config.cmake</code>或<code>&lt;lower-case-package-name&gt;-config.cmake</code>这两个文件来引入我们需要的库。以我们刚刚安装的<code>glog</code>库为例，在我们安装之后，它在<code>/usr/local/lib/cmake/glog/</code>目录下生成了<code>glog-config.cmake</code>文件，而<code>/usr/local/lib/cmake/&lt;LibraryName&gt;/</code>正是<code>find_package</code>函数的搜索路径之一</p>
<h4 id="5443-编写自己的findlibrarynamecmake模块"><a class="markdownIt-Anchor" href="#5443-编写自己的findlibrarynamecmake模块"></a> 5.4.4.3 编写自己的<code>Find&lt;LibraryName&gt;.cmake</code>模块</h4>
<p>假设我们编写了一个新的函数库，我们希望别的项目可以通过<code>find_package</code>对它进行引用我们应该怎么办呢。</p>
<p>我们在当前目录下新建一个<code>ModuleMode</code>的文件夹，在里面我们编写一个计算两个整数之和的一个简单的函数库。库函数以手工编写<code>Makefile</code>的方式进行安装，库文件安装在<code>/usr/lib</code>目录下，头文件放在<code>/usr/include</code>目录下。其中的Makefile文件如下：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、准备工作，编译方式、目标文件名、依赖库路径的定义。</span></span><br><span class="line">CC = g++</span><br><span class="line">CFLAGS  := -Wall -O3 -std=c++11 </span><br><span class="line"></span><br><span class="line">OBJS = libadd.o <span class="comment">#.o文件与.cpp文件同名</span></span><br><span class="line">LIB = libadd.so <span class="comment"># 目标文件名</span></span><br><span class="line">INCLUDE = ./ <span class="comment"># 头文件目录</span></span><br><span class="line">HEADER = libadd.h <span class="comment"># 头文件</span></span><br><span class="line"></span><br><span class="line">all : <span class="variable">$(LIB)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 生成.o文件 </span></span><br><span class="line"><span class="variable">$(OBJS)</span> : libadd.cc</span><br><span class="line">    <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -I ./ -fpic -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 生成动态库文件</span></span><br><span class="line"><span class="variable">$(LIB)</span> : <span class="variable">$(OBJS)</span></span><br><span class="line">    rm -f <span class="variable">$@</span></span><br><span class="line">    g++ <span class="variable">$(OBJS)</span> -shared -o <span class="variable">$@</span> </span><br><span class="line">    rm -f <span class="variable">$(OBJS)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 删除中间过程生成的文件 </span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm -f <span class="variable">$(OBJS)</span> <span class="variable">$(TARGET)</span> <span class="variable">$(LIB)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.安装文件</span></span><br><span class="line"><span class="section">install:</span></span><br><span class="line">    cp <span class="variable">$(LIB)</span> /usr/lib</span><br><span class="line">    cp <span class="variable">$(HEADER)</span> /usr/<span class="keyword">include</span></span><br></pre></td></tr></table></figure>
<p>编译安装：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>接下来我们回到我们的<code>cmake</code>项目中来，在<code>cmake</code>文件夹下新建一个<code>FindAdd.cmake</code>的文件。我们的目标是找到库的头文件所在目录和共享库文件的所在位置</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在指定目录下寻找头文件和动态库文件的位置，可以指定多个目标路径</span></span><br><span class="line"><span class="keyword">find_path</span>(ADD_INCLUDE_DIR libadd.h /usr/<span class="keyword">include</span>/ /usr/local/<span class="keyword">include</span> <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/ModuleMode)</span><br><span class="line"><span class="keyword">find_library</span>(<span class="keyword">ADD_LIBRARY</span> NAMES add PATHS /usr/lib/add /usr/local/lib/add <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/ModuleMode)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ADD_INCLUDE_DIR <span class="keyword">AND</span> <span class="keyword">ADD_LIBRARY</span>)</span><br><span class="line">    <span class="keyword">set</span>(ADD_FOUND <span class="keyword">TRUE</span>)</span><br><span class="line"><span class="keyword">endif</span> (ADD_INCLUDE_DIR <span class="keyword">AND</span> <span class="keyword">ADD_LIBRARY</span>)</span><br></pre></td></tr></table></figure>
<p>这时我们便可以像引用<code>curl</code>一样引入我们自定义的库了，在<code>CMakeLists.txt</code>添加</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将项目目录下的cmake文件夹加入到CMAKE_MODULE_PATH中，让find_pakcage能够找到我们自定义的函数库</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_MODULE_PATH <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;/cmake;$&#123;CMAKE_MODULE_PATH&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">add_executable</span>(addtest addtest.cc)</span><br><span class="line"><span class="keyword">find_package</span>(ADD)</span><br><span class="line"><span class="keyword">if</span>(ADD_FOUND)</span><br><span class="line">    <span class="keyword">target_include_directories</span>(addtest PRIVATE <span class="variable">$&#123;ADD_INCLUDE_DIR&#125;</span>)</span><br><span class="line">    <span class="keyword">target_link_libraries</span>(addtest <span class="variable">$&#123;ADD_LIBRARY&#125;</span>)</span><br><span class="line"><span class="keyword">else</span>(ADD_FOUND)</span><br><span class="line">    <span class="keyword">message</span>(FATAL_ERROR <span class="string">&quot;ADD library not found&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>(ADD_FOUND)</span><br></pre></td></tr></table></figure>
<h3 id="545-aux_source_directory"><a class="markdownIt-Anchor" href="#545-aux_source_directory"></a> 5.4.5 aux_source_directory</h3>
<p>Find all source files in a directory</p>
<h2 id="55-tips"><a class="markdownIt-Anchor" href="#55-tips"></a> 5.5 Tips</h2>
<h3 id="551-同一目录多个源文件"><a class="markdownIt-Anchor" href="#551-同一目录多个源文件"></a> 5.5.1 同一目录，多个源文件</h3>
<p>如果同一个目录下有多个源文件，那么在使用<code>add_executable</code>命令的时候，如果要一个个填写，那么将会非常麻烦，并且后续维护的代价也很大</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_executable(Demo main.cxx opt1.cxx opt2.cxx)</span><br></pre></td></tr></table></figure>
<p>我们可以使用<code>aux_source_directory(&lt;dir&gt; &lt;variable&gt;)</code>）命令，该命令可以扫描一个目录下得所有源文件，并将文件列表赋值给一个变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找当前目录下的所有源文件</span></span><br><span class="line"><span class="comment"># 并将名称保存到 DIR_SRCS 变量</span></span><br><span class="line">aux_source_directory(. DIR_SRCS)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定生成目标</span></span><br><span class="line">add_executable(Demo <span class="variable">$&#123;DIR_SRCS&#125;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="56-参考"><a class="markdownIt-Anchor" href="#56-参考"></a> 5.6 参考</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html">CMake Tutorial</a>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Kitware/CMake/tree/master/Help/guide/tutorial">CMake Tutorial对应的source code</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6df3857462cd">CMake Tutorial 翻译</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://www.hahack.com/codes/cmake/">CMake 入门实战</a></li>
<li><a target="_blank" rel="noopener" href="https://leehao.me/cmake-%E8%AF%AD%E8%A8%80-15-%E5%88%86%E9%92%9F%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/">CMake 语言 15 分钟入门教程</a></li>
<li><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-buildsystem.7.html#manual:cmake-buildsystem(7)">CMake Table of Contents</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/31969547/what-is-the-difference-between-include-directories-and-target-include-directorie/40244458">What is the difference between include_directories and target_include_directories in CMake?</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/97369704">Cmake之深入理解find_package()的用法</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag"># 原创</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/08/02/%E8%AE%BA%E6%96%87%E7%BF%BB%E8%AF%91-The-Design-and-Implementation-of-Modern-Column-Oriented-Database-Systems/" rel="prev" title="论文翻译-The-Design-and-Implementation-of-Modern-Column-Oriented-Database-Systems">
      <i class="fa fa-chevron-left"></i> 论文翻译-The-Design-and-Implementation-of-Modern-Column-Oriented-Database-Systems
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-livere">livere</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane livere" id="comment-livere">
              
  <div class="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC8zMzY0My8xMDE5OA=="></div>
  </div>
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E6%A0%87%E5%87%86%E5%BA%93"><span class="nav-text"> 1 标准库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#11-stdfunction"><span class="nav-text"> 1.1 std::function</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-stdbind"><span class="nav-text"> 1.2 std::bind</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-stdlock_guard"><span class="nav-text"> 1.3 std::lock_guard</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-%E5%8F%82%E8%80%83"><span class="nav-text"> 1.4 参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E5%AE%8F"><span class="nav-text"> 2 宏</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#21-do-while0-in-macros"><span class="nav-text"> 2.1 do while(0) in macros</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-%E5%8F%82%E8%80%83"><span class="nav-text"> 2.2 参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E4%B8%89%E6%96%B9%E5%BA%93"><span class="nav-text"> 3 三方库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#31-%E5%A4%B4%E6%96%87%E4%BB%B6%E5%A6%82%E4%BD%95%E6%9F%A5%E6%89%BE"><span class="nav-text"> 3.1 头文件如何查找</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#32-%E5%8F%82%E8%80%83"><span class="nav-text"> 3.2 参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-make"><span class="nav-text"> 4 Make</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#41-makefile%E6%96%87%E4%BB%B6%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="nav-text"> 4.1 Makefile文件的格式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#411-target"><span class="nav-text"> 4.1.1 target</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#412-prerequisites"><span class="nav-text"> 4.1.2 prerequisites</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#413-commands"><span class="nav-text"> 4.1.3 commands</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#42-makefile%E6%96%87%E4%BB%B6%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="nav-text"> 4.2 Makefile文件的语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#421-%E6%B3%A8%E9%87%8A"><span class="nav-text"> 4.2.1 注释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#422-%E5%9B%9E%E5%A3%B0echoing"><span class="nav-text"> 4.2.2 回声（echoing）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#423-%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="nav-text"> 4.2.3 通配符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#424-%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="nav-text"> 4.2.4 模式匹配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#425-%E5%8F%98%E9%87%8F%E5%92%8C%E8%B5%8B%E5%80%BC%E7%AC%A6"><span class="nav-text"> 4.2.5 变量和赋值符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#426-%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8Fimplicit-variables"><span class="nav-text"> 4.2.6 内置变量（Implicit Variables）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#427-%E8%87%AA%E5%8A%A8%E5%8F%98%E9%87%8Fautomatic-variables"><span class="nav-text"> 4.2.7 自动变量（Automatic Variables）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4271"><span class="nav-text"> 4.2.7.1 $@</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4272"><span class="nav-text"> 4.2.7.2 $&lt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4273"><span class="nav-text"> 4.2.7.3 $?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4274"><span class="nav-text"> 4.2.7.4 $^</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4275"><span class="nav-text"> 4.2.7.5 $*</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4276-df"><span class="nav-text"> 4.2.7.6 $(@D)&#x2F;$(@F)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4277-df"><span class="nav-text"> 4.2.7.7 $(&lt;D)&#x2F;$(&lt;F)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4278-%E4%BE%8B%E5%AD%90"><span class="nav-text"> 4.2.7.8 例子</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#428-%E5%88%A4%E6%96%AD%E5%92%8C%E5%BE%AA%E7%8E%AF"><span class="nav-text"> 4.2.8 判断和循环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#429-%E5%87%BD%E6%95%B0"><span class="nav-text"> 4.2.9 函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#43-%E5%8F%82%E8%80%83"><span class="nav-text"> 4.3 参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-cmake"><span class="nav-text"> 5 CMake</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#51-tutorial"><span class="nav-text"> 5.1 tutorial</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#511-step1-a-basic-starting-point"><span class="nav-text"> 5.1.1 step1: A Basic Starting Point</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code40-"><span class="nav-text"> 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
#include &lt;cmath&gt;
#include &lt;cstdlib&gt;
#include &lt;iostream&gt;
#include &lt;string&gt;

int main(int argc, char* argv[])
{
  if (argc &lt; 2) {
    std::cout &lt;&lt; &quot;Usage: &quot; &lt;&lt; argv[0] &lt;&lt; &quot; number&quot; &lt;&lt; std::endl;
    return 1;
  }

  &#x2F;&#x2F; convert input to double
  const double inputValue &#x3D; atof(argv[1]);

  &#x2F;&#x2F; calculate square root
  const double outputValue &#x3D; sqrt(inputValue);
  std::cout &lt;&lt; &quot;The square root of &quot; &lt;&lt; inputValue &lt;&lt; &quot; is &quot; &lt;&lt; outputValue
            &lt;&lt; std::endl;
  return 0;
}
</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code41-"><span class="nav-text"> 1
2
3
4
5
6
7
8
9
10
11
cmake_minimum_required(VERSION 3.10)

# set the project name and version
project(Tutorial VERSION 1.0)

# specify the C++ standard
set(CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_STANDARD_REQUIRED True)

# add the executable
add_executable(Tutorial tutorial.cxx)
</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code42-"><span class="nav-text"> 1
2
3
.
├── CMakeLists.txt
└── tutorial.cxx
</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#512-step2-adding-a-library-and-adding-usage-requirements-for-a-library"><span class="nav-text"> 5.1.2 step2: Adding a Library and Adding Usage Requirements for a Library</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code44-"><span class="nav-text"> 1
double mysqrt(double x);
</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code45-"><span class="nav-text"> 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
#include &lt;iostream&gt;

&#x2F;&#x2F; a hack square root calculation using simple operations
double mysqrt(double x)
{
  if (x &lt;&#x3D; 0) {
    return 0;
  }

  double result &#x3D; x;

  &#x2F;&#x2F; do ten iterations
  for (int i &#x3D; 0; i &lt; 10; ++i) {
    if (result &lt;&#x3D; 0) {
      result &#x3D; 0.1;
    }
    double delta &#x3D; x - (result * result);
    result &#x3D; result + 0.5 * delta &#x2F; result;
    std::cout &lt;&lt; &quot;Computing sqrt of &quot; &lt;&lt; x &lt;&lt; &quot; to be &quot; &lt;&lt; result &lt;&lt; std::endl;
  }
  return result;
}
</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code46-"><span class="nav-text"> 1
add_library(MathFunctions mysqrt.cxx)
</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code47-"><span class="nav-text"> 1
#cmakedefine USE_MYMATH
</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code48-"><span class="nav-text"> 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
#include &lt;cmath&gt;
#include &lt;cstdlib&gt;
#include &lt;iostream&gt;
#include &lt;string&gt;
#include &quot;TutorialConfig.h&quot;
#ifdef USE_MYMATH
#  include &quot;MathFunctions.h&quot;
#endif

int main(int argc, char* argv[])
{
  if (argc &lt; 2) {
    std::cout &lt;&lt; &quot;Usage: &quot; &lt;&lt; argv[0] &lt;&lt; &quot; number&quot; &lt;&lt; std::endl;
    return 1;
  }

  &#x2F;&#x2F; convert input to double
  const double inputValue &#x3D; atof(argv[1]);

  &#x2F;&#x2F; calculate square root
#ifdef USE_MYMATH
  const double outputValue &#x3D; mysqrt(inputValue);
#else
  const double outputValue &#x3D; sqrt(inputValue);
#endif
  std::cout &lt;&lt; &quot;The square root of &quot; &lt;&lt; inputValue &lt;&lt; &quot; is &quot; &lt;&lt; outputValue
            &lt;&lt; std::endl;
  return 0;
}
</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code49-"><span class="nav-text"> 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
cmake_minimum_required(VERSION 3.10)

# set the project name and version
project(Tutorial VERSION 1.0)

# specify the C++ standard
set(CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_STANDARD_REQUIRED True)

option(USE_MYMATH &quot;Use tutorial provided math implementation&quot; ON)

# configure a header file to pass some of the CMake settings
# to the source code
configure_file(TutorialConfig.h.in TutorialConfig.h)

if(USE_MYMATH)
  add_subdirectory(MathFunctions)
  list(APPEND EXTRA_LIBS MathFunctions)
  list(APPEND EXTRA_INCLUDES &quot;${PROJECT_SOURCE_DIR}&#x2F;MathFunctions&quot;)
endif()

# add the executable
add_executable(Tutorial tutorial.cxx)

target_link_libraries(Tutorial PUBLIC ${EXTRA_LIBS})

# add the binary tree to the search path for include files
# so that we will find TutorialConfig.h
target_include_directories(Tutorial PUBLIC
                           &quot;${PROJECT_BINARY_DIR}&quot;
                           ${EXTRA_INCLUDES}
                           )
</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code50-"><span class="nav-text"> 1
2
3
4
5
6
7
8
.
├── CMakeLists.txt
├── MathFunctions
│   ├── CMakeLists.txt
│   ├── MathFunctions.h
│   └── mysqrt.cxx
├── TutorialConfig.h.in
└── tutorial.cxx
</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#513-step3-installing"><span class="nav-text"> 5.1.3 step3: Installing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code52-"><span class="nav-text"> 1
2
3
# add the install targets
install (TARGETS MathFunctions DESTINATION bin)
install(FILES MathFunctions.h DESTINATION include)
</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code53-"><span class="nav-text"> 1
2
3
# add the install targets
install (TARGETS Tutorial DESTINATION bin)
install (FILES &quot;${PROJECT_BINARY_DIR}&#x2F;TutorialConfig.h&quot; DESTINATION include)
</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#514-step4-testing"><span class="nav-text"> 5.1.4 step4: Testing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code55-"><span class="nav-text"> 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
enable_testing()

# does the application run
add_test(NAME Runs COMMAND Tutorial 25)

# does the usage message work?
add_test(NAME Usage COMMAND Tutorial)
set_tests_properties(Usage
  PROPERTIES PASS_REGULAR_EXPRESSION &quot;Usage:.*number&quot;
  )

# define a function to simplify adding tests
function(do_test target arg result)
  add_test(NAME Comp_${arg} COMMAND ${target} ${arg})
  set_tests_properties(Comp_${arg}
    PROPERTIES PASS_REGULAR_EXPRESSION ${result}
    )
endfunction(do_test)

# do a bunch of result based tests
do_test(Tutorial 4 &quot;4 is 2&quot;)
do_test(Tutorial 9 &quot;9 is 3&quot;)
do_test(Tutorial 5 &quot;5 is 2.236&quot;)
do_test(Tutorial 7 &quot;7 is 2.645&quot;)
do_test(Tutorial 25 &quot;25 is 5&quot;)
do_test(Tutorial -25 &quot;-25 is [-nan|nan|0]&quot;)
do_test(Tutorial 0.0001 &quot;0.0001 is 0.01&quot;)
</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#515-step5-adding-system-introspection"><span class="nav-text"> 5.1.5 step5: Adding System Introspection</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code57-"><span class="nav-text"> 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
include(CheckSymbolExists)
check_symbol_exists(log &quot;math.h&quot; HAVE_LOG)
check_symbol_exists(exp &quot;math.h&quot; HAVE_EXP)
if(NOT (HAVE_LOG AND HAVE_EXP))
  unset(HAVE_LOG CACHE)
  unset(HAVE_EXP CACHE)
  set(CMAKE_REQUIRED_LIBRARIES &quot;m&quot;)
  check_symbol_exists(log &quot;math.h&quot; HAVE_LOG)
  check_symbol_exists(exp &quot;math.h&quot; HAVE_EXP)
  if(HAVE_LOG AND HAVE_EXP)
    target_link_libraries(MathFunctions PRIVATE m)
  endif()
endif()

if(HAVE_LOG AND HAVE_EXP)
  target_compile_definitions(MathFunctions
                             PRIVATE &quot;HAVE_LOG&quot; &quot;HAVE_EXP&quot;)
endif()
</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-code58-"><span class="nav-text"> 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
#include &lt;iostream&gt;
#include &lt;cmath&gt;

&#x2F;&#x2F; a hack square root calculation using simple operations
double mysqrt(double x)
{
  if (x &lt;&#x3D; 0) {
    return 0;
  }

#if defined(HAVE_LOG) &amp;&amp; defined(HAVE_EXP)
  double result &#x3D; exp(log(x) * 0.5);
  std::cout &lt;&lt; &quot;Computing sqrt of &quot; &lt;&lt; x &lt;&lt; &quot; to be &quot; &lt;&lt; result
            &lt;&lt; &quot; using log and exp&quot; &lt;&lt; std::endl;
#else
  double result &#x3D; x;

  &#x2F;&#x2F; do ten iterations
  for (int i &#x3D; 0; i &lt; 10; ++i) {
    if (result &lt;&#x3D; 0) {
      result &#x3D; 0.1;
    }
    double delta &#x3D; x - (result * result);
    result &#x3D; result + 0.5 * delta &#x2F; result;
    std::cout &lt;&lt; &quot;Computing sqrt of &quot; &lt;&lt; x &lt;&lt; &quot; to be &quot; &lt;&lt; result &lt;&lt; std::endl;
  }
#endif
  return result;
}
</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#52-target"><span class="nav-text"> 5.2 target</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#53-property"><span class="nav-text"> 5.3 property</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#531-include_directories"><span class="nav-text"> 5.3.1 INCLUDE_DIRECTORIES</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#54-command"><span class="nav-text"> 5.4 command</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#541-message"><span class="nav-text"> 5.4.1 message</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#542-set"><span class="nav-text"> 5.4.2 set</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#543-option"><span class="nav-text"> 5.4.3 option</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#544-find_package"><span class="nav-text"> 5.4.4 find_package</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5441-%E5%BC%95%E5%85%A5%E9%9D%9E%E5%AE%98%E6%96%B9%E7%9A%84%E5%BA%93"><span class="nav-text"> 5.4.4.1 引入非官方的库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5442-module%E6%A8%A1%E5%BC%8F%E4%B8%8Econfig%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 5.4.4.2 Module模式与Config模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5443-%E7%BC%96%E5%86%99%E8%87%AA%E5%B7%B1%E7%9A%84findlibrarynamecmake%E6%A8%A1%E5%9D%97"><span class="nav-text"> 5.4.4.3 编写自己的Find&lt;LibraryName&gt;.cmake模块</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#545-aux_source_directory"><span class="nav-text"> 5.4.5 aux_source_directory</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#55-tips"><span class="nav-text"> 5.5 Tips</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#551-%E5%90%8C%E4%B8%80%E7%9B%AE%E5%BD%95%E5%A4%9A%E4%B8%AA%E6%BA%90%E6%96%87%E4%BB%B6"><span class="nav-text"> 5.5.1 同一目录，多个源文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#56-%E5%8F%82%E8%80%83"><span class="nav-text"> 5.6 参考</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Liuyehcf"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Liuyehcf</p>
  <div class="site-description" itemprop="description">大音希声，大象无形</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">310</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">117</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liuyehcf</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  

<script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'qhEhLuMeMOy1zgcBhkqUS6P8-gzGzoHsz',
      appKey     : 'uhkruDLNLNdL5rQjRBY2X9Ke',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
