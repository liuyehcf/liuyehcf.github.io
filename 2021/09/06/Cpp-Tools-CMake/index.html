<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="阅读更多">
<meta property="og:type" content="article">
<meta property="og:title" content="Cpp-Tools-CMake">
<meta property="og:url" content="http://example.com/2021/09/06/Cpp-Tools-CMake/index.html">
<meta property="og:site_name" content="Liuye Notebook">
<meta property="og:description" content="阅读更多">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-09-06T02:55:29.000Z">
<meta property="article:modified_time" content="2024-03-31T08:47:01.000Z">
<meta property="article:author" content="Liuyehcf">
<meta property="article:tag" content="原创">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2021/09/06/Cpp-Tools-CMake/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Cpp-Tools-CMake | Liuye Notebook</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Liuye Notebook</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-explore">

    <a href="/explore/" rel="section"><i class="fa fa-sitemap fa-fw"></i>发现</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/06/Cpp-Tools-CMake/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Liuyehcf">
      <meta itemprop="description" content="大音希声，大象无形">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liuye Notebook">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Cpp-Tools-CMake
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-06 10:55:29" itemprop="dateCreated datePublished" datetime="2021-09-06T10:55:29+08:00">2021-09-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-03-31 16:47:01" itemprop="dateModified" datetime="2024-03-31T16:47:01+08:00">2024-03-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
                </span>
            </span>

          
            <span id="/2021/09/06/Cpp-Tools-CMake/" class="post-meta-item leancloud_visitors" data-flag-title="Cpp-Tools-CMake" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/09/06/Cpp-Tools-CMake/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/09/06/Cpp-Tools-CMake/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><strong>阅读更多</strong></p>
<span id="more"></span>
<h1 id="1-tutorial"><a class="markdownIt-Anchor" href="#1-tutorial"></a> 1 tutorial</h1>
<h2 id="11-step1-a-basic-starting-point"><a class="markdownIt-Anchor" href="#11-step1-a-basic-starting-point"></a> 1.1 step1: A Basic Starting Point</h2>
<p><code>tutorial.cxx</code>内容如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; number&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// convert input to double</span></span><br><span class="line">  <span class="type">const</span> <span class="type">double</span> inputValue = <span class="built_in">atof</span>(argv[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// calculate square root</span></span><br><span class="line">  <span class="type">const</span> <span class="type">double</span> outputValue = <span class="built_in">sqrt</span>(inputValue);</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;The square root of &quot;</span> &lt;&lt; inputValue &lt;&lt; <span class="string">&quot; is &quot;</span> &lt;&lt; outputValue</span><br><span class="line">            &lt;&lt; std::endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>CMakeLists.txt</code>内容如下：</p>
<ul>
<li><code>cmake_minimum_required</code>：用于指定<code>cmake</code>的最小版本，避免出现兼容性问题（包含了高级版本的特性，但是实际的<code>cmake</code>版本较小）</li>
<li><code>project</code>：用于设置项目名称，并存储到<code>CMAKE_PROJECT_NAME</code>变量中，<code>cmake</code>中的一些环境变量会以这里指定的项目名称作为前缀，例如
<ul>
<li><code>PROJECT_SOURCE_DIR</code>、<code>&lt;PROJECT-NAME&gt;_SOURCE_DIR</code></li>
<li><code>PROJECT_BINARY_DIR</code>、<code>&lt;PROJECT-NAME&gt;_BINARY_DIR</code></li>
</ul>
</li>
<li><code>set</code>：用于设置一些变量</li>
<li><code>add_executable</code>：添加目标可执行文件</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># set the project name and version</span></span><br><span class="line"><span class="keyword">project</span>(Tutorial VERSION <span class="number">1.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># specify the C++ standard</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the executable</span></span><br><span class="line"><span class="keyword">add_executable</span>(Tutorial tutorial.cxx)</span><br></pre></td></tr></table></figure>
<p>此时文件结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">└── tutorial.cxx</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">./Tutorial 256</span><br></pre></td></tr></table></figure>
<h2 id="12-step2-adding-a-library-and-adding-usage-requirements-for-a-library"><a class="markdownIt-Anchor" href="#12-step2-adding-a-library-and-adding-usage-requirements-for-a-library"></a> 1.2 step2: Adding a Library and Adding Usage Requirements for a Library</h2>
<p>接下来，我们用自己实现的求开方的函数替换标准库中的实现。创建<code>MathFunctions</code>子目录，并在该子目录添加<code>MathFunctions.h</code>以及<code>mysqrt.cxx</code>、<code>CMakeLists.txt</code>三个文件</p>
<p><code>MathFunctions/MathFunctions.h</code>内容如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">mysqrt</span><span class="params">(<span class="type">double</span> x)</span></span>;</span><br></pre></td></tr></table></figure>
<p><code>MathFunctions/mysqrt.cxx</code>内容如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// a hack square root calculation using simple operations</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">mysqrt</span><span class="params">(<span class="type">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">double</span> result = x;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// do ten iterations</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (result &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      result = <span class="number">0.1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> delta = x - (result * result);</span><br><span class="line">    result = result + <span class="number">0.5</span> * delta / result;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Computing sqrt of &quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot; to be &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>MathFunctions/CMakeLists.txt</code>内容如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(MathFunctions mysqrt.cxx)</span><br></pre></td></tr></table></figure>
<p>添加<code>TutorialConfig.h.in</code>文件，内容如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#cmakedefine USE_MYMATH</span></span><br></pre></td></tr></table></figure>
<p>修改<code>tutorial.cxx</code>文件，内容如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TutorialConfig.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> USE_MYMATH</span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> <span class="string">&quot;MathFunctions.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; number&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// convert input to double</span></span><br><span class="line">  <span class="type">const</span> <span class="type">double</span> inputValue = <span class="built_in">atof</span>(argv[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// calculate square root</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> USE_MYMATH</span></span><br><span class="line">  <span class="type">const</span> <span class="type">double</span> outputValue = <span class="built_in">mysqrt</span>(inputValue);</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">  <span class="type">const</span> <span class="type">double</span> outputValue = <span class="built_in">sqrt</span>(inputValue);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;The square root of &quot;</span> &lt;&lt; inputValue &lt;&lt; <span class="string">&quot; is &quot;</span> &lt;&lt; outputValue</span><br><span class="line">            &lt;&lt; std::endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改<code>CMakeLists.txt</code>文件，内容如下：</p>
<ul>
<li><code>option</code>：用于添加<code>cmake</code>选项，可以通过<code>-D&lt;OPTION-NAME&gt;=ON/OFF</code>参数来选择打开或者关闭该选项
<ul>
<li>例如<code>cmake .. -DUSE_MYMATH=OFF</code></li>
</ul>
</li>
<li><code>configure_file</code>：一般用于根据cmake选项动态生成头文件</li>
<li><code>if statement</code>：控制流</li>
<li><code>add_subdirectory</code>：用于将子目录添加到构建任务中</li>
<li><code>list</code>：容器相关的操作</li>
<li><code>target_link_libraries</code>：指定库文件</li>
<li><code>target_include_directories</code>：指定头文件搜索路径</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># set the project name and version</span></span><br><span class="line"><span class="keyword">project</span>(Tutorial VERSION <span class="number">1.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># specify the C++ standard</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span>(USE_MYMATH <span class="string">&quot;Use tutorial provided math implementation&quot;</span> <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># configure a header file to pass some of the CMake settings</span></span><br><span class="line"><span class="comment"># to the source code</span></span><br><span class="line"><span class="keyword">configure_file</span>(TutorialConfig.h.in TutorialConfig.h)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(USE_MYMATH)</span><br><span class="line">  <span class="keyword">add_subdirectory</span>(MathFunctions)</span><br><span class="line">  <span class="keyword">list</span>(APPEND EXTRA_LIBS MathFunctions)</span><br><span class="line">  <span class="keyword">list</span>(APPEND EXTRA_INCLUDES <span class="string">&quot;$&#123;PROJECT_SOURCE_DIR&#125;/MathFunctions&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the executable</span></span><br><span class="line"><span class="keyword">add_executable</span>(Tutorial tutorial.cxx)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(Tutorial PUBLIC <span class="variable">$&#123;EXTRA_LIBS&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the binary tree to the search path for include files</span></span><br><span class="line"><span class="comment"># so that we will find TutorialConfig.h</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(Tutorial PUBLIC</span><br><span class="line">                           <span class="string">&quot;$&#123;PROJECT_BINARY_DIR&#125;&quot;</span></span><br><span class="line">                           <span class="variable">$&#123;EXTRA_INCLUDES&#125;</span></span><br><span class="line">                           )</span><br></pre></td></tr></table></figure>
<p>此时目录结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── MathFunctions</span><br><span class="line">│   ├── CMakeLists.txt</span><br><span class="line">│   ├── MathFunctions.h</span><br><span class="line">│   └── mysqrt.cxx</span><br><span class="line">├── TutorialConfig.h.in</span><br><span class="line">└── tutorial.cxx</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用的是自定义的sqrt函数</span></span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">./Tutorial 256</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用的是标准库的sqrt函数</span></span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DUSE_MYMATH=OFF</span><br><span class="line">make</span><br><span class="line">./Tutorial 256</span><br></pre></td></tr></table></figure>
<h2 id="13-step3-installing"><a class="markdownIt-Anchor" href="#13-step3-installing"></a> 1.3 step3: Installing</h2>
<p>现在，我们要安装<code>make</code>后产生的二进制、库文件、头文件</p>
<p>在<code>step2</code>的基础上，修改<code>MathFunctions/CMakeLists.txt</code>文件，追加如下内容：</p>
<ul>
<li>其中这里指定了两个相对路径<code>lib</code>、<code>include</code>。前缀由<code>cmake</code>变量<code>CMAKE_INSTALL_PREFIX</code>确定，默认值为<code>/usr/local</code></li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add the install targets</span></span><br><span class="line"><span class="keyword">install</span> (TARGETS MathFunctions DESTINATION bin)</span><br><span class="line"><span class="keyword">install</span>(FILES MathFunctions.h DESTINATION <span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>
<p>在<code>step2</code>的基础上，修改<code>CMakeLists.txt</code>文件，追加如下内容：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add the install targets</span></span><br><span class="line"><span class="keyword">install</span> (TARGETS Tutorial DESTINATION bin)</span><br><span class="line"><span class="keyword">install</span> (FILES <span class="string">&quot;$&#123;PROJECT_BINARY_DIR&#125;/TutorialConfig.h&quot;</span> DESTINATION <span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用默认的安装路径</span></span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定安装路径</span></span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=/tmp/mydir</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h2 id="14-step4-testing"><a class="markdownIt-Anchor" href="#14-step4-testing"></a> 1.4 step4: Testing</h2>
<p>接下来，增加测试功能。在<code>step2</code>的基础上，修改<code>CMakeLists.txt</code>文件，追加如下内容：</p>
<ul>
<li><code>add_test</code>：用于增加测试，其中<code>NAME</code>指定的是测试用例的名称，<code>RUN</code>指定的是测试的命令</li>
<li><code>function</code>：用于定义一个方法</li>
<li><code>set_tests_properties</code>：用于设置测试项的属性，这里指定了测试结果的通配符</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enable_testing</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># does the application run</span></span><br><span class="line"><span class="keyword">add_test</span>(NAME Runs <span class="keyword">COMMAND</span> Tutorial <span class="number">25</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># does the usage message work?</span></span><br><span class="line"><span class="keyword">add_test</span>(NAME Usage <span class="keyword">COMMAND</span> Tutorial)</span><br><span class="line"><span class="keyword">set_tests_properties</span>(Usage</span><br><span class="line">  PROPERTIES PASS_REGULAR_EXPRESSION <span class="string">&quot;Usage:.*number&quot;</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment"># define a function to simplify adding tests</span></span><br><span class="line"><span class="keyword">function</span>(do_test <span class="keyword">target</span> arg result)</span><br><span class="line">  <span class="keyword">add_test</span>(NAME Comp_<span class="variable">$&#123;arg&#125;</span> <span class="keyword">COMMAND</span> <span class="variable">$&#123;target&#125;</span> <span class="variable">$&#123;arg&#125;</span>)</span><br><span class="line">  <span class="keyword">set_tests_properties</span>(Comp_<span class="variable">$&#123;arg&#125;</span></span><br><span class="line">    PROPERTIES PASS_REGULAR_EXPRESSION <span class="variable">$&#123;result&#125;</span></span><br><span class="line">    )</span><br><span class="line"><span class="keyword">endfunction</span>(do_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># do a bunch of result based tests</span></span><br><span class="line">do_test(Tutorial <span class="number">4</span> <span class="string">&quot;4 is 2&quot;</span>)</span><br><span class="line">do_test(Tutorial <span class="number">9</span> <span class="string">&quot;9 is 3&quot;</span>)</span><br><span class="line">do_test(Tutorial <span class="number">5</span> <span class="string">&quot;5 is 2.236&quot;</span>)</span><br><span class="line">do_test(Tutorial <span class="number">7</span> <span class="string">&quot;7 is 2.645&quot;</span>)</span><br><span class="line">do_test(Tutorial <span class="number">25</span> <span class="string">&quot;25 is 5&quot;</span>)</span><br><span class="line">do_test(Tutorial -<span class="number">25</span> <span class="string">&quot;-25 is [-nan|nan|0]&quot;</span>)</span><br><span class="line">do_test(Tutorial <span class="number">0.0001</span> <span class="string">&quot;0.0001 is 0.01&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">make test</span><br></pre></td></tr></table></figure>
<h2 id="15-step5-adding-system-introspection"><a class="markdownIt-Anchor" href="#15-step5-adding-system-introspection"></a> 1.5 step5: Adding System Introspection</h2>
<p>同一个库，在不同平台上的实现可能不同，例如A平台有方法<code>funcA</code>，而B平台没有<code>funcA</code>，因此我们需要有一种机制来检测这种差异</p>
<p>接下来，增加测试功能。在<code>step2</code>的基础上，修改<code>MathFunctions/CMakeLists.txt</code>文件，追加如下内容：</p>
<ul>
<li><code>include</code>：加载<code>cmake</code>模块，这里加载了<code>CheckSymbolExists</code>模块，该模块用于检测指定文件中的指定符号是否存在</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(CheckSymbolExists)</span><br><span class="line">check_symbol_exists(log <span class="string">&quot;math.h&quot;</span> HAVE_LOG)</span><br><span class="line">check_symbol_exists(exp <span class="string">&quot;math.h&quot;</span> HAVE_EXP)</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> (HAVE_LOG <span class="keyword">AND</span> HAVE_EXP))</span><br><span class="line">  <span class="keyword">unset</span>(HAVE_LOG CACHE)</span><br><span class="line">  <span class="keyword">unset</span>(HAVE_EXP CACHE)</span><br><span class="line">  <span class="keyword">set</span>(CMAKE_REQUIRED_LIBRARIES <span class="string">&quot;m&quot;</span>)</span><br><span class="line">  check_symbol_exists(log <span class="string">&quot;math.h&quot;</span> HAVE_LOG)</span><br><span class="line">  check_symbol_exists(exp <span class="string">&quot;math.h&quot;</span> HAVE_EXP)</span><br><span class="line">  <span class="keyword">if</span>(HAVE_LOG <span class="keyword">AND</span> HAVE_EXP)</span><br><span class="line">    <span class="keyword">target_link_libraries</span>(MathFunctions PRIVATE m)</span><br><span class="line">  <span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(HAVE_LOG <span class="keyword">AND</span> HAVE_EXP)</span><br><span class="line">  <span class="keyword">target_compile_definitions</span>(MathFunctions</span><br><span class="line">                             PRIVATE <span class="string">&quot;HAVE_LOG&quot;</span> <span class="string">&quot;HAVE_EXP&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>
<p>修改<code>MathFunctions/mysqrt.cxx</code>文件，内容如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// a hack square root calculation using simple operations</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">mysqrt</span><span class="params">(<span class="type">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(HAVE_LOG) &amp;&amp; defined(HAVE_EXP)</span></span><br><span class="line">  <span class="type">double</span> result = <span class="built_in">exp</span>(<span class="built_in">log</span>(x) * <span class="number">0.5</span>);</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Computing sqrt of &quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot; to be &quot;</span> &lt;&lt; result</span><br><span class="line">            &lt;&lt; <span class="string">&quot; using log and exp&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">  <span class="type">double</span> result = x;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// do ten iterations</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (result &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      result = <span class="number">0.1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> delta = x - (result * result);</span><br><span class="line">    result = result + <span class="number">0.5</span> * delta / result;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Computing sqrt of &quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot; to be &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">./Tutorial 25</span><br></pre></td></tr></table></figure>
<h1 id="2-target"><a class="markdownIt-Anchor" href="#2-target"></a> 2 target</h1>
<p><code>cmake</code>可以使用<code>add_executable</code>、<code>add_library</code>或<code>add_custom_target</code>等命令来定义目标<code>target</code>。与变量不同，目标在每个作用域都可见，且可以使用<code>get_property</code>和<code>set_property</code>获取或设置其属性</p>
<h1 id="3-variables"><a class="markdownIt-Anchor" href="#3-variables"></a> 3 variables</h1>
<h2 id="31-frequently-used-variables"><a class="markdownIt-Anchor" href="#31-frequently-used-variables"></a> 3.1 Frequently-Used Variables</h2>
<p>参考（<a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-variables.7.html">cmake-variables</a>）：</p>
<ul>
<li><code>CMAKE_BINARY_DIR</code>、<code>PROJECT_BINARY_DIR</code>、<code>&lt;PROJECT-NAME&gt;_BINARY_DIR</code>：指的是工程编译发生的目录。在递归处理子项目时，该变量不会发生改变
<ul>
<li>若指定了<code>-B</code>参数，即<code>-B</code>参数指定的目录</li>
<li>若没有指定<code>-B</code>参数，即执行<code>cmake</code>命令时所在的目录</li>
</ul>
</li>
<li><code>CMAKE_SOURCE_DIR</code>、<code>PROJECT_SOURCE_DIR</code>、<code>&lt;PROJECT-NAME&gt;_SOURCE_DIR</code>：指的是工程顶层目录。在递归处理子项目时，该变量不会发生改变</li>
<li><code>CMAKE_CURRENT_SOURCE_DIR</code>：指的是当前处理的<code>cmake</code>项目的工程目录，一般来说是<code>CMakeLists.txt</code>所在目录。在递归处理子项目时，该变量会发生改变
<ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/15662497/difference-between-cmake-current-source-dir-and-cmake-current-list-dir">Difference between CMAKE_CURRENT_SOURCE_DIR and CMAKE_CURRENT_LIST_DIR</a></li>
<li>若通过<code>include(src/CMakeLists.txt)</code>引入子项目，假设工程根目录是<code>project</code>，那么该子项目在处理的时候，<code>CMAKE_CURRENT_SOURCE_DIR</code>是<code>project</code>，而<code>CMAKE_CURRENT_LIST_DIR</code>是<code>project/src</code></li>
</ul>
</li>
<li><code>CMAKE_CURRENT_BINARY_DIR</code>：指的是工程编译结果存放的目标目录。在递归处理子项目时，该变量会发生改变。可以通过<code>set</code>命令或<code>ADD_SUBDIRECTORY(src bin)</code>改变这个变量的值，但是<code>set(EXECUTABLE_OUTPUT_PATH &lt;new_paht&gt;)</code>并不改变这个变量的值，只会影响最终的保存路径</li>
<li><code>CMAKE_CURRENT_LIST_DIR</code>：指的是当前处理的<code>CMakeLists.txt</code>所在目录。在递归处理子项目时，该变量会发生改变</li>
<li><code>CMAKE_CURRENT_LIST_FILE</code>：指的是当前处理的<code>CMakeLists.txt</code>的路径。在递归处理子项目时，该变量会发生改变</li>
<li><code>CMAKE_MODULE_PATH</code>：<code>include()</code>、<code>find_package()</code>命令的模块搜索路径</li>
<li><code>EXECUTABLE_OUTPUT_PATH</code>、<code>LIBRARY_OUTPUT_PATH</code>：定义最终编译结果的二进制执行文件和库文件的存放目录</li>
<li><code>PROJECT_NAME</code>：指的是通过<code>set</code>设置的<code>PROJECT</code>的名称</li>
<li><code>CMAKE_INCLUDE_PATH</code>、<code>CMAKE_LIBRARY_PATH</code>：这两个是系统变量而不是<code>cmake</code>变量，需要在<code>bash</code>中用<code>export</code>设置</li>
<li><code>CMAKE_MAJOR_VERSION</code>、<code>CMAKE_MINOR_VERSION</code>、<code>CMAKE_PATCH_VERSION</code>：主版本号、次版本号，补丁版本号，<code>2.4.6</code>中的<code>2</code>、<code>4</code>、<code>6</code></li>
<li><code>CMAKE_SYSTEM</code>：系统名称，比如<code>Linux-2.6.22</code></li>
<li><code>CMAKE_SYSTEM_NAME</code>：不包含版本的系统名，比如<code>Linux</code></li>
<li><code>CMAKE_SYSTEM_VERSION</code>：系统版本，比如<code>2.6.22</code></li>
<li><code>CMAKE_SYSTEM_PROCESSOR</code>：处理器名称，比如<code>i686</code></li>
<li><code>UNIX</code>：在所有的类<code>UNIX</code>平台为<code>TRUE</code>，包括<code>OS X</code>和<code>cygwin</code></li>
<li><code>WIN32</code>：在所有的<code>win32</code>平台为<code>TRUE</code>，包括<code>cygwin</code></li>
<li><code>ENV&#123;NAME&#125;</code>：环境变量，通过<code>set(ENV&#123;NAME&#125; value)</code>设置，通过<code>$ENV&#123;NAME&#125;</code>引用</li>
</ul>
<h2 id="32-build_shared_libs"><a class="markdownIt-Anchor" href="#32-build_shared_libs"></a> 3.2 BUILD_SHARED_LIBS</h2>
<p>该参数用于控制<code>add_library</code>指令，在缺省类型参数的情况下，生成静态还是动态库</p>
<h1 id="4-property"><a class="markdownIt-Anchor" href="#4-property"></a> 4 property</h1>
<h2 id="41-include_directories"><a class="markdownIt-Anchor" href="#41-include_directories"></a> 4.1 INCLUDE_DIRECTORIES</h2>
<p><strong>去哪找头文件<code>.h</code>，<code>-I（GCC）</code></strong></p>
<ol>
<li><code>include_directories</code>：该方法会在全局维度添加<code>include</code>的搜索路径。这些搜索路径会被添加到所有<code>target</code>中去（包括所有<code>sub target</code>），会追加到所有<code>target</code>的<code>INCLUDE_DIRECTORIES</code>属性中去</li>
<li><code>target_include_directories</code>：该方法为指定<code>target</code>添加<code>include</code>的搜索路径，会追加到该<code>target</code>的<code>INCLUDE_DIRECTORIES</code>属性中去</li>
</ol>
<p>如何查看全局维度以及target维度的<code>INCLUDE_DIRECTORIES</code>属性值</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get_property</span>(dirs DIRECTORY <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span> PROPERTY <span class="keyword">INCLUDE_DIRECTORIES</span>)</span><br><span class="line"><span class="keyword">foreach</span>(dir <span class="variable">$&#123;dirs&#125;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;dir of include_directories=&#x27;$&#123;dir&#125;&#x27;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">get_target_property</span>(target_dirs &lt;<span class="keyword">TARGET</span>-NAME&gt; <span class="keyword">INCLUDE_DIRECTORIES</span>)</span><br><span class="line"><span class="keyword">foreach</span>(target_dir <span class="variable">$&#123;target_dirs&#125;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;dir of target_include_directories=&#x27;$&#123;target_dir&#125;&#x27;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>
<h2 id="42-link_directories"><a class="markdownIt-Anchor" href="#42-link_directories"></a> 4.2 LINK_DIRECTORIES</h2>
<p><strong>去哪找库文件<code>.so/.dll/.lib/.dylib/...</code>，<code>-L（GCC）</code></strong></p>
<h2 id="43-link_libraries"><a class="markdownIt-Anchor" href="#43-link_libraries"></a> 4.3 LINK_LIBRARIES</h2>
<p><strong>需要链接的库文件的名字：<code>-l（GCC）</code></strong></p>
<h1 id="5-command"><a class="markdownIt-Anchor" href="#5-command"></a> 5 command</h1>
<h2 id="51-message"><a class="markdownIt-Anchor" href="#51-message"></a> 5.1 message</h2>
<p>用于打印信息</p>
<p>格式：<code>message([&lt;mode&gt;] &quot;message text&quot; ...)</code></p>
<p>合法的<code>mode</code>包括</p>
<ul>
<li><code>FATAL_ERROR</code>：致命错误，终止构建</li>
<li><code>SEND_ERROR</code>：继续构建，终止<code>generation</code></li>
<li><code>WARNING</code>：告警信息，继续构建</li>
<li><code>AUTHOR_WARNING</code>：告警信息，继续构建</li>
<li><code>DEPRECATION</code>：当<code>CMAKE_ERROR_DEPRECATED</code>或<code>CMAKE_WARN_DEPRECATED</code>参数启用时，若使用了<code>deprecated</code>的特性，会打印<code>error</code>或者<code>warn</code>信息</li>
<li><code>NOTICE</code>：通过<code>stderr</code>打印的信息</li>
<li><strong><code>STATUS</code>：用户最应该关注的信息</strong></li>
<li><code>VERBOSE</code>：项目构建者需要关注的信息</li>
<li><code>DEBUG</code>：项目调试需要关注的信息</li>
<li><code>TRACE</code>：最低级别的信息</li>
</ul>
<h2 id="52-set"><a class="markdownIt-Anchor" href="#52-set"></a> 5.2 set</h2>
<p><code>set</code>用于设置：<code>cmake</code>变量或环境变量</p>
<p>格式：</p>
<ul>
<li><code>cmake</code>变量：<code>set(&lt;variable&gt; &lt;value&gt;... [PARENT_SCOPE])</code></li>
<li>环境变量：<code>set(ENV&#123;&lt;variable&gt;&#125; [&lt;value&gt;]</code></li>
</ul>
<p>变量如何引用：</p>
<ul>
<li><code>cmake</code>变量：<code>$&#123;&lt;variable&gt;&#125;</code></li>
<li>环境变量：<code>$ENV&#123;&lt;variable&gt;&#125;</code></li>
</ul>
<h2 id="53-option"><a class="markdownIt-Anchor" href="#53-option"></a> 5.3 option</h2>
<p><code>option</code>用于设置构建选项</p>
<p>格式：<code>option(&lt;variable&gt; &quot;&lt;help_text&gt;&quot; [value])</code></p>
<ul>
<li>其中<code>value</code>的可选值就是<code>ON</code>和<code>OFF</code>，其中<code>OFF</code>是默认值</li>
</ul>
<h2 id="54-file"><a class="markdownIt-Anchor" href="#54-file"></a> 5.4 file</h2>
<p><code>file</code>用于文件操作</p>
<p>格式：</p>
<ul>
<li><code>file(READ &lt;filename&gt; &lt;out-var&gt; [...])</code></li>
<li><code>file(&#123;WRITE | APPEND&#125; &lt;filename&gt; &lt;content&gt;...)</code></li>
</ul>
<p>操作类型说明：</p>
<ul>
<li><code>READ</code>：读取文件到变量中</li>
<li><code>WRITE</code>：覆盖写，文件不存在就创建</li>
<li><code>APPEND</code>：追加写，文件不存在就创建</li>
</ul>
<h2 id="55-add_executable"><a class="markdownIt-Anchor" href="#55-add_executable"></a> 5.5 add_executable</h2>
<p><code>add_executable</code>用于添加可执行文件，示例如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(&lt;name&gt; [WIN32] [MACOSX_BUNDLE]</span><br><span class="line">               [EXCLUDE_FROM_ALL]</span><br><span class="line">               [source1] [source2 ...])</span><br><span class="line"></span><br><span class="line"><span class="comment"># client.cpp $&#123;PROTO_SRC&#125; $&#123;PROTO_HEADER&#125; 都是源文件</span></span><br><span class="line"><span class="keyword">add_executable</span>(echo_client client.cpp <span class="variable">$&#123;PROTO_SRC&#125;</span> <span class="variable">$&#123;PROTO_HEADER&#125;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="56-add_library"><a class="markdownIt-Anchor" href="#56-add_library"></a> 5.6 add_library</h2>
<p><code>add_library</code>用于生成库文件，格式和示例如下：</p>
<ul>
<li><code>&lt;name&gt;</code>：<code>target</code>名称</li>
<li>第二个参数用于指定库文件类型，可以省略，由<code>BUILD_SHARED_LIBS</code>变量控制
<ul>
<li><code>STATIC</code>：静态库</li>
<li><code>SHARED</code>：动态库</li>
</ul>
</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(&lt;name&gt; [STATIC | SHARED | MODULE]</span><br><span class="line">            [EXCLUDE_FROM_ALL]</span><br><span class="line">            [&lt;source&gt;...])</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(Exec STATIC <span class="variable">$&#123;EXEC_FILES&#125;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>通过绝对路径引入三方库</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(protobuf STATIC IMPORTED)</span><br><span class="line"><span class="keyword">set_target_properties</span>(protobuf PROPERTIES IMPORTED_LOCATION <span class="variable">$&#123;THIRDPARTY_DIR&#125;</span>/lib/libprotobuf.a)</span><br></pre></td></tr></table></figure>
<h2 id="57-set_target_properties"><a class="markdownIt-Anchor" href="#57-set_target_properties"></a> 5.7 set_target_properties</h2>
<p>为指定<code>target</code>设置属性</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set_target_properties</span>(xxx PROPERTIES</span><br><span class="line">    CXX_STANDARD <span class="number">11</span></span><br><span class="line">    CXX_STANDARD_REQUIRED YES</span><br><span class="line">    CXX_EXTENSIONS NO</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="58-target_compile_options"><a class="markdownIt-Anchor" href="#58-target_compile_options"></a> 5.8 target_compile_options</h2>
<p>为指定<code>target</code>设置编译参数</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_compile_options</span>(xxx PUBLIC <span class="string">&quot;-O3&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="59-target_link_libraries"><a class="markdownIt-Anchor" href="#59-target_link_libraries"></a> 5.9 target_link_libraries</h2>
<p><code>target_link_libraries</code>指定链接给定目标时要使用的库或标志，格式和示例如下，其中<code>&lt;item&gt;</code>可以是：</p>
<ol>
<li><code>library</code>类型的<code>target</code>的名称。例如通过<code>add_subdirectory</code>引入的<code>library</code>子项目</li>
<li><code>library</code>的完整路径</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(&lt;<span class="keyword">target</span>&gt; ... &lt;item&gt;... ...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># example</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(echo_client <span class="variable">$&#123;BRPC_LIB&#125;</span> <span class="variable">$&#123;DYNAMIC_LIB&#125;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="510-target_include_directories"><a class="markdownIt-Anchor" href="#510-target_include_directories"></a> 5.10 target_include_directories</h2>
<p><code>target_include_directories</code>：该方法为指定<code>target</code>添加<code>include</code>的搜索路径，会追加到该<code>target</code>的<code>INCLUDE_DIRECTORIES</code>属性中去</p>
<h2 id="511-include_directories"><a class="markdownIt-Anchor" href="#511-include_directories"></a> 5.11 include_directories</h2>
<p><code>include_directories</code>：该方法会在全局维度添加<code>include</code>的搜索路径。这些搜索路径会被添加到所有<code>target</code>中去（包括所有<code>sub target</code>），会追加到所有<code>target</code>的<code>INCLUDE_DIRECTORIES</code>属性中去</p>
<h2 id="512-add_subdirectory"><a class="markdownIt-Anchor" href="#512-add_subdirectory"></a> 5.12 add_subdirectory</h2>
<p><code>add_subdirectory</code>：用于引入一个<code>cmake</code>子项目</p>
<ul>
<li><code>source_dir</code>：子项目路径，该路径下必须包含<code>CMakeLists.txt</code>文件。且必须是子目录，不能是外层目录</li>
<li><code>binary_dir</code>：二进制路径，生成的可执行文件或者库文件的放置路径</li>
<li><code>EXCLUDE_FROM_ALL</code>：当指定该参数时，构建父项目时，若无明确依赖子项目（例如通过<code>target_link_libraries</code>添加依赖），那么子项目不会被自动构建。若有明确依赖，那么仍然会构建</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_subdirectory</span>(source_dir [binary_dir] [EXCLUDE_FROM_ALL] [SYSTEM])</span><br></pre></td></tr></table></figure>
<h2 id="513-include"><a class="markdownIt-Anchor" href="#513-include"></a> 5.13 include</h2>
<p><code>include</code>：用于引入一个<code>cmake</code>子项目。例如<code>include(src/merger/CMakeLists.txt)</code></p>
<p><strong><code>include</code>和<code>add_subdirectory</code>这两个命令都可以用来引入一个<code>cmake</code>子项目，它们的区别在于：</strong></p>
<ul>
<li><code>add_subdirectory</code>：该子项目会作为一个独立的<code>cmake</code>项目进行处理。所有<code>CURRENT</code>相关的变量都会进行切换。此外，<code>CMakeLists.txt</code>文件中涉及的所有相对路径，其<code>base</code>路径也会切换成<code>add_subdirectory</code>指定的目录</li>
<li><code>include</code>：该子项目不会作为一个独立的<code>cmake</code>项目进行处理。只有<code>CMAKE_CURRENT_LIST_DIR</code>、<code>CMAKE_CURRENT_LIST_FILE</code>这两个<code>CURRENT</code>变量会进行切换，而<code>CMAKE_CURRENT_BINARY_DIR</code>和<code>CMAKE_CURRENT_SOURCE_DIR</code>不会进行切换。此外，<code>CMakeLists.txt</code>文件中涉及的所有相对路径，其<code>base</code>路径保持不变</li>
</ul>
<h2 id="514-find_package"><a class="markdownIt-Anchor" href="#514-find_package"></a> 5.14 find_package</h2>
<p><strong>本小节转载摘录自<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/97369704">Cmake之深入理解find_package()的用法</a></strong></p>
<p>为了方便我们在项目中引入外部依赖包，<code>cmake</code>官方为我们预定义了许多寻找依赖包的<code>Module</code>，他们存储在<code>path_to_your_cmake/share/cmake-&lt;version&gt;/Modules</code>目录下（例如<code>/usr/local/lib/cmake-3.21.2-linux-x86_64/share/cmake-3.21/Modules</code>）。每个以<code>Find&lt;LibaryName&gt;.cmake</code>命名的文件都可以帮我们找到一个包。<strong>注意，<code>find_package(&lt;LibaryName&gt;)</code>与<code>Find&lt;LibaryName&gt;.cmake</code>中的<code>&lt;LibaryName&gt;</code>部分，大小写必须完全一致</strong></p>
<p>我们以<code>curl</code>库为例，假设我们项目需要引入这个库，从网站中请求网页到本地，我们看到官方已经定义好了<code>FindCURL.cmake</code>。所以我们在<code>CMakeLists.txt</code>中可以直接用<code>find_pakcage</code>进行引用</p>
<p>对于系统预定义的<code>Find&lt;LibaryName&gt;.cmake</code>模块，使用方法如下，每一个模块都会定义以下几个变量（这些信息会在<code>Find&lt;LibaryName&gt;.cmake</code>文件的最上方注释中说明）。<strong>注意，这些变量命名只是规范，命名中<code>&lt;LibaryName&gt;</code>部分是全部大写还是包含大小写完全由<code>Find&lt;LibaryName&gt;.cmake</code>文件决定。一般来说是大写的，例如<code>FindDemo.cmake</code>中定义的变量名为<code>DEMO_FOUND</code></strong></p>
<ul>
<li><code>&lt;LibaryName&gt;_FOUND</code></li>
<li><code>&lt;LibaryName&gt;_INCLUDE_DIR</code></li>
<li><code>&lt;LibaryName&gt;_LIBRARY</code>：该模块通过<code>add_library</code>定义的名称</li>
<li><code>&lt;LibaryName&gt;_STATIC_LIB</code></li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(CURL)</span><br><span class="line"><span class="keyword">add_executable</span>(curltest curltest.cc)</span><br><span class="line"><span class="keyword">if</span>(CURL_FOUND)</span><br><span class="line">    <span class="keyword">target_include_directories</span>(clib PRIVATE <span class="variable">$&#123;CURL_INCLUDE_DIR&#125;</span>)</span><br><span class="line">    <span class="keyword">target_link_libraries</span>(curltest <span class="variable">$&#123;CURL_LIBRARY&#125;</span>)</span><br><span class="line"><span class="keyword">else</span>(CURL_FOUND)</span><br><span class="line">    <span class="keyword">message</span>(FATAL_ERROR ”CURL library <span class="keyword">not</span> found”)</span><br><span class="line"><span class="keyword">endif</span>(CURL_FOUND)</span><br></pre></td></tr></table></figure>
<p>你可以通过<code>&lt;LibaryName&gt;_FOUND</code>来判断模块是否被找到，如果没有找到，按照工程的需要关闭某些特性、给出提醒或者中止编译，上面的例子就是报出致命错误并终止构建。如果<code>&lt;LibaryName&gt;_FOUND</code>为真，则将<code>&lt;LibaryName&gt;_INCLUDE_DIR</code>加入<code>INCLUDE_DIRECTORIES</code></p>
<h3 id="5141-add-non-official-library"><a class="markdownIt-Anchor" href="#5141-add-non-official-library"></a> 5.14.1 Add Non-Official Library</h3>
<p><strong>通过<code>find_package</code>引入非官方的库，该方式只对支持cmake编译安装的库有效</strong></p>
<p>一般来说说，对于需要引入的三方库<code>xxx</code>，步骤通常如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/xxx.git</span><br><span class="line"><span class="built_in">cd</span> xxx</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line"></span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>假设此时我们需要引入<code>glog</code>库来进行日志的记录，我们在<code>Module</code>目录下并没有找到<code>FindGlog.cmake</code>。所以我们需要自行安装<code>glog</code>库，再进行引用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/google/glog.git </span><br><span class="line"><span class="built_in">cd</span> glog</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># BUILD_SHARED_LIBS用于控制生成动态库还是静态库，默认是动态库，这里我们选择静态库</span></span><br><span class="line">cmake -DBUILD_SHARED_LIBS=OFF ..</span><br><span class="line">make -j 4</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>此时我们便可以通过与引入<code>curl</code>库一样的方式引入<code>glog</code>库了</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(GLOG)</span><br><span class="line"><span class="keyword">add_executable</span>(myexec glogtest.cc)</span><br><span class="line"><span class="keyword">if</span>(GLOG_FOUND)</span><br><span class="line">    <span class="comment"># 由于glog在连接时将头文件直接链接到了库里面，所以这里不用显示调用target_include_directories</span></span><br><span class="line">    <span class="keyword">target_link_libraries</span>(myexec glog::glog)</span><br><span class="line"><span class="keyword">else</span>(GLOG_FOUND)</span><br><span class="line">    <span class="keyword">message</span>(FATAL_ERROR ”GLOG library <span class="keyword">not</span> found”)</span><br><span class="line"><span class="keyword">endif</span>(GLOG_FOUND)</span><br></pre></td></tr></table></figure>
<h3 id="5142-module-mode-config-mode"><a class="markdownIt-Anchor" href="#5142-module-mode-config-mode"></a> 5.14.2 Module Mode &amp; Config Mode</h3>
<p>通过上文我们了解了通过<code>cmake</code>引入依赖库的基本用法。知其然也要知其所以然，<code>find_package</code>对我们来说是一个黑盒子，那么它是具体通过什么方式来查找到我们依赖的库文件的路径的呢。到这里我们就不得不聊到<code>find_package</code>的两种模式，一种是<code>Module</code>模式，也就是我们引入<code>curl</code>库的方式。另一种叫做<code>Config</code>模式，也就是引入<code>glog</code>库的模式。下面我们来详细介绍着两种方式的运行机制</p>
<p>在<code>Module</code>模式中，<code>cmake</code>需要找到一个叫做<code>Find&lt;LibraryName&gt;.cmake</code>的文件。这个文件负责找到库所在的路径，为我们的项目引入头文件路径和库文件路径。<code>cmake</code>搜索这个文件的路径有两个，一个是上文提到的<code>cmake</code>安装目录下的<code>share/cmake-&lt;version&gt;/Modules</code>目录（例如<code>/usr/local/lib/cmake-3.21.2-linux-x86_64/share/cmake-3.21/Modules</code>），另一个使我们指定的<code>CMAKE_MODULE_PATH</code>的所在目录</p>
<p>如果<code>Module</code>模式搜索失败，没有找到对应的<code>Find&lt;LibraryName&gt;.cmake</code>文件，则转入<code>Config</code>模式进行搜索。它主要通过<code>&lt;LibraryName&gt;Config.cmake</code>或<code>&lt;lower-case-package-name&gt;-config.cmake</code>这两个文件来引入我们需要的库。以我们刚刚安装的<code>glog</code>库为例，在我们安装之后，它在<code>/usr/local/lib/cmake/glog/</code>目录下生成了<code>glog-config.cmake</code>文件，而<code>/usr/local/lib/cmake/glog/</code>正是<code>find_package</code>函数的搜索路径之一</p>
<h3 id="5143-create-customized-findlibrarynamecmake"><a class="markdownIt-Anchor" href="#5143-create-customized-findlibrarynamecmake"></a> 5.14.3 Create Customized <code>Find&lt;LibraryName&gt;.cmake</code></h3>
<p>假设我们编写了一个新的函数库，我们希望别的项目可以通过<code>find_package</code>对它进行引用我们应该怎么办呢。</p>
<p>我们在当前目录下新建一个<code>ModuleMode</code>的文件夹，在里面我们编写一个计算两个整数之和的一个简单的函数库。库函数以手工编写<code>Makefile</code>的方式进行安装，库文件安装在<code>/usr/lib</code>目录下，头文件放在<code>/usr/include</code>目录下。其中的<code>Makefile</code>文件如下：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、准备工作，编译方式、目标文件名、依赖库路径的定义。</span></span><br><span class="line">CC = g++</span><br><span class="line">CFLAGS  := -Wall -O3 -std=c++11 </span><br><span class="line"></span><br><span class="line">OBJS = libadd.o <span class="comment">#.o文件与.cpp文件同名</span></span><br><span class="line">LIB = libadd.so <span class="comment"># 目标文件名</span></span><br><span class="line">INCLUDE = ./ <span class="comment"># 头文件目录</span></span><br><span class="line">HEADER = libadd.h <span class="comment"># 头文件</span></span><br><span class="line"></span><br><span class="line">all : <span class="variable">$(LIB)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 生成.o文件 </span></span><br><span class="line"><span class="variable">$(OBJS)</span> : libadd.cc</span><br><span class="line">    <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -I ./ -fpic -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 生成动态库文件</span></span><br><span class="line"><span class="variable">$(LIB)</span> : <span class="variable">$(OBJS)</span></span><br><span class="line">    rm -f <span class="variable">$@</span></span><br><span class="line">    g++ <span class="variable">$(OBJS)</span> -shared -o <span class="variable">$@</span> </span><br><span class="line">    rm -f <span class="variable">$(OBJS)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 删除中间过程生成的文件 </span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm -f <span class="variable">$(OBJS)</span> <span class="variable">$(TARGET)</span> <span class="variable">$(LIB)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.安装文件</span></span><br><span class="line"><span class="section">install:</span></span><br><span class="line">    cp <span class="variable">$(LIB)</span> /usr/lib</span><br><span class="line">    cp <span class="variable">$(HEADER)</span> /usr/<span class="keyword">include</span></span><br></pre></td></tr></table></figure>
<p>编译安装：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>接下来我们回到我们的<code>cmake</code>项目中来，在<code>cmake</code>文件夹下新建一个<code>FindAdd.cmake</code>的文件。我们的目标是找到库的头文件所在目录和共享库文件的所在位置</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在指定目录下寻找头文件和动态库文件的位置，可以指定多个目标路径</span></span><br><span class="line"><span class="keyword">find_path</span>(ADD_INCLUDE_DIR libadd.h /usr/<span class="keyword">include</span>/ /usr/local/<span class="keyword">include</span> <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/ModuleMode)</span><br><span class="line"><span class="keyword">find_library</span>(<span class="keyword">ADD_LIBRARY</span> NAMES add PATHS /usr/lib/add /usr/local/lib/add <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/ModuleMode)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ADD_INCLUDE_DIR <span class="keyword">AND</span> <span class="keyword">ADD_LIBRARY</span>)</span><br><span class="line">    <span class="keyword">set</span>(ADD_FOUND <span class="keyword">TRUE</span>)</span><br><span class="line"><span class="keyword">endif</span> (ADD_INCLUDE_DIR <span class="keyword">AND</span> <span class="keyword">ADD_LIBRARY</span>)</span><br></pre></td></tr></table></figure>
<p>这时我们便可以像引用<code>curl</code>一样引入我们自定义的库了，在<code>CMakeLists.txt</code>添加</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将项目目录下的cmake文件夹加入到CMAKE_MODULE_PATH中，让find_pakcage能够找到我们自定义的函数库</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_MODULE_PATH <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;/cmake;$&#123;CMAKE_MODULE_PATH&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">add_executable</span>(addtest addtest.cc)</span><br><span class="line"><span class="keyword">find_package</span>(ADD)</span><br><span class="line"><span class="keyword">if</span>(ADD_FOUND)</span><br><span class="line">    <span class="keyword">target_include_directories</span>(addtest PRIVATE <span class="variable">$&#123;ADD_INCLUDE_DIR&#125;</span>)</span><br><span class="line">    <span class="keyword">target_link_libraries</span>(addtest <span class="variable">$&#123;ADD_LIBRARY&#125;</span>)</span><br><span class="line"><span class="keyword">else</span>(ADD_FOUND)</span><br><span class="line">    <span class="keyword">message</span>(FATAL_ERROR <span class="string">&quot;ADD library not found&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>(ADD_FOUND)</span><br></pre></td></tr></table></figure>
<h2 id="515-find_library"><a class="markdownIt-Anchor" href="#515-find_library"></a> 5.15 find_library</h2>
<p><code>find_library</code>用于查找库文件，示例如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NAMES 后可接多个可能的别名，结果保存到变量 THRIFT_LIB 中</span></span><br><span class="line"><span class="keyword">find_library</span>(THRIFT_LIB NAMES thrift)</span><br></pre></td></tr></table></figure>
<h2 id="516-find_path"><a class="markdownIt-Anchor" href="#516-find_path"></a> 5.16 find_path</h2>
<p><code>find_path</code>用于查找包含给定文件的目录，示例如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NAMES 后可接多个可能的别名，结果保存到变量 BRPC_INCLUDE_PATH 中</span></span><br><span class="line"><span class="keyword">find_path</span>(BRPC_INCLUDE_PATH NAMES brpc/server.h)</span><br></pre></td></tr></table></figure>
<h2 id="517-aux_source_directory"><a class="markdownIt-Anchor" href="#517-aux_source_directory"></a> 5.17 aux_source_directory</h2>
<p>Find all source files in a directory</p>
<h2 id="518-public-vs-private"><a class="markdownIt-Anchor" href="#518-public-vs-private"></a> 5.18 PUBLIC vs. PRIVATE</h2>
<blockquote>
<p>In CMake, PUBLIC and PRIVATE are used to specify the visibility of target properties and dependencies. Here’s what they mean:</p>
</blockquote>
<blockquote>
<p>PUBLIC: A property or dependency marked as PUBLIC is visible to all targets that depend on the current target. This means that the property or dependency will be propagated to any targets that link against the current target.</p>
<ul>
<li>For example, suppose you have a library target called “foo” that depends on another library called “bar”. If you mark the dependency on “bar” as PUBLIC, any target that links against “foo” will also link against “bar”.</li>
</ul>
</blockquote>
<blockquote>
<p>PRIVATE: A property or dependency marked as PRIVATE is only visible to the current target. This means that the property or dependency will not be propagated to any targets that depend on the current target.</p>
<ul>
<li>For example, suppose you have a library target called “foo” that uses a header file called “bar.h”. If you mark the header file as PRIVATE, any targets that depend on “foo” will not be able to access “bar.h”.</li>
</ul>
</blockquote>
<blockquote>
<p>To summarize, PUBLIC properties and dependencies are visible to all targets that depend on the current target, while PRIVATE properties and dependencies are only visible to the current target.</p>
</blockquote>
<p>示例如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── bar</span><br><span class="line">│   ├── bar.cpp</span><br><span class="line">│   └── bar.h</span><br><span class="line">├── foo</span><br><span class="line">│   ├── foo.cpp</span><br><span class="line">│   └── foo.h</span><br><span class="line">└── main.cpp</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMakeLists.txt</span></span><br><span class="line"><span class="built_in">cat</span> &gt; CMakeLists.txt &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">cmake_minimum_required(VERSION 3.10)</span><br><span class="line"></span><br><span class="line"><span class="comment"># set the project name and version</span></span><br><span class="line">project(Visibility VERSION 1.0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># specify the C++ standard</span></span><br><span class="line"><span class="built_in">set</span>(CMAKE_CXX_STANDARD 11)</span><br><span class="line"><span class="built_in">set</span>(CMAKE_CXX_STANDARD_REQUIRED True)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add library bar</span></span><br><span class="line">add_library(libbar bar/bar.cpp)</span><br><span class="line">target_include_directories(libbar PUBLIC <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/bar)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add library foo</span></span><br><span class="line">add_library(libfoo foo/foo.cpp)</span><br><span class="line">target_include_directories(libfoo PUBLIC <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/foo)</span><br><span class="line">target_link_libraries(libfoo PUBLIC libbar)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the executable</span></span><br><span class="line">add_executable(main main.cpp)</span><br><span class="line">target_link_libraries(main PRIVATE libfoo)</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p foo</span><br><span class="line"></span><br><span class="line"><span class="comment"># foo/foo.h</span></span><br><span class="line"><span class="built_in">cat</span> &gt; foo/foo.h &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#pragma once</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;string&gt;</span></span><br><span class="line"></span><br><span class="line">void greet_foo(const std::string&amp; name);</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># foo/foo.cpp</span></span><br><span class="line"><span class="built_in">cat</span> &gt; foo/foo.cpp &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#include &quot;foo.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#include &quot;bar.h&quot;</span></span><br><span class="line"></span><br><span class="line">void greet_foo(const std::string&amp; name) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello &quot;</span> &lt;&lt; <span class="string">name &lt;&lt; &quot;, this is foo. And I&#x27;ll take you to meet bar. &quot;;</span></span><br><span class="line"><span class="string">    greet_bar(&quot;foo&quot;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mkdir -p bar</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># bar/bar.h</span></span><br><span class="line"><span class="string">cat &gt; bar/bar.h &lt;&lt; &#x27;EOF&#x27;</span></span><br><span class="line"><span class="string">#pragma once</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#include &lt;string&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">void greet_bar(const std::string&amp; name</span>);</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># bar/bar.cpp</span></span><br><span class="line"><span class="built_in">cat</span> &gt; bar/bar.cpp &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#include &quot;bar.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line">void greet_bar(const std::string&amp; name) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello &quot;</span> &lt;&lt; <span class="string">name &lt;&lt; &quot;, this is bar.&quot; &lt;&lt; std::endl;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># main.cpp</span></span><br><span class="line"><span class="string">cat &gt; main.cpp &lt;&lt; &#x27;EOF&#x27;</span></span><br><span class="line"><span class="string">#include &quot;bar.h&quot;</span></span><br><span class="line"><span class="string">#include &quot;foo.h&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">int main() &#123;</span></span><br><span class="line"><span class="string">    greet_foo(&quot;main&quot;);</span></span><br><span class="line"><span class="string">    greet_bar(&quot;main&quot;);</span></span><br><span class="line"><span class="string">    return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cmake -B build &amp;&amp; cmake --build build</span></span><br><span class="line"><span class="string">build/main</span></span><br></pre></td></tr></table></figure>
<p><strong>如果将<code>target_link_libraries(libfoo PUBLIC libbar)</code>中的<code>PUBLIC</code>改成<code>PRIVATE</code>，那么编译将会无法通过，因为<code>main</code>没有显式依赖<code>libbar</code>，会找不到头文件<code>bar.h</code></strong></p>
<h1 id="6-tips"><a class="markdownIt-Anchor" href="#6-tips"></a> 6 Tips</h1>
<h2 id="61-command-line"><a class="markdownIt-Anchor" href="#61-command-line"></a> 6.1 Command Line</h2>
<ul>
<li><code>cmake --help</code>
<ul>
<li><code>Generators</code>，默认使用<code>Unix Makefiles</code></li>
</ul>
</li>
<li><code>build</code>
<ul>
<li><code>cmake &lt;path-to-source&gt;</code>：当前目录作为<code>&lt;build_path&gt;</code></li>
<li><code>cmake -S &lt;path-to-source&gt;</code>：当前目录作为<code>&lt;build_path&gt;</code></li>
<li><code>cmake -B &lt;build_path&gt;</code>：当前目录作为<code>&lt;path-to-source&gt;</code></li>
<li><code>cmake -B &lt;build_path&gt; &lt;path-to-source&gt;</code></li>
<li><code>cmake -B &lt;build_path&gt; -S &lt;path-to-source&gt;</code></li>
</ul>
</li>
<li><code>cmake --build &lt;build_path&gt;</code>：等效于在<code>&lt;build_path&gt;</code>中执行<code>make</code>命令
<ul>
<li><code>cmake --build &lt;build_path&gt; -j 16</code>：等效于在<code>&lt;build_path&gt;</code>中执行<code>make -j 16</code>命令</li>
</ul>
</li>
<li><code>cmake --install &lt;build_path&gt;</code>：等效于在<code>&lt;build_path&gt;</code>中执行<code>make install</code>命令</li>
</ul>
<h2 id="62-print-all-variables"><a class="markdownIt-Anchor" href="#62-print-all-variables"></a> 6.2 Print All Variables</h2>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get_cmake_property</span>(_variableNames VARIABLES)</span><br><span class="line"><span class="keyword">foreach</span> (_variableName <span class="variable">$&#123;_variableNames&#125;</span>)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;$&#123;_variableName&#125;=$&#123;$&#123;_variableName&#125;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>
<h2 id="63-print-all-envs"><a class="markdownIt-Anchor" href="#63-print-all-envs"></a> 6.3 Print All Envs</h2>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">execute_process</span>(<span class="keyword">COMMAND</span> <span class="string">&quot;$&#123;CMAKE_COMMAND&#125;&quot;</span> <span class="string">&quot;-E&quot;</span> <span class="string">&quot;environment&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="64-specify-compiler"><a class="markdownIt-Anchor" href="#64-specify-compiler"></a> 6.4 Specify Compiler</h2>
<h3 id="641-command"><a class="markdownIt-Anchor" href="#641-command"></a> 6.4.1 Command</h3>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -DCMAKE_CXX_COMPILER=/usr/local/bin/g++ -DCMAKE_C_COMPILER=/usr/local/bin/gcc ..</span><br></pre></td></tr></table></figure>
<h3 id="642-cmakeliststxt"><a class="markdownIt-Anchor" href="#642-cmakeliststxt"></a> 6.4.2 CMakeLists.txt</h3>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_C_COMPILER <span class="string">&quot;/path/to/gcc&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_COMPILER <span class="string">&quot;/path/to/g++&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="65-add-compile-options"><a class="markdownIt-Anchor" href="#65-add-compile-options"></a> 6.5 Add Compile Options</h2>
<h3 id="651-command"><a class="markdownIt-Anchor" href="#651-command"></a> 6.5.1 Command</h3>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -DCMAKE_C_FLAGS=<span class="string">&quot;<span class="variable">$&#123;CMAKE_C_FLAGS&#125;</span> -O3&quot;</span> -DCMAKE_CXX_FLAGS=<span class="string">&quot;<span class="variable">$&#123;CMAKE_CXX_FLAGS&#125;</span> -O3&quot;</span> ..</span><br></pre></td></tr></table></figure>
<h3 id="652-cmakeliststxt"><a class="markdownIt-Anchor" href="#652-cmakeliststxt"></a> 6.5.2 CMakeLists.txt</h3>
<p><strong>示例如下：</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -O3 -Wall -fopt-info-vec&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_BUILD_TYPE <span class="string">&quot;Release&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS_DEBUG <span class="string">&quot;$ENV&#123;CXXFLAGS&#125; -O0 -Wall -g2 -ggdb&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS_RELEASE <span class="string">&quot;$ENV&#123;CXXFLAGS&#125; -O1 -Wall&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong><code>CMAKE_BUILD_TYPE</code>的所有可选值包括</strong></p>
<ol>
<li><code>Debug</code></li>
<li><code>Release</code></li>
<li><code>RelWithDebInfo</code></li>
<li><code>MinSizeRel</code></li>
</ol>
<h2 id="66-build-type"><a class="markdownIt-Anchor" href="#66-build-type"></a> 6.6 Build Type</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If you want to build for debug (including source information, i.e. -g) when compiling, use</span></span><br><span class="line">cmake -DCMAKE_BUILD_TYPE=Debug &lt;path&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo &lt;path&gt;</span></span><br><span class="line">cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo &lt;path&gt;</span><br></pre></td></tr></table></figure>
<p><strong><code>CMAKE_BUILD_TYPE</code>的所有可选值包括</strong></p>
<ol>
<li><code>Debug</code></li>
<li><code>Release</code></li>
<li><code>RelWithDebInfo</code></li>
<li><code>MinSizeRel</code></li>
</ol>
<h2 id="67-include-all-source-file"><a class="markdownIt-Anchor" href="#67-include-all-source-file"></a> 6.7 Include All Source File</h2>
<h3 id="671-file"><a class="markdownIt-Anchor" href="#671-file"></a> 6.7.1 file</h3>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Search for all .cpp and .h files in the current directory</span></span><br><span class="line"><span class="keyword">file</span>(GLOB MY_PROJECT_SOURCES <span class="string">&quot;*.cpp&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the found files to the executable</span></span><br><span class="line"><span class="keyword">add_executable</span>(MyExecutable <span class="variable">$&#123;MY_PROJECT_SOURCES&#125;</span>)</span><br></pre></td></tr></table></figure>
<p>If your project has a more complex structure and you wish to recursively search all subdirectories for files, you can replace the <code>file(GLOB ...) command with </code>file(GLOB_RECURSE …)`:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">file</span>(GLOB_RECURSE MY_PROJECT_SOURCES <span class="string">&quot;*.cpp&quot;</span>)</span><br><span class="line"><span class="keyword">add_executable</span>(MyExecutable <span class="variable">$&#123;MY_PROJECT_SOURCES&#125;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="672-aux_source_directory"><a class="markdownIt-Anchor" href="#672-aux_source_directory"></a> 6.7.2 aux_source_directory</h3>
<p>如果同一个目录下有多个源文件，那么在使用<code>add_executable</code>命令的时候，如果要一个个填写，那么将会非常麻烦，并且后续维护的代价也很大</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(Demo main.cxx opt1.cxx opt2.cxx)</span><br></pre></td></tr></table></figure>
<p>我们可以使用<code>aux_source_directory(&lt;dir&gt; &lt;variable&gt;)</code>）命令，该命令可以扫描一个目录下得所有源文件，并将文件列表赋值给一个变量</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找当前目录下的所有源文件</span></span><br><span class="line"><span class="comment"># 并将名称保存到 DIR_SRCS 变量</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. DIR_SRCS)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定生成目标</span></span><br><span class="line"><span class="keyword">add_executable</span>(Demo <span class="variable">$&#123;DIR_SRCS&#125;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="68-print-all-compile-command"><a class="markdownIt-Anchor" href="#68-print-all-compile-command"></a> 6.8 Print All Compile Command</h2>
<p><code>cmake</code>指定参数<code>-DCMAKE_VERBOSE_MAKEFILE=ON</code>即可</p>
<h2 id="69-生成compile_commandsjson文件"><a class="markdownIt-Anchor" href="#69-生成compile_commandsjson文件"></a> 6.9 生成<code>compile_commands.json</code>文件</h2>
<p><code>cmake</code>指定参数<code>-DCMAKE_EXPORT_COMPILE_COMMANDS=ON</code>即可。构建完成后，会在构建目录生成<code>compile_commands.json</code>，里面包含了每个源文件的编译命令</p>
<h2 id="610-auto-generate-compile_commandsjson-and-copy-to-project-source-root"><a class="markdownIt-Anchor" href="#610-auto-generate-compile_commandsjson-and-copy-to-project-source-root"></a> 6.10 Auto generate compile_commands.json and copy to project source root</h2>
<p>参考<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/57464766/copy-compile-commands-json-to-project-root-folder">Copy compile_commands.json to project root folder</a></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_custom_target</span>(</span><br><span class="line">    copy-compile-commands ALL</span><br><span class="line">    <span class="variable">$&#123;CMAKE_COMMAND&#125;</span> -E copy_if_different</span><br><span class="line">        <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/compile_commands.json</span><br><span class="line">        <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<h1 id="7-reference"><a class="markdownIt-Anchor" href="#7-reference"></a> 7 Reference</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html">CMake Tutorial</a>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Kitware/CMake/tree/master/Help/guide/tutorial">CMake Tutorial对应的source code</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6df3857462cd">CMake Tutorial 翻译</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://www.hahack.com/codes/cmake/">CMake 入门实战</a></li>
<li><a target="_blank" rel="noopener" href="https://leehao.me/cmake-%E8%AF%AD%E8%A8%80-15-%E5%88%86%E9%92%9F%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/">CMake 语言 15 分钟入门教程</a></li>
<li><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-buildsystem.7.html#manual:cmake-buildsystem(7)">CMake Table of Contents</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/31969547/what-is-the-difference-between-include-directories-and-target-include-directorie/40244458">What is the difference between include_directories and target_include_directories in CMake?</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/97369704">Cmake之深入理解find_package()的用法</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag"># 原创</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/09/06/Cpp-Tools-Make/" rel="prev" title="Cpp-Tools-Make">
      <i class="fa fa-chevron-left"></i> Cpp-Tools-Make
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/09/06/Cpp-Thirdparty-Library/" rel="next" title="Cpp-Thirdparty-Library">
      Cpp-Thirdparty-Library <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-valine">valine</a></li>
            <li class="tab"><a href="#comment-livere">livere</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
            <div class="tab-pane livere" id="comment-livere">
              
  <div class="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC8zMzY0My8xMDE5OA=="></div>
  </div>
  
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-tutorial"><span class="nav-text"> 1 tutorial</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#11-step1-a-basic-starting-point"><span class="nav-text"> 1.1 step1: A Basic Starting Point</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-step2-adding-a-library-and-adding-usage-requirements-for-a-library"><span class="nav-text"> 1.2 step2: Adding a Library and Adding Usage Requirements for a Library</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-step3-installing"><span class="nav-text"> 1.3 step3: Installing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-step4-testing"><span class="nav-text"> 1.4 step4: Testing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-step5-adding-system-introspection"><span class="nav-text"> 1.5 step5: Adding System Introspection</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-target"><span class="nav-text"> 2 target</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-variables"><span class="nav-text"> 3 variables</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#31-frequently-used-variables"><span class="nav-text"> 3.1 Frequently-Used Variables</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#32-build_shared_libs"><span class="nav-text"> 3.2 BUILD_SHARED_LIBS</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-property"><span class="nav-text"> 4 property</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#41-include_directories"><span class="nav-text"> 4.1 INCLUDE_DIRECTORIES</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#42-link_directories"><span class="nav-text"> 4.2 LINK_DIRECTORIES</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#43-link_libraries"><span class="nav-text"> 4.3 LINK_LIBRARIES</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-command"><span class="nav-text"> 5 command</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#51-message"><span class="nav-text"> 5.1 message</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#52-set"><span class="nav-text"> 5.2 set</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#53-option"><span class="nav-text"> 5.3 option</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#54-file"><span class="nav-text"> 5.4 file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#55-add_executable"><span class="nav-text"> 5.5 add_executable</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#56-add_library"><span class="nav-text"> 5.6 add_library</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#57-set_target_properties"><span class="nav-text"> 5.7 set_target_properties</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#58-target_compile_options"><span class="nav-text"> 5.8 target_compile_options</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#59-target_link_libraries"><span class="nav-text"> 5.9 target_link_libraries</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#510-target_include_directories"><span class="nav-text"> 5.10 target_include_directories</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#511-include_directories"><span class="nav-text"> 5.11 include_directories</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#512-add_subdirectory"><span class="nav-text"> 5.12 add_subdirectory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#513-include"><span class="nav-text"> 5.13 include</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#514-find_package"><span class="nav-text"> 5.14 find_package</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5141-add-non-official-library"><span class="nav-text"> 5.14.1 Add Non-Official Library</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5142-module-mode-config-mode"><span class="nav-text"> 5.14.2 Module Mode &amp; Config Mode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5143-create-customized-findlibrarynamecmake"><span class="nav-text"> 5.14.3 Create Customized Find&lt;LibraryName&gt;.cmake</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#515-find_library"><span class="nav-text"> 5.15 find_library</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#516-find_path"><span class="nav-text"> 5.16 find_path</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#517-aux_source_directory"><span class="nav-text"> 5.17 aux_source_directory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#518-public-vs-private"><span class="nav-text"> 5.18 PUBLIC vs. PRIVATE</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-tips"><span class="nav-text"> 6 Tips</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#61-command-line"><span class="nav-text"> 6.1 Command Line</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#62-print-all-variables"><span class="nav-text"> 6.2 Print All Variables</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#63-print-all-envs"><span class="nav-text"> 6.3 Print All Envs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#64-specify-compiler"><span class="nav-text"> 6.4 Specify Compiler</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#641-command"><span class="nav-text"> 6.4.1 Command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#642-cmakeliststxt"><span class="nav-text"> 6.4.2 CMakeLists.txt</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#65-add-compile-options"><span class="nav-text"> 6.5 Add Compile Options</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#651-command"><span class="nav-text"> 6.5.1 Command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#652-cmakeliststxt"><span class="nav-text"> 6.5.2 CMakeLists.txt</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#66-build-type"><span class="nav-text"> 6.6 Build Type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#67-include-all-source-file"><span class="nav-text"> 6.7 Include All Source File</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#671-file"><span class="nav-text"> 6.7.1 file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#672-aux_source_directory"><span class="nav-text"> 6.7.2 aux_source_directory</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#68-print-all-compile-command"><span class="nav-text"> 6.8 Print All Compile Command</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#69-%E7%94%9F%E6%88%90compile_commandsjson%E6%96%87%E4%BB%B6"><span class="nav-text"> 6.9 生成compile_commands.json文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#610-auto-generate-compile_commandsjson-and-copy-to-project-source-root"><span class="nav-text"> 6.10 Auto generate compile_commands.json and copy to project source root</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-reference"><span class="nav-text"> 7 Reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Liuyehcf"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Liuyehcf</p>
  <div class="site-description" itemprop="description">大音希声，大象无形</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">287</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">98</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liuyehcf</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'qhEhLuMeMOy1zgcBhkqUS6P8-gzGzoHsz',
      appKey     : 'uhkruDLNLNdL5rQjRBY2X9Ke',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

<script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script>

</body>
</html>
