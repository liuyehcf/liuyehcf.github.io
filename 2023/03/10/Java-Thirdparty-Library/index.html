<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="阅读更多">
<meta property="og:type" content="article">
<meta property="og:title" content="Java-Thirdparty-Library">
<meta property="og:url" content="http://example.com/2023/03/10/Java-Thirdparty-Library/index.html">
<meta property="og:site_name" content="Liuye Notebook">
<meta property="og:description" content="阅读更多">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-03-10T12:13:29.000Z">
<meta property="article:modified_time" content="2025-04-10T15:59:09.000Z">
<meta property="article:author" content="Liuyehcf">
<meta property="article:tag" content="原创">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2023/03/10/Java-Thirdparty-Library/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Java-Thirdparty-Library | Liuye Notebook</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Liuye Notebook</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-explore">

    <a href="/explore/" rel="section"><i class="fa fa-sitemap fa-fw"></i>发现</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/10/Java-Thirdparty-Library/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Liuyehcf">
      <meta itemprop="description" content="大音希声，大象无形">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liuye Notebook">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Java-Thirdparty-Library
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-10 20:13:29" itemprop="dateCreated datePublished" datetime="2023-03-10T20:13:29+08:00">2023-03-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-10 23:59:09" itemprop="dateModified" datetime="2025-04-10T23:59:09+08:00">2025-04-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          
            <span id="/2023/03/10/Java-Thirdparty-Library/" class="post-meta-item leancloud_visitors" data-flag-title="Java-Thirdparty-Library" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/03/10/Java-Thirdparty-Library/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/03/10/Java-Thirdparty-Library/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><strong>阅读更多</strong></p>
<span id="more"></span>
<h1 id="1-frequently-used-utils"><a class="markdownIt-Anchor" href="#1-frequently-used-utils"></a> 1 Frequently-Used-Utils</h1>
<p><strong><code>commons</code>：</strong></p>
<ol>
<li><code>commons-lang:commons-lang</code></li>
<li><code>commons-collections:commons-collections</code></li>
<li><code>commons-configuration:commons-configuration</code></li>
<li><code>commons-io:commons-io</code></li>
<li><code>commons-codec:commons-codec</code></li>
<li><code>commons-net:commons-net</code></li>
<li><code>commons-cli:commons-cli</code></li>
<li><code>commons-logging:commons-logging</code></li>
</ol>
<p><strong><code>apache</code>：</strong></p>
<ol>
<li><code>org.apache.commons:commons-lang3</code></li>
<li><code>org.apache.commons:commons-collections4</code></li>
<li><code>org.apache.commons:commons-configuration2</code></li>
<li><code>org.apache.httpcomponents:httpclient</code></li>
<li><code>org.apache.commons:commons-pool2</code></li>
<li><code>org.apache.commons:commons-csv</code></li>
</ol>
<p><strong><code>google</code>：</strong></p>
<ol>
<li><code>com.google.guava:guava</code></li>
<li><code>com.google.code.gson:gson</code></li>
</ol>
<p><strong><code>Plugin</code>：</strong></p>
<ol>
<li><code>org.apache.maven.plugins:maven-compiler-plugin</code></li>
<li><code>org.springframework.boot:spring-boot-maven-plugin</code>
<ul>
<li>配置参数（<code>&lt;configuration&gt;</code>）：
<ul>
<li><code>includeSystemScope</code></li>
<li><code>mainClass</code></li>
</ul>
</li>
<li>默认情况下，会讲资源文件打包，并放置在<code>BOOT-INF/classes</code>。需要使用<code>Thread.currentThread().getContextClassLoader()</code>而不能使用<code>ClassLoader.getSystemClassLoader()</code>。因为<code>Thread.currentThread().getContextClassLoader()</code>这个类加载器是<code>Spring Boot</code>应用程序运行时默认使用的类加载器，它知道资源文件放在了<code>BOOT-INF/classes</code>，而<code>ClassLoader.getSystemClassLoader()</code>并不知道这一信息</li>
</ul>
</li>
</ol>
<h1 id="2-slf4j"><a class="markdownIt-Anchor" href="#2-slf4j"></a> 2 SLF4J</h1>
<p><code>SLF4J</code>，即简单日志门面（<code>Simple Logging Facade for Java, SLF4J</code>），不是具体的日志解决方案，它只服务于各种各样的日志系统。按照官方的说法，<code>SLF4J</code>是一个用于日志系统的简单<code>Facade</code>，允许最终用户在部署其应用时使用其所希望的日志系统</p>
<p>实际上，<code>SLF4J</code>所提供的核心<code>API</code>是一些接口以及一个<code>LoggerFactory</code>的工厂类。从某种程度上，<code>SLF4J</code>有点类似<code>JDBC</code>，不过比<code>JDBC</code>更简单，在<code>JDBC</code>中，你需要指定驱动程序，而在使用<code>SLF4J</code>的时候，不需要在代码中或配置文件中指定你打算使用那个具体的日志系统。如同使用<code>JDBC</code>基本不用考虑具体数据库一样，<code>SLF4J</code>提供了统一的记录日志的接口，只要按照其提供的方法记录即可，最终日志的格式、记录级别、输出方式等通过具体日志系统的配置来实现，因此可以在应用中灵活切换日志系统</p>
<p><strong>简单地说，<code>SLF4J</code>只提供日志框架的接口，而不提供具体的实现。因此<code>SLF4J</code>必须配合具体的日志框架才能正常工作</strong></p>
<h2 id="21-log4j2"><a class="markdownIt-Anchor" href="#21-log4j2"></a> 2.1 log4j2</h2>
<p><a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/index.html">Apache Log4j Doc</a></p>
<h3 id="211-maven"><a class="markdownIt-Anchor" href="#211-maven"></a> 2.1.1 Maven</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SLF4J API --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Log4j2 API --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Log4j2 Core --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Log4j2 SLF4J Binding --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-slf4j-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Compatible with Log4j1, only if some dependencies rely on log4j1&#x27;s api --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-1.2-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="212-demo"><a class="markdownIt-Anchor" href="#212-demo"></a> 2.1.2 Demo</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;ConsoleAppender&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %style&#123;[%thread]&#125;&#123;bright&#125; %highlight&#123;[%-5level] %logger&#123;36&#125;&#125;&#123;STYLE=Logback&#125; - %msg%n&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingRandomAccessFile</span> <span class="attr">name</span>=<span class="string">&quot;RollingRandomAccessFileAppender&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;logs/app.log&quot;</span> <span class="attr">filePattern</span>=<span class="string">&quot;logs/app-%d&#123;yyyy-MM-dd&#125;-%i.log&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %style&#123;[%thread]&#125;&#123;bright&#125; %highlight&#123;[%-5level] %logger&#123;36&#125;&#125;&#123;STYLE=Logback&#125; - %msg%n&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">&quot;1&quot;</span> <span class="attr">modulate</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;10MB&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">&quot;7&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Delete</span> <span class="attr">basePath</span>=<span class="string">&quot;logs&quot;</span> <span class="attr">maxDepth</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">IfFileName</span> <span class="attr">glob</span>=<span class="string">&quot;app-*.log&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">IfLastModified</span> <span class="attr">age</span>=<span class="string">&quot;7d&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Delete</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">DefaultRolloverStrategy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingRandomAccessFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Async</span> <span class="attr">name</span>=<span class="string">&quot;AsyncAppender&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;ConsoleAppender&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;RollingRandomAccessFileAppender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Async</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;AsyncAppender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Delete Action only works when file rolling triggered.</li>
</ul>
<h3 id="213-tips"><a class="markdownIt-Anchor" href="#213-tips"></a> 2.1.3 Tips</h3>
<h4 id="2131-command-line-options"><a class="markdownIt-Anchor" href="#2131-command-line-options"></a> 2.1.3.1 Command-Line Options</h4>
<ul>
<li>Specify configuration path: <code>-Dlog4j.configurationFile=path/to/log4j2.xml</code></li>
<li>Enable debug mode (refers to debug mode of <code>log4j2</code> itself)：<code>-Dlog4j.debug=true</code></li>
</ul>
<h4 id="2132-logger-name-pattern"><a class="markdownIt-Anchor" href="#2132-logger-name-pattern"></a> 2.1.3.2 Logger Name Pattern</h4>
<p>Syntanx: <code>%logger&#123;precision&#125;</code> or <code>%c&#123;precision&#125;</code></p>
<table>
<thead>
<tr>
<th style="text-align:left">Pattern</th>
<th style="text-align:left">LoggerName</th>
<th style="text-align:left">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>%c&#123;1&#125;</code></td>
<td style="text-align:left"><code>org.apache.commons.Foo</code></td>
<td style="text-align:left"><code>Foo</code></td>
</tr>
<tr>
<td style="text-align:left"><code>%c&#123;2&#125;</code></td>
<td style="text-align:left"><code>org.apache.commons.Foo</code></td>
<td style="text-align:left"><code>commons.Foo</code></td>
</tr>
<tr>
<td style="text-align:left"><code>%c&#123;1.&#125;</code></td>
<td style="text-align:left"><code>org.apache.commons.Foo</code></td>
<td style="text-align:left"><code>o.a.c.Foo</code></td>
</tr>
</tbody>
</table>
<h4 id="2133-color-configuration"><a class="markdownIt-Anchor" href="#2133-color-configuration"></a> 2.1.3.3 Color Configuration</h4>
<p><a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/manual/layouts.html#pattern-layout">Pattern Layout</a></p>
<ul>
<li><code>%highlight{pattern}{style}</code>
<ul>
<li><code>%highlight{[%thread] [%-5level] [%logger{36}]}{FATAL=red blink, ERROR=red, WARN=yellow, INFO=green, DEBUG=cyan, TRACE=blue}</code></li>
<li><code>%highlight{[%-5level] %logger{36}}{STYLE=Logback}</code></li>
</ul>
</li>
<li><code>%style{pattern}{ANSI style}</code>
<ul>
<li><code>%style{%logger}{red}</code></li>
<li><code>%style{[%thread]}{bright}</code></li>
</ul>
</li>
</ul>
<h4 id="2134-lookups"><a class="markdownIt-Anchor" href="#2134-lookups"></a> 2.1.3.4 Lookups</h4>
<p>Lookups provide a way to add values to the Log4j configuration at arbitrary places. They are a particular type of Plugin that implements the StrLookup interface. Information on how to use Lookups in configuration files can be found in the Property Substitution section of the Configuration page.</p>
<ul>
<li>System Properties Lookup: <code>$&#123;sys:xxx&#125;</code>
<ul>
<li><code>$&#123;sys:xxx:-yyy&#125;</code>: With default</li>
</ul>
</li>
<li>Environment Lookup: <code>$&#123;env:xxx&#125;</code>
<ul>
<li><code>$&#123;env:xxx:-yyy&#125;</code>: With default</li>
</ul>
</li>
</ul>
<h4 id="2135-spi"><a class="markdownIt-Anchor" href="#2135-spi"></a> 2.1.3.5 SPI</h4>
<p>Path: <code>META-INF/org/apache/logging/log4j/core/config/plugins/Log4j2Plugins.dat</code></p>
<h3 id="214-issues"><a class="markdownIt-Anchor" href="#214-issues"></a> 2.1.4 Issues</h3>
<h4 id="2141-no-appenders-are-available-for-asyncappender"><a class="markdownIt-Anchor" href="#2141-no-appenders-are-available-for-asyncappender"></a> 2.1.4.1 No appenders are available for AsyncAppender</h4>
<p>Generally, AsyncAppender relies on one or more Appenders, but if the initializations of these dependencies failed, this exception may occur. Possible reasons are:</p>
<ul>
<li><code>RollingRandomAccessFile</code> has no permission to perform write operation, like create directory and file.</li>
</ul>
<h4 id="2142-binding-to-log4j-1-unexpectedly"><a class="markdownIt-Anchor" href="#2142-binding-to-log4j-1-unexpectedly"></a> 2.1.4.2 Binding to log4j-1 Unexpectedly</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">log4j:WARN Please initialize the log4j system properly.</span><br><span class="line">log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.</span><br><span class="line">log4j:WARN No appenders could be found for logger (org.apache.hadoop.util.Shell).</span><br></pre></td></tr></table></figure>
<p>Maybe you don’t exclude all log4j-1’s dependency in your project, like:</p>
<ul>
<li><code>org.slf4j:slf4j-reload4j</code></li>
<li><code>ch.qos.reload4j:reload4j</code></li>
</ul>
<h2 id="22-logback"><a class="markdownIt-Anchor" href="#22-logback"></a> 2.2 Logback</h2>
<h3 id="221-maven"><a class="markdownIt-Anchor" href="#221-maven"></a> 2.2.1 Maven</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SLF4J API --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Logback Classic --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;logback.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Logback Core --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;logback.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="222-demo"><a class="markdownIt-Anchor" href="#222-demo"></a> 2.2.2 Demo</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">-scan:当此属性设置为true时，配置文件如果发生改变，将会被重新加载，默认值为true</span></span><br><span class="line"><span class="comment">-scanPeriod:设置监测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认单位是毫秒</span></span><br><span class="line"><span class="comment">-           当scan为true时，此属性生效。默认的时间间隔为1分钟</span></span><br><span class="line"><span class="comment">-de<span class="doctag">bug:</span>当此属性设置为true时，将打印出logback内部日志信息，实时查看logback运行状态。默认值为false</span></span><br><span class="line"><span class="comment">-</span></span><br><span class="line"><span class="comment">- configuration 子节点为 appender、logger、root</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;60 second&quot;</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 负责写日志,控制台日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- 一是把日志信息转换成字节数组,二是把字节数组写入到输出流 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%5level] [%thread] %logger&#123;0&#125; %msg%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 文件日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.FileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>debug.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- append: true,日志被追加到文件结尾; false,清空现存文件;默认是true --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">append</span>&gt;</span>true<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- LevelFilter: 级别过滤器，根据日志级别进行过滤 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>DEBUG<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%5level] [%thread] %logger&#123;0&#125; %msg%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 滚动记录文件，先将日志记录到指定文件，当符合某个条件时，将日志记录到其他文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;INFO&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">File</span>&gt;</span>info.log<span class="tag">&lt;/<span class="name">File</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- ThresholdFilter:临界值过滤器，过滤掉 TRACE 和 DEBUG 级别的日志 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%5level] [%thread] %logger&#123;0&#125; %msg%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 每天生成一个日志文件，保存30天的日志文件</span></span><br><span class="line"><span class="comment">            - 如果隔一段时间没有输出日志，前面过期的日志不会被删除，只有再重新打印日志的时候，会触发删除过期日志的操作</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>info.%d&#123;yyyy-MM-dd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TimeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TimeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    &lt;/appender &gt;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--&lt;!– 异常日志输出 –&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;appender name=&quot;EXCEPTION&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;file&gt;exception.log&lt;/file&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;!– 求值过滤器，评估、鉴别日志是否符合指定条件. 需要额外的两个JAR包，commons-compiler.jar和janino.jar –&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;filter class=&quot;ch.qos.logback.core.filter.EvaluatorFilter&quot;&gt;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;!– 默认为 ch.qos.logback.classic.boolex.JaninoEventEvaluator –&gt;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;evaluator&gt;--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--&lt;!– 过滤掉所有日志消息中不包含&quot;Exception&quot;字符串的日志 –&gt;--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--&lt;expression&gt;return message.contains(&quot;Exception&quot;);&lt;/expression&gt;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;/evaluator&gt;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;OnMatch&gt;ACCEPT&lt;/OnMatch&gt;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;OnMismatch&gt;DENY&lt;/OnMismatch&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;/filter&gt;--&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!--&lt;triggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;!– 触发节点，按固定文件大小生成，超过5M，生成新的日志文件 –&gt;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;maxFileSize&gt;5MB&lt;/maxFileSize&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;/triggeringPolicy&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;/appender&gt;--&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;ERROR&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%5level] [%thread] %logger&#123;0&#125; %msg%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- 按照固定窗口模式生成日志文件，当文件大于20MB时，生成新的日志文件</span></span><br><span class="line"><span class="comment">        -    窗口大小是1到3，当保存了3个归档文件后，将覆盖最早的日志</span></span><br><span class="line"><span class="comment">        -    可以指定文件压缩选项</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.FixedWindowRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>error.%d&#123;yyyy-MM&#125;(%i).log.zip<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">minIndex</span>&gt;</span>1<span class="tag">&lt;/<span class="name">minIndex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxIndex</span>&gt;</span>3<span class="tag">&lt;/<span class="name">maxIndex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 异步输出 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span> =<span class="string">&quot;ASYNC&quot;</span> <span class="attr">class</span>= <span class="string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 不丢失日志.默认的,如果队列的80%已满,则会丢弃TRACT、DEBUG、INFO级别的日志 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discardingThreshold</span> &gt;</span>0<span class="tag">&lt;/<span class="name">discardingThreshold</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 更改默认的队列的深度,该值会影响性能.默认值为256 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">queueSize</span>&gt;</span>512<span class="tag">&lt;/<span class="name">queueSize</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 添加附加的appender,最多只能添加一个 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span> =<span class="string">&quot;ERROR&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    - 1.name：包名或类名，用来指定受此logger约束的某一个包或者具体的某一个类</span></span><br><span class="line"><span class="comment">    - 2.未设置打印级别，所以继承他的上级&lt;root&gt;的日志级别“DEBUG”</span></span><br><span class="line"><span class="comment">    - 3.未设置additivity，默认为true，将此logger的打印信息向上级传递</span></span><br><span class="line"><span class="comment">    - 4.未设置appender，此logger本身不打印任何信息，级别为“DEBUG”及大于“DEBUG”的日志信息传递给root</span></span><br><span class="line"><span class="comment">    -  root接到下级传递的信息，交给已经配置好的名为“STDOUT”的appender处理，“STDOUT”appender将信息打印到控制台</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;ch.qos.logback&quot;</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    - 1.将级别为“INFO”及大于“INFO”的日志信息交给此logger指定的名为“STDOUT”的appender处理，在控制台中打出日志</span></span><br><span class="line"><span class="comment">    -   不再向次logger的上级 &lt;logger name=&quot;logback&quot;/&gt; 传递打印信息</span></span><br><span class="line"><span class="comment">    - 2.level：设置打印级别（TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF），还有一个特殊值INHERITED或者同义词NULL，代表强制执行上级的级别</span></span><br><span class="line"><span class="comment">    -        如果未设置此属性，那么当前logger将会继承上级的级别</span></span><br><span class="line"><span class="comment">    - 3.additivity：为false，表示此logger的打印信息不再向上级传递,如果设置为true，会打印两次</span></span><br><span class="line"><span class="comment">    - 4.appender-ref：指定了名字为&quot;STDOUT&quot;的appender</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.weizhi.common.LogMain&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;appender-ref ref=&quot;DEBUG&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;appender-ref ref=&quot;EXCEPTION&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;appender-ref ref=&quot;INFO&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;appender-ref ref=&quot;ERROR&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ASYNC&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    - 根logger</span></span><br><span class="line"><span class="comment">    - level:设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF，不能设置为INHERITED或者同义词NULL</span></span><br><span class="line"><span class="comment">    -       默认是DEBUG</span></span><br><span class="line"><span class="comment">    -appender-ref:可以包含零个或多个&lt;appender-ref&gt;元素，标识这个appender将会添加到这个logger</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;appender-ref ref=&quot;DEBUG&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;appender-ref ref=&quot;EXCEPTION&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;appender-ref ref=&quot;INFO&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ASYNC&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="223-tips"><a class="markdownIt-Anchor" href="#223-tips"></a> 2.2.3 Tips</h3>
<h4 id="2231-颜色"><a class="markdownIt-Anchor" href="#2231-颜色"></a> 2.2.3.1 <a target="_blank" rel="noopener" href="http://logback.qos.ch/manual/layouts.html#coloring">颜色</a></h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">withJansi</span>&gt;</span>true<span class="tag">&lt;/<span class="name">withJansi</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>[%thread] %highlight(%-5level) %cyan(%logger&#123;15&#125;) - %msg %n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2232-work-with-unit-test"><a class="markdownIt-Anchor" href="#2232-work-with-unit-test"></a> 2.2.3.2 Work with Unit Test</h4>
<p>在<code>test/resources</code>目录下添加<code>logback-test.xml</code>文件即可生效</p>
<h4 id="2233-spring集成"><a class="markdownIt-Anchor" href="#2233-spring集成"></a> 2.2.3.3 Spring集成</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入外部属性文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">&quot;org/springframework/boot/logging/logback/defaults.xml&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 依据profile选择性配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;local, ci&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">           ...</span><br><span class="line">        <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;!local, !ci&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;ROLLINGFILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ROLLINGFILE&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2234-spring-boot默认的配置"><a class="markdownIt-Anchor" href="#2234-spring-boot默认的配置"></a> 2.2.3.4 Spring-Boot默认的配置</h4>
<p><strong>参考<code>org.springframework.boot.logging.logback.DefaultLogbackConfiguration</code></strong></p>
<p><strong>相关配置项参考<code>spring-configuration-metadata.json</code></strong></p>
<ul>
<li><code>logging.pattern.console</code>：默认的<code>console pattern</code>配置</li>
<li><code>logging.config</code>：用于指定<code>spring</code>加载的<code>logback</code>配置文件</li>
</ul>
<h4 id="2235-关于asyncappender阻塞的问题"><a class="markdownIt-Anchor" href="#2235-关于asyncappender阻塞的问题"></a> 2.2.3.5 关于AsyncAppender阻塞的问题</h4>
<p><code>AsyncAppender</code>会异步打印日志，从而避免磁盘<code>IO</code>阻塞当前线程的业务逻辑，其异步的实现方式也是常规的<code>ThreadPool</code>+<code>BlockingQueue</code>，那么当线程池与队列都被打满时，其行为是如何的？</p>
<p>直接上源码，起点是<code>ch.qos.logback.classic.Logger</code>，所有的日志方法都会收敛到<code>filterAndLog_0_Or3Plus</code>、<code>filterAndLog_1</code>、<code>filterAndLog_2</code>这三个方法上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">filterAndLog_1</span><span class="params">(<span class="keyword">final</span> String localFQCN, <span class="keyword">final</span> Marker marker, <span class="keyword">final</span> Level level, <span class="keyword">final</span> String msg, <span class="keyword">final</span> Object param, <span class="keyword">final</span> Throwable t)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">FilterReply</span> <span class="variable">decision</span> <span class="operator">=</span> loggerContext.getTurboFilterChainDecision_1(marker, <span class="built_in">this</span>, level, msg, param, t);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (decision == FilterReply.NEUTRAL) &#123;</span><br><span class="line">        <span class="keyword">if</span> (effectiveLevelInt &gt; level.levelInt) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (decision == FilterReply.DENY) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildLoggingEventAndAppend(localFQCN, marker, level, msg, <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; param &#125;, t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">filterAndLog_2</span><span class="params">(<span class="keyword">final</span> String localFQCN, <span class="keyword">final</span> Marker marker, <span class="keyword">final</span> Level level, <span class="keyword">final</span> String msg, <span class="keyword">final</span> Object param1, <span class="keyword">final</span> Object param2,</span></span><br><span class="line"><span class="params">                <span class="keyword">final</span> Throwable t)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">FilterReply</span> <span class="variable">decision</span> <span class="operator">=</span> loggerContext.getTurboFilterChainDecision_2(marker, <span class="built_in">this</span>, level, msg, param1, param2, t);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (decision == FilterReply.NEUTRAL) &#123;</span><br><span class="line">        <span class="keyword">if</span> (effectiveLevelInt &gt; level.levelInt) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (decision == FilterReply.DENY) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildLoggingEventAndAppend(localFQCN, marker, level, msg, <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; param1, param2 &#125;, t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildLoggingEventAndAppend</span><span class="params">(<span class="keyword">final</span> String localFQCN, <span class="keyword">final</span> Marker marker, <span class="keyword">final</span> Level level, <span class="keyword">final</span> String msg, <span class="keyword">final</span> Object[] params,</span></span><br><span class="line"><span class="params">                <span class="keyword">final</span> Throwable t)</span> &#123;</span><br><span class="line">    <span class="type">LoggingEvent</span> <span class="variable">le</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoggingEvent</span>(localFQCN, <span class="built_in">this</span>, level, msg, t, params);</span><br><span class="line">    le.setMarker(marker);</span><br><span class="line">    callAppenders(le);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">callAppenders</span><span class="params">(ILoggingEvent event)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">writes</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">Logger</span> <span class="variable">l</span> <span class="operator">=</span> <span class="built_in">this</span>; l != <span class="literal">null</span>; l = l.parent) &#123;</span><br><span class="line">        writes += l.appendLoopOnAppenders(event);</span><br><span class="line">        <span class="keyword">if</span> (!l.additive) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// No appenders in hierarchy</span></span><br><span class="line">    <span class="keyword">if</span> (writes == <span class="number">0</span>) &#123;</span><br><span class="line">        loggerContext.noAppenderDefinedWarning(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">appendLoopOnAppenders</span><span class="params">(ILoggingEvent event)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (aai != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> aai.appendLoopOnAppenders(event);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续跟踪<code>AppenderAttachableImpl</code>的<code>appendLoopOnAppenders</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">appendLoopOnAppenders</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">final</span> Appender&lt;E&gt;[] appenderArray = appenderList.asTypedArray();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> appenderArray.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        appenderArray[i].doAppend(e);</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果<code>Appender</code>是<code>AsyncAppender</code>，那么继续跟踪<code>UnsynchronizedAppenderBase</code>的<code>doAppend</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAppend</span><span class="params">(E eventObject)</span> &#123;</span><br><span class="line">    <span class="comment">// WARNING: The guard check MUST be the first statement in the</span></span><br><span class="line">    <span class="comment">// doAppend() method.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// prevent re-entry.</span></span><br><span class="line">    <span class="keyword">if</span> (Boolean.TRUE.equals(guard.get())) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        guard.set(Boolean.TRUE);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.started) &#123;</span><br><span class="line">            <span class="keyword">if</span> (statusRepeatCount++ &lt; ALLOWED_REPEATS) &#123;</span><br><span class="line">                addStatus(<span class="keyword">new</span> <span class="title class_">WarnStatus</span>(<span class="string">&quot;Attempted to append to non started appender [&quot;</span> + name + <span class="string">&quot;].&quot;</span>, <span class="built_in">this</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (getFilterChainDecision(eventObject) == FilterReply.DENY) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ok, we now invoke derived class&#x27; implementation of append</span></span><br><span class="line">        <span class="built_in">this</span>.append(eventObject);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (exceptionCount++ &lt; ALLOWED_REPEATS) &#123;</span><br><span class="line">            addError(<span class="string">&quot;Appender [&quot;</span> + name + <span class="string">&quot;] failed to append.&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        guard.set(Boolean.FALSE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续跟踪<code>AsyncAppenderBase</code>的<code>append</code>方法，重点来了，注意第一个if语句</p>
<ul>
<li>条件1：如果当前队列的容量的剩余值小于<code>discardingThreshold</code>，该值默认为队列容量的<code>1/5</code></li>
<li>条件2：如果当前日志事件可以丢弃，对于<code>AsyncAppender</code>来说，<code>INFO</code>以下的日志是可以丢弃的</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">append</span><span class="params">(E eventObject)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isQueueBelowDiscardingThreshold() &amp;&amp; isDiscardable(eventObject)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    preprocess(eventObject);</span><br><span class="line">    put(eventObject);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isQueueBelowDiscardingThreshold</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (blockingQueue.remainingCapacity() &lt; discardingThreshold);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 省略无关代码...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (discardingThreshold == UNDEFINED)</span><br><span class="line">        discardingThreshold = queueSize / <span class="number">5</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 省略无关代码...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>AsyncAppender</code>的<code>isDiscardable</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isDiscardable</span><span class="params">(ILoggingEvent event)</span> &#123;</span><br><span class="line">    <span class="type">Level</span> <span class="variable">level</span> <span class="operator">=</span> event.getLevel();</span><br><span class="line">    <span class="keyword">return</span> level.toInt() &lt;= Level.INFO_INT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>总结：根据上面的分析可以发现，如果打日志的并发度非常高，且打的是<code>WARN</code>或<code>ERROR</code>日志，仍然会阻塞当前线程</strong></p>
<h3 id="224-参考"><a class="markdownIt-Anchor" href="#224-参考"></a> 2.2.4 参考</h3>
<ul>
<li><a target="_blank" rel="noopener" href="http://logback.qos.ch/manual/">官方文档（很详细）</a></li>
<li><a target="_blank" rel="noopener" href="http://www.importnew.com/22290.html">从零开始玩转logback</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/warking/p/5710303.html">logback的使用和logback.xml详解</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/1ded57f6c4e3">logback 配置详解</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/36743386/accessing-the-application-properties-in-logback-xml">在logback中使用spring的属性值</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/yangzl2008/article/details/81503579">SLF4J与Logback、Log4j1、Log4j2、JCL、J.U.L是如何关联使用的</a></li>
<li><a target="_blank" rel="noopener" href="http://logback.qos.ch/manual/layouts.html">layout官方文档</a></li>
</ul>
<h2 id="23-tips"><a class="markdownIt-Anchor" href="#23-tips"></a> 2.3 Tips</h2>
<h3 id="231-how-to-make-sure-there-is-only-one-logging-implementation"><a class="markdownIt-Anchor" href="#231-how-to-make-sure-there-is-only-one-logging-implementation"></a> 2.3.1 How to make sure there is only one logging implementation</h3>
<p>Use <code>mvn dependency:tree</code> to check dependencies:</p>
<ul>
<li><code>log4j</code>:
<ul>
<li><code>log4j:log4j</code></li>
</ul>
</li>
<li><code>log4j2</code>:
<ul>
<li><code>org.apache.logging.log4j:*</code></li>
</ul>
</li>
<li><code>logback</code>:
<ul>
<li><code>ch.qos.logback:*</code></li>
</ul>
</li>
<li><code>reload4j</code>:
<ul>
<li><code>org.slf4j:slf4j-reload4j</code></li>
<li><code>ch.qos.reload4j:reload4j</code></li>
</ul>
</li>
</ul>
<h1 id="3-test"><a class="markdownIt-Anchor" href="#3-test"></a> 3 Test</h1>
<h2 id="31-easymock"><a class="markdownIt-Anchor" href="#31-easymock"></a> 3.1 EasyMock</h2>
<p><code>mock</code>测试就是在测试过程中，对于某些不容易构造或者不容易获取的对象，<strong>用一个虚拟的对象（不要被虚拟误导，就是Java对象，虚拟描述的是这个对象的行为）来创建以便测试的测试方法</strong></p>
<p>真实对象具有不可确定的行为，产生不可预测的效果，（如：股票行情，天气预报）真实对象很难被创建的真实对象的某些行为很难被触发真实对象实际上还不存在的（和其他开发小组或者和新的硬件打交道）等等</p>
<p>使用一个接口来描述这个对象。在产品代码中实现这个接口，在测试代码中实现这个接口，在被测试代码中只是通过接口来引用对象，所以它不知道这个引用的对象是真实对象，还是<code>mock</code>对象</p>
<h3 id="311-示例"><a class="markdownIt-Anchor" href="#311-示例"></a> 3.1.1 示例</h3>
<p>该示例的目的并不是教你如何去用<code>mock</code>进行测试，而是给出<code>mock</code>对象的创建过程以及它的行为</p>
<ol>
<li>首先创建<code>Mock</code>对象，即代理对象</li>
<li>设定<code>EasyMock</code>的相应逻辑，即打桩</li>
<li>调用<code>mock</code>对象的相应逻辑</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Human</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isMale</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestEasyMock</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Human</span> <span class="variable">mock</span> <span class="operator">=</span> EasyMock.createMock(Human.class);</span><br><span class="line"></span><br><span class="line">        EasyMock.expect(mock.isMale(<span class="string">&quot;Bob&quot;</span>)).andReturn(<span class="literal">true</span>);</span><br><span class="line">        EasyMock.expect(mock.isMale(<span class="string">&quot;Alice&quot;</span>)).andReturn(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        EasyMock.replay(mock);</span><br><span class="line"></span><br><span class="line">        System.out.println(mock.isMale(<span class="string">&quot;Bob&quot;</span>));</span><br><span class="line">        System.out.println(mock.isMale(<span class="string">&quot;Alice&quot;</span>));</span><br><span class="line">        System.out.println(mock.isMale(<span class="string">&quot;Robot&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下是输出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line">java.lang.AssertionError: </span><br><span class="line">  Unexpected method call Human.isMale(<span class="string">&quot;Robot&quot;</span>):</span><br><span class="line">    at org.easymock.internal.MockInvocationHandler.invoke(MockInvocationHandler.java:<span class="number">44</span>)</span><br><span class="line">    at org.easymock.internal.ObjectMethodsFilter.invoke(ObjectMethodsFilter.java:<span class="number">85</span>)</span><br><span class="line">Disconnected from the target VM, address: <span class="string">&#x27;127.0.0.1:59825&#x27;</span>, transport: <span class="string">&#x27;socket&#x27;</span></span><br><span class="line">    at org.liuyehcf.easymock.$Proxy0.isMale(Unknown Source)</span><br><span class="line">    at org.liuyehcf.easymock.TestEasyMock.main(TestEasyMock.java:<span class="number">28</span>)</span><br></pre></td></tr></table></figure>
<p>输出的结果很有意思，在<code>EasyMock.replay(mock)</code>语句之前用两个<code>EasyMock.expect</code>设定了<code>Bob</code>和<code>Alice</code>的预期结果，因此结果符合设定；而<code>Robot</code>并没有设定，因此抛出异常</p>
<p>接下来我们将分析以下上述例子中所涉及到的源码，解开<code>mock</code>神秘的面纱</p>
<h3 id="312-源码详解"><a class="markdownIt-Anchor" href="#312-源码详解"></a> 3.1.2 源码详解</h3>
<p>首先来看一下静态方法<code>EasyMock.createMock</code>，该方法返回一个<code>Mock</code>对象(给定接口的实例)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a mock object that implements the given interface, order checking</span></span><br><span class="line"><span class="comment"> * is disabled by default.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> *            the interface that the mock object should implement.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> toMock</span></span><br><span class="line"><span class="comment"> *            the class of the interface that the mock object should</span></span><br><span class="line"><span class="comment"> *            implement.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the mock object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">createMock</span><span class="params">(<span class="keyword">final</span> Class&lt;T&gt; toMock)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> createControl().createMock(toMock);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>createMock</code>是<code>IMocksControl</code>接口的方法。该方法接受<code>Class</code>对象，并返回<code>Class</code>对象所代表类型的实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a mock object that implements the given interface.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> *            the interface or class that the mock object should</span></span><br><span class="line"><span class="comment"> *            implement/extend.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> toMock</span></span><br><span class="line"><span class="comment"> *            the interface or class that the mock object should</span></span><br><span class="line"><span class="comment"> *            implement/extend.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the mock object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&lt;T&gt; T <span class="title function_">createMock</span><span class="params">(Class&lt;T&gt; toMock)</span>;</span><br></pre></td></tr></table></figure>
<p>了解了<code>createMock</code>接口定义后，我们来看看具体的实现(<code>MocksControl#createMock</code>)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">createMock</span><span class="params">(<span class="keyword">final</span> Class&lt;T&gt; toMock)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        state.assertRecordState();</span><br><span class="line">        <span class="comment">//创建一个代理工厂</span></span><br><span class="line">        <span class="keyword">final</span> IProxyFactory&lt;T&gt; proxyFactory = createProxyFactory(toMock);</span><br><span class="line">        <span class="comment">//利用工厂产生代理类的对象</span></span><br><span class="line">        <span class="keyword">return</span> proxyFactory.createProxy(toMock, <span class="keyword">new</span> <span class="title class_">ObjectMethodsFilter</span>(toMock,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">MockInvocationHandler</span>(<span class="built_in">this</span>), <span class="literal">null</span>));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> RuntimeExceptionWrapper e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> (RuntimeException) e.getRuntimeException().fillInStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>IProxyFactory</code>接口有两个实现，<code>JavaProxyFactory</code>（<code>JDK</code>动态代理）和<code>ClassProxyFactory</code>（<code>Cglib</code>）。我们以<code>JavaProxyFactory</code>为例进行讲解，动态代理的实现不是本篇博客的重点。下面给出<code>JavaProxyFactory#createProxy</code>方法的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">createProxy</span><span class="params">(<span class="keyword">final</span> Class&lt;T&gt; toMock, <span class="keyword">final</span> InvocationHandler handler)</span> &#123;</span><br><span class="line">    <span class="comment">//就是简单调用了JDK动态代理的接口，没有任何难度</span></span><br><span class="line">    <span class="keyword">return</span> (T) Proxy.newProxyInstance(toMock.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; toMock &#125;, handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们再来回顾一下上述例子中的代码，我们发现一个很奇怪的现象。在<code>EasyMock.replay</code>方法前后，调用<code>mock.isMale</code>所产生的行为是不同的。<strong>在这里<code>EasyMock.replay</code>类似于一个开关</strong>，可以改变<code>mock</code>对象的行为。可是这是如何做到的呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这里调用mock的isMale方法不会抛出异常</span></span><br><span class="line">EasyMock.expect(mock.isMale(<span class="string">&quot;Bob&quot;</span>)).andReturn(<span class="literal">true</span>);</span><br><span class="line">EasyMock.expect(mock.isMale(<span class="string">&quot;Alice&quot;</span>)).andReturn(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//关键开关语句</span></span><br><span class="line">EasyMock.replay(mock);</span><br><span class="line"></span><br><span class="line"><span class="comment">//这里只能调用上面预定义行为的方法，若没有设定预期值那么将抛出异常</span></span><br><span class="line">System.out.println(mock.isMale(<span class="string">&quot;Bob&quot;</span>));</span><br><span class="line">System.out.println(mock.isMale(<span class="string">&quot;Alice&quot;</span>));</span><br><span class="line">System.out.println(mock.isMale(<span class="string">&quot;Robot&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>生成代理对象的方法分析(<code>IMocksControl#createMock</code>)我们先暂时放在一边，我们现在先来跟踪一下<code>EasyMock.replay</code>方法的执行逻辑。源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Switches the given mock objects (more exactly: the controls of the mock</span></span><br><span class="line"><span class="comment"> * objects) to replay mode. For details, see the EasyMock documentation.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mocks</span></span><br><span class="line"><span class="comment"> *            the mock objects.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">replay</span><span class="params">(<span class="keyword">final</span> Object... mocks)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">final</span> Object mock : mocks) &#123;</span><br><span class="line">        <span class="comment">//依次对每个mock对象执行下面的逻辑</span></span><br><span class="line">        getControl(mock).replay();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>源码的官方注释中提到，该方法用于切换<code>mock</code>对象的控制模式。再来看下<code>EasyMock.getControl</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> MocksControl <span class="title function_">getControl</span><span class="params">(<span class="keyword">final</span> Object mock)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ClassExtensionHelper.getControl(mock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> MocksControl <span class="title function_">getControl</span><span class="params">(<span class="keyword">final</span> Object mock)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ObjectMethodsFilter handler;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//mock是由JDK动态代理产生的类型的实例</span></span><br><span class="line">        <span class="keyword">if</span> (Proxy.isProxyClass(mock.getClass())) &#123;</span><br><span class="line">            handler = (ObjectMethodsFilter) Proxy.getInvocationHandler(mock);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//mock是由Cglib产生的类型的实例</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (Enhancer.isEnhanced(mock.getClass())) &#123;</span><br><span class="line">            handler = (ObjectMethodsFilter) getInterceptor(mock).getHandler();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Not a mock: &quot;</span> + mock.getClass().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取ObjectMethodsFilter封装的MockInvocationHandler的实例，并从MockInvocationHandler的实例中获取MocksControl的实例</span></span><br><span class="line">        <span class="keyword">return</span> handler.getDelegate().getControl();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> ClassCastException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Not a mock: &quot;</span> + mock.getClass().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意到<code>ObjectMethodsFilter</code>是<code>InvocationHandler</code>接口的实现，而<code>ObjectMethodsFilter</code>内部（<code>delegate</code>字段）又封装了一个<code>InvocationHandler</code>接口的实现，其类型是<code>MockInvocationHandler</code>。下面给出<code>MockInvocationHandler</code>的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MockInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span>, Serializable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">7799769066534714634L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//非常重要的字段，直接决定了下面invoke方法的行为</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MocksControl control;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注意到构造方法接受了MocksControl作为参数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MockInvocationHandler</span><span class="params">(<span class="keyword">final</span> MocksControl control)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.control = control;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(<span class="keyword">final</span> Object proxy, <span class="keyword">final</span> Method method, <span class="keyword">final</span> Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//如果是记录模式</span></span><br><span class="line">            <span class="keyword">if</span> (control.getState() <span class="keyword">instanceof</span> RecordState) &#123;</span><br><span class="line">                LastControl.reportLastControl(control);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> control.getState().invoke(<span class="keyword">new</span> <span class="title class_">Invocation</span>(proxy, method, args));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> RuntimeExceptionWrapper e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e.getRuntimeException().fillInStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> AssertionErrorWrapper e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e.getAssertionError().fillInStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> ThrowableWrapper t) &#123;</span><br><span class="line">            <span class="keyword">throw</span> t.getThrowable().fillInStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//then let all unwrapped exceptions pass unmodified</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MocksControl <span class="title function_">getControl</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> control;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再回到<code>EasyMock.replay</code>方法中，<code>getControl(mock)</code>方法返回后调用<code>MocksControl#replay</code>方法，下面给出<code>MocksControl#replay</code>的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">replay</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        state.replay();</span><br><span class="line">        <span class="comment">//替换state，将之前收集到的行为(behavior)作为参数传给ReplayState的构造方法</span></span><br><span class="line">        state = <span class="keyword">new</span> <span class="title class_">ReplayState</span>(behavior);</span><br><span class="line">        LastControl.reportLastControl(<span class="literal">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> RuntimeExceptionWrapper e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> (RuntimeException) e.getRuntimeException().fillInStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就是为什么调用<code>EasyMock.replay</code>前后<code>mock</code>对象的行为会发生变化的原因。可以这样理解，如果<code>state</code>是<code>RecordState</code>时，调用<code>mock</code>的方法将会记录行为；如果<code>state</code>是<code>ReplayState</code>时，调用<code>mock</code>的方法将会从之前记录的行为中进行查找，如果找到了则调用，如果没有则抛出异常</p>
<p><code>EasyMock</code>的源码就分析到这里，日后再细究<code>ReplayState</code>与<code>RecordState</code>的源码</p>
<h1 id="4-lombok"><a class="markdownIt-Anchor" href="#4-lombok"></a> 4 Lombok</h1>
<h2 id="41-overview"><a class="markdownIt-Anchor" href="#41-overview"></a> 4.1 Overview</h2>
<p><strong>lombok中常用的注解</strong></p>
<ol>
<li><code>@AllArgsConstructor</code></li>
<li><code>@NoArgsConstructor</code></li>
<li><code>@RequiredArgsConstructor</code></li>
<li><code>@Builder</code></li>
<li><code>@Getter</code></li>
<li><code>@Setter</code></li>
<li><code>@Data</code></li>
<li><code>@ToString</code></li>
<li><code>@EqualsAndHashCode</code></li>
<li><code>@Singular</code></li>
<li><code>@Slf4j</code></li>
</ol>
<p><strong>原理：<code>lombok</code>注解都是<code>编译期</code>注解，<code>编译期</code>注解最大的魅力就是能够干预编译器的行为，相关技术就是<code>JSR-269</code></strong>。我在另一篇博客中详细介绍了<code>JSR-269</code>的相关原理以及接口的使用方式，并且实现了类似<code>lombok</code>的<code>@Builder</code>注解。<strong>对原理部分感兴趣的话，请移步<a href="/2018/02/02/Java-JSR-269-%E6%8F%92%E5%85%A5%E5%BC%8F%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/" title="Java-JSR-269-插入式注解处理器">Java-JSR-269-插入式注解处理器</a></strong></p>
<h2 id="42-构造方法"><a class="markdownIt-Anchor" href="#42-构造方法"></a> 4.2 构造方法</h2>
<p><code>lombok</code>提供了3个注解，用于创建构造方法，它们分别是</p>
<ol>
<li><strong><code>@AllArgsConstructor</code></strong>：<code>@AllArgsConstructor</code>会生成一个全量的构造方法，包括所有的字段（非<code>final</code>字段以及未在定义处初始化的<code>final</code>字段）</li>
<li><strong><code>@NoArgsConstructor</code></strong>：<code>@NoArgsConstructor</code>会生成一个无参构造方法（当然，不允许类中含有未在定义处初始化的<code>final</code>字段）</li>
<li><strong><code>@RequiredArgsConstructor</code></strong>：<code>@RequiredArgsConstructor</code>会生成一个仅包含必要参数的构造方法，什么是必要参数呢？就是那些未在定义处初始化的<code>final</code>字段</li>
</ol>
<h2 id="43-builder"><a class="markdownIt-Anchor" href="#43-builder"></a> 4.3 @Builder</h2>
<p><strong><code>@Builder</code>是我最爱的lombok注解，没有之一</strong>。通常我们在业务代码中，时时刻刻都会用到数据传输对象（<code>DTO</code>），例如，我们调用一个<code>RPC</code>接口，需要传入一个<code>DTO</code>，代码通常是这样的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首先构造DTO对象</span></span><br><span class="line"><span class="type">XxxDTO</span> <span class="variable">xxxDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XxxDTO</span>();</span><br><span class="line">xxxDTO.setPro1(...);</span><br><span class="line">xxxDTO.setPro2(...);</span><br><span class="line">...</span><br><span class="line">xxxDTO.setPron(...);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 然后调用接口</span></span><br><span class="line">rpcService.doSomething(xxxDTO);</span><br></pre></td></tr></table></figure>
<p>其实，上述代码中的<code>xxxDTO</code>对象的创建以及赋值的过程，仅与<code>rpcService</code>有关，但是从肉眼来看，这确确实实又是两部分，我们无法快速确定<code>xxxDTO</code>对象只在<code>rpcService.doSomething</code>方法中用到。显然，这个代码片段最核心的部分就是<code>rpcService.doSomething</code>方法调用，<strong>而上面这种写法使得核心代码淹没在非核心代码中</strong></p>
<p>借助<code>lombok</code>的<code>@Builder</code>注解，我们便可以这样重构上面这段代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rpcService.doSomething(</span><br><span class="line">    XxxDTO.builder()</span><br><span class="line">        .setPro1(...)</span><br><span class="line">        .setPro2(...)</span><br><span class="line">        ...</span><br><span class="line">        .setPron(...)</span><br><span class="line">        .build()</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>这样一来，由于<code>XxxDTO</code>的实例仅在<code>rpcService.doSomething</code>方法中用到，我们就把创建的步骤放到方法参数里面去完成，代码更内聚了。<strong>通过这种方式，业务流程的脉络将会更清晰地展现出来，而不至于淹没在一大堆<code>set</code>方法的调用之中</strong></p>
<h3 id="431-使用方式"><a class="markdownIt-Anchor" href="#431-使用方式"></a> 4.3.1 使用方式</h3>
<p>如果是一个简单的<code>DTO</code>，<strong>那么直接在类上方标记<code>@Builder</code>注解，同时需要提供一个全参构造方法</strong>，<code>lombok</code>就会在编译期为该类创建一个<code>建造者模式</code>的静态内部类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseCarDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Double width;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double weight;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BaseCarDTO</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BaseCarDTO</span><span class="params">(Double width, Double length, Double weight)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">        <span class="built_in">this</span>.length = length;</span><br><span class="line">        <span class="built_in">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(Double width)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getLength</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLength</span><span class="params">(Double length)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.length = length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getWeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWeight</span><span class="params">(Double weight)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将编译后的<code>.class</code>文件反编译得到的<code>.java</code>文件如下。可以很清楚的看到，多了一个静态内部类，且采用了建造者模式，这也是<code>@Builder</code>注解名称的由来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseCarDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Double width;</span><br><span class="line">    <span class="keyword">private</span> Double length;</span><br><span class="line">    <span class="keyword">private</span> Double weight;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BaseCarDTO</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BaseCarDTO</span><span class="params">(Double width, Double length, Double weight)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">        <span class="built_in">this</span>.length = length;</span><br><span class="line">        <span class="built_in">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(Double width)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getLength</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLength</span><span class="params">(Double length)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.length = length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getWeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWeight</span><span class="params">(Double weight)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BaseCarDTO.BaseCarDTOBuilder <span class="title function_">builder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BaseCarDTO</span>.BaseCarDTOBuilder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BaseCarDTOBuilder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> Double width;</span><br><span class="line">        <span class="keyword">private</span> Double length;</span><br><span class="line">        <span class="keyword">private</span> Double weight;</span><br><span class="line"></span><br><span class="line">        BaseCarDTOBuilder() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> BaseCarDTO.BaseCarDTOBuilder <span class="title function_">width</span><span class="params">(Double width)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.width = width;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> BaseCarDTO.BaseCarDTOBuilder <span class="title function_">length</span><span class="params">(Double length)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.length = length;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> BaseCarDTO.BaseCarDTOBuilder <span class="title function_">weight</span><span class="params">(Double weight)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.weight = weight;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> BaseCarDTO <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BaseCarDTO</span>(<span class="built_in">this</span>.width, <span class="built_in">this</span>.length, <span class="built_in">this</span>.weight);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;BaseCarDTO.BaseCarDTOBuilder(width=&quot;</span> + <span class="built_in">this</span>.width + <span class="string">&quot;, length=&quot;</span> + <span class="built_in">this</span>.length + <span class="string">&quot;, weight=&quot;</span> + <span class="built_in">this</span>.weight + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="432-具有继承关系的dto"><a class="markdownIt-Anchor" href="#432-具有继承关系的dto"></a> 4.3.2 具有继承关系的DTO</h3>
<p>我们来考虑一种更特殊的情况，假设有两个<code>DTO</code>，一个是<code>TruckDTO</code>，另一个是<code>BaseCarDTO</code>。<code>TruckDTO</code>继承了<code>BaseCarDTO</code>。其中<code>BaseCarDTO</code>与<code>TruckDTO</code>如下</p>
<ul>
<li>我们需要在<code>@Builder</code>注解指定<code>builderMethodName</code>属性，区分一下两个静态方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseCarDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Double width;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double weight;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BaseCarDTO</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BaseCarDTO</span><span class="params">(Double width, Double length, Double weight)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">        <span class="built_in">this</span>.length = length;</span><br><span class="line">        <span class="built_in">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(Double width)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getLength</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLength</span><span class="params">(Double length)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.length = length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getWeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWeight</span><span class="params">(Double weight)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder(builderMethodName = &quot;trunkBuilder&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrunkDTO</span> <span class="keyword">extends</span> <span class="title class_">BaseCarDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Double volume;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TrunkDTO</span><span class="params">(Double volume)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.volume = volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getVolume</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(Double volume)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.volume = volume;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们来看一下<code>TrunkDTO</code>编译得到的<code>.class</code>文件经过反编译得到的<code>.java</code>文件的样子，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrunkDTO</span> <span class="keyword">extends</span> <span class="title class_">BaseCarDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Double volume;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TrunkDTO</span><span class="params">(Double volume)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.volume = volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getVolume</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(Double volume)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.volume = volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TrunkDTO.TrunkDTOBuilder <span class="title function_">trunkBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TrunkDTO</span>.TrunkDTOBuilder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TrunkDTOBuilder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> Double volume;</span><br><span class="line"></span><br><span class="line">        TrunkDTOBuilder() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> TrunkDTO.TrunkDTOBuilder <span class="title function_">volume</span><span class="params">(Double volume)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.volume = volume;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> TrunkDTO <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TrunkDTO</span>(<span class="built_in">this</span>.volume);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;TrunkDTO.TrunkDTOBuilder(volume=&quot;</span> + <span class="built_in">this</span>.volume + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，这个内部类<code>TrunkDTOBuilder</code>仅包含了子类<code>TrunkDTO</code>的字段，而不包含父类<code>BaseCarDTO</code>的字段</p>
<p>那么，我们如何让<code>TrunkDTOBuilder</code>也包含父类的字段呢？答案就是，我们需要将<code>@Builder</code>注解标记在构造方法处，构造方法包含多少字段，那么这个静态内部类就包含多少个字段，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrunkDTO</span> <span class="keyword">extends</span> <span class="title class_">BaseCarDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Double volume;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Builder(builderMethodName = &quot;trunkBuilder&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TrunkDTO</span><span class="params">(Double width, Double length, Double weight, Double volume)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(width, length, weight);</span><br><span class="line">        <span class="built_in">this</span>.volume = volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getVolume</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(Double volume)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.volume = volume;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述<code>TrunkDTO</code>编译得到的<code>.class</code>文件经过反编译得到的<code>.java</code>文件如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrunkDTO</span> <span class="keyword">extends</span> <span class="title class_">BaseCarDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Double volume;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TrunkDTO</span><span class="params">(Double width, Double length, Double weight, Double volume)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(width, length, weight);</span><br><span class="line">        <span class="built_in">this</span>.volume = volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getVolume</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(Double volume)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.volume = volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TrunkDTO.TrunkDTOBuilder <span class="title function_">trunkBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TrunkDTO</span>.TrunkDTOBuilder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TrunkDTOBuilder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> Double width;</span><br><span class="line">        <span class="keyword">private</span> Double length;</span><br><span class="line">        <span class="keyword">private</span> Double weight;</span><br><span class="line">        <span class="keyword">private</span> Double volume;</span><br><span class="line"></span><br><span class="line">        TrunkDTOBuilder() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> TrunkDTO.TrunkDTOBuilder <span class="title function_">width</span><span class="params">(Double width)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.width = width;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> TrunkDTO.TrunkDTOBuilder <span class="title function_">length</span><span class="params">(Double length)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.length = length;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> TrunkDTO.TrunkDTOBuilder <span class="title function_">weight</span><span class="params">(Double weight)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.weight = weight;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> TrunkDTO.TrunkDTOBuilder <span class="title function_">volume</span><span class="params">(Double volume)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.volume = volume;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> TrunkDTO <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TrunkDTO</span>(<span class="built_in">this</span>.width, <span class="built_in">this</span>.length, <span class="built_in">this</span>.weight, <span class="built_in">this</span>.volume);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;TrunkDTO.TrunkDTOBuilder(width=&quot;</span> + <span class="built_in">this</span>.width + <span class="string">&quot;, length=&quot;</span> + <span class="built_in">this</span>.length + <span class="string">&quot;, weight=&quot;</span> + <span class="built_in">this</span>.weight + <span class="string">&quot;, volume=&quot;</span> + <span class="built_in">this</span>.volume + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="433-初始值"><a class="markdownIt-Anchor" href="#433-初始值"></a> 4.3.3 初始值</h3>
<p>仅靠<code>@Builder</code>注解，那么生成的静态内部类是不会处理初始值的，如果我们要让静态内部类处理初始值，那么就需要在相关的字段上标记<code>@Builder.Default</code>注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseCarDTO</span> &#123;</span><br><span class="line">    <span class="meta">@Builder</span>.Default</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Double</span> <span class="variable">width</span> <span class="operator">=</span> <span class="number">5.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double weight;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BaseCarDTO</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BaseCarDTO</span><span class="params">(Double width, Double length, Double weight)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">        <span class="built_in">this</span>.length = length;</span><br><span class="line">        <span class="built_in">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(Double width)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getLength</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLength</span><span class="params">(Double length)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.length = length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getWeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWeight</span><span class="params">(Double weight)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意，字段在被<code>@Builder.Default</code>修饰后，生成class文件中是没有初始值的，这是个大坑！</strong></p>
<h3 id="434-equalsandhashcode"><a class="markdownIt-Anchor" href="#434-equalsandhashcode"></a> 4.3.4 @EqualsAndHashCode</h3>
<p><code>@EqualsAndHashCode</code>注解用于创建<code>Object</code>的<code>hashCode</code>方法以及<code>equals</code>方法，同样地，如果一个<code>DTO</code>包含父类，那么最平凡的<code>@EqualsAndHashCode</code>注解不会考虑父类包含的字段。<strong>因此如果子类的<code>hashCode</code>方法以及<code>equals</code>方法需要考虑父类的字段，那么需要将<code>@EqualsAndHashCode</code>注解的<code>callSuper</code>属性设置为<code>true</code>，这样就会调用父类的同名方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseCarDTO</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Double</span> <span class="variable">width</span> <span class="operator">=</span> <span class="number">5.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double weight;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(Double width)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getLength</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLength</span><span class="params">(Double length)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.length = length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getWeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWeight</span><span class="params">(Double weight)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrunkDTO</span> <span class="keyword">extends</span> <span class="title class_">BaseCarDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Double volume;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getVolume</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(Double volume)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.volume = volume;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述<code>TrunkDTO</code>编译得到的<code>.class</code>文件经过反编译得到的<code>.java</code>文件如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrunkDTO</span> <span class="keyword">extends</span> <span class="title class_">BaseCarDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Double volume;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TrunkDTO</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getVolume</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(Double volume)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.volume = volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="built_in">this</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> TrunkDTO)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">TrunkDTO</span> <span class="variable">other</span> <span class="operator">=</span> (TrunkDTO)o;</span><br><span class="line">            <span class="keyword">if</span> (!other.canEqual(<span class="built_in">this</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">super</span>.equals(o)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">this$volume</span> <span class="operator">=</span> <span class="built_in">this</span>.getVolume();</span><br><span class="line">                <span class="type">Object</span> <span class="variable">other$volume</span> <span class="operator">=</span> other.getVolume();</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>$volume == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (other$volume != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">this</span>$volume.equals(other$volume)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">canEqual</span><span class="params">(Object other)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> other <span class="keyword">instanceof</span> TrunkDTO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">PRIME</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> result * <span class="number">59</span> + <span class="built_in">super</span>.hashCode();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">$volume</span> <span class="operator">=</span> <span class="built_in">this</span>.getVolume();</span><br><span class="line">        result = result * <span class="number">59</span> + ($volume == <span class="literal">null</span> ? <span class="number">43</span> : $volume.hashCode());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="44-gettersetter"><a class="markdownIt-Anchor" href="#44-gettersetter"></a> 4.4 @Getter/@Setter</h2>
<p><code>@Getter</code>以及<code>@Setter</code>注解用于为字段创建<code>getter</code>方法以及<code>setter</code>方法</p>
<h2 id="45-tostring"><a class="markdownIt-Anchor" href="#45-tostring"></a> 4.5 @ToString</h2>
<p><code>@ToString</code>注解用于创建<code>Object</code>的<code>toString</code>方法</p>
<h2 id="46-data"><a class="markdownIt-Anchor" href="#46-data"></a> 4.6 @Data</h2>
<p><code>Data</code>注解包含了<code>@Getter</code>、<code>@Setter</code>、<code>@RequiredArgsConstructor</code>、<code>@ToString</code>以及<code>@EqualsAndHashCode</code>、的功能</p>
<h2 id="47-slf4j"><a class="markdownIt-Anchor" href="#47-slf4j"></a> 4.7 @Slf4j</h2>
<p><code>@Slf4j</code>注解用于生成一个<code>log</code>字段，可以指定参数<code>topic</code>的值，其值代表<code>loggerName</code></p>
<p><code>@Slf4j(topic = &quot;error&quot;)</code>等效于下面这段代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> org.slf4j.<span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> org.slf4j.LoggerFactory.getLogger(<span class="string">&quot;error&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="48-tips"><a class="markdownIt-Anchor" href="#48-tips"></a> 4.8 Tips</h2>
<h3 id="481-java16编译失败"><a class="markdownIt-Anchor" href="#481-java16编译失败"></a> 4.8.1 java16编译失败</h3>
<p>若编译器版本是<code>java16</code>的话，编译使用了<code>lombok</code>的项目会出现如下的错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fatal error compiling: java.lang.ExceptionInInitializerError: Unable to make field private com.sun.tools.javac.processing.JavacProcessingEnvironment$DiscoveredProcessors com.sun.tools.javac.processing.JavacProcessingEnvironment.discoveredProcs accessible: module jdk.compiler does not &quot;opens com.sun.tools.javac.processing&quot; to unnamed module</span><br></pre></td></tr></table></figure>
<p>解决方式：安装低版本的<code>java</code>，比如<code>java8</code>，设置<code>JAVA_HOME</code>环境变量用于指定<code>java</code>版本</p>
<h1 id="5-mina"><a class="markdownIt-Anchor" href="#5-mina"></a> 5 Mina</h1>
<p><code>Mina</code>是一个<code>Java</code>版本的<code>ssh-lib</code></p>
<h2 id="51-maven依赖"><a class="markdownIt-Anchor" href="#51-maven依赖"></a> 5.1 Maven依赖</h2>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mina --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.sshd<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sshd-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.sshd<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sshd-sftp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- jsch --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.55<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- java native hook --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.1stleg<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jnativehook<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>其中</strong></p>
<ol>
<li><code>jsch</code>是另一个<code>ssh-client</code>库</li>
<li><code>jnativehook</code>用于捕获键盘的输入，如果仅用<code>Java</code>标准输入，则无法捕获类似<code>ctrl + c</code>这样的按键组合</li>
</ol>
<h2 id="52-demo"><a class="markdownIt-Anchor" href="#52-demo"></a> 5.2 Demo</h2>
<h3 id="521-basedemo"><a class="markdownIt-Anchor" href="#521-basedemo"></a> 5.2.1 BaseDemo</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.liuyehcf.mina;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.jnativehook.GlobalScreen;</span><br><span class="line"><span class="keyword">import</span> org.jnativehook.keyboard.NativeKeyEvent;</span><br><span class="line"><span class="keyword">import</span> org.jnativehook.keyboard.NativeKeyListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PipedInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PipedOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Level;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hechenfeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/12/20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">EXECUTOR</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PIPE_STREAM_BUFFER_SIZE</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">PipedInputStream</span> <span class="variable">sshClientInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PipedInputStream</span>(PIPE_STREAM_BUFFER_SIZE);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">PipedOutputStream</span> <span class="variable">sshClientOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PipedOutputStream</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">PipedInputStream</span> <span class="variable">bizInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PipedInputStream</span>(PIPE_STREAM_BUFFER_SIZE);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">PipedOutputStream</span> <span class="variable">bizOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PipedOutputStream</span>();</span><br><span class="line"></span><br><span class="line">    BaseDemo() <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        sshClientInputStream.connect(bizOutputStream);</span><br><span class="line">        sshClientOutputStream.connect(bizInputStream);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">beginRead</span><span class="params">()</span> &#123;</span><br><span class="line">        EXECUTOR.execute(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10240</span>];</span><br><span class="line">            <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">readNum</span> <span class="operator">=</span> bizInputStream.read(buffer);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">final</span> <span class="type">byte</span>[] actualBytes = <span class="keyword">new</span> <span class="title class_">byte</span>[readNum];</span><br><span class="line">                    System.arraycopy(buffer, <span class="number">0</span>, actualBytes, <span class="number">0</span>, readNum);</span><br><span class="line"></span><br><span class="line">                    writeAndFlush(actualBytes);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">beginWriteJnativehook</span><span class="params">()</span> &#123;</span><br><span class="line">        EXECUTOR.execute(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(GlobalScreen.class.getPackage().getName());</span><br><span class="line">                logger.setLevel(Level.OFF);</span><br><span class="line">                GlobalScreen.registerNativeHook();</span><br><span class="line">                GlobalScreen.addNativeKeyListener(<span class="keyword">new</span> <span class="title class_">NativeKeyListener</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">nativeKeyTyped</span><span class="params">(NativeKeyEvent nativeKeyEvent)</span> &#123;</span><br><span class="line">                        <span class="type">byte</span> <span class="variable">keyCode</span> <span class="operator">=</span> (<span class="type">byte</span>) nativeKeyEvent.getKeyChar();</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            bizOutputStream.write(keyCode);</span><br><span class="line">                            bizOutputStream.flush();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">nativeKeyPressed</span><span class="params">(NativeKeyEvent nativeKeyEvent)</span> &#123;</span><br><span class="line">                        <span class="comment">// default</span></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">nativeKeyReleased</span><span class="params">(NativeKeyEvent nativeKeyEvent)</span> &#123;</span><br><span class="line">                        <span class="comment">// default</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">beginWriteStd</span><span class="params">()</span> &#123;</span><br><span class="line">        EXECUTOR.execute(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">                <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">command</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line"></span><br><span class="line">                    bizOutputStream.write((command + <span class="string">&quot;\n&quot;</span>).getBytes());</span><br><span class="line">                    bizOutputStream.flush();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeAndFlush</span><span class="params">(<span class="type">byte</span>[] bytes)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (System.out) &#123;</span><br><span class="line">            System.out.write(bytes);</span><br><span class="line">            System.out.flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="522-minasshdemo"><a class="markdownIt-Anchor" href="#522-minasshdemo"></a> 5.2.2 MinaSshDemo</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.liuyehcf.mina;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.sshd.client.SshClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.sshd.client.channel.ChannelShell;</span><br><span class="line"><span class="keyword">import</span> org.apache.sshd.client.channel.ClientChannelEvent;</span><br><span class="line"><span class="keyword">import</span> org.apache.sshd.client.future.ConnectFuture;</span><br><span class="line"><span class="keyword">import</span> org.apache.sshd.client.session.ClientSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.sshd.common.util.io.NoCloseInputStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.sshd.common.util.io.NoCloseOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hechenfeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/12/20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinaSshDemo</span> <span class="keyword">extends</span> <span class="title class_">BaseDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">MinaSshDemo</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MinaSshDemo</span>().boot();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">boot</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SshClient</span> <span class="variable">client</span> <span class="operator">=</span> SshClient.setUpDefaultClient();</span><br><span class="line">        client.start();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ConnectFuture</span> <span class="variable">connect</span> <span class="operator">=</span> client.connect(<span class="string">&quot;HCF&quot;</span>, <span class="string">&quot;localhost&quot;</span>, <span class="number">22</span>);</span><br><span class="line">        connect.await(<span class="number">5000L</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ClientSession</span> <span class="variable">session</span> <span class="operator">=</span> connect.getSession();</span><br><span class="line">        session.addPasswordIdentity(<span class="string">&quot;???&quot;</span>);</span><br><span class="line">        session.auth().verify(<span class="number">5000L</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ChannelShell</span> <span class="variable">channel</span> <span class="operator">=</span> session.createShellChannel();</span><br><span class="line">        channel.setIn(<span class="keyword">new</span> <span class="title class_">NoCloseInputStream</span>(sshClientInputStream));</span><br><span class="line">        channel.setOut(<span class="keyword">new</span> <span class="title class_">NoCloseOutputStream</span>(sshClientOutputStream));</span><br><span class="line">        channel.setErr(<span class="keyword">new</span> <span class="title class_">NoCloseOutputStream</span>(sshClientOutputStream));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解决颜色显示以及中文乱码的问题</span></span><br><span class="line">        channel.setPtyType(<span class="string">&quot;xterm-256color&quot;</span>);</span><br><span class="line">        channel.setEnv(<span class="string">&quot;LANG&quot;</span>, <span class="string">&quot;zh_CN.UTF-8&quot;</span>);</span><br><span class="line">        channel.open();</span><br><span class="line"></span><br><span class="line">        beginRead();</span><br><span class="line"><span class="comment">//        beginWriteJnativehook();</span></span><br><span class="line">        beginWriteStd();</span><br><span class="line"></span><br><span class="line">        channel.waitFor(Collections.singleton(ClientChannelEvent.CLOSED), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="523-jschsshdemo"><a class="markdownIt-Anchor" href="#523-jschsshdemo"></a> 5.2.3 JschSshDemo</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.liuyehcf.mina;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcraft.jsch.ChannelShell;</span><br><span class="line"><span class="keyword">import</span> com.jcraft.jsch.JSch;</span><br><span class="line"><span class="keyword">import</span> com.jcraft.jsch.Session;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hechenfeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/12/20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JschSshDemo</span> <span class="keyword">extends</span> <span class="title class_">BaseDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">JschSshDemo</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">JschSshDemo</span>().boot();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">boot</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JSch</span> <span class="variable">jsch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSch</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> jsch.getSession(<span class="string">&quot;HCF&quot;</span>, <span class="string">&quot;localhost&quot;</span>, <span class="number">22</span>);</span><br><span class="line">        java.util.<span class="type">Properties</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.util.Properties();</span><br><span class="line">        config.put(<span class="string">&quot;StrictHostKeyChecking&quot;</span>, <span class="string">&quot;no&quot;</span>);</span><br><span class="line">        session.setConfig(config);</span><br><span class="line">        session.setPassword(<span class="string">&quot;???&quot;</span>);</span><br><span class="line">        session.connect();</span><br><span class="line"></span><br><span class="line">        <span class="type">ChannelShell</span> <span class="variable">channel</span> <span class="operator">=</span> (ChannelShell) session.openChannel(<span class="string">&quot;shell&quot;</span>);</span><br><span class="line">        channel.setInputStream(sshClientInputStream);</span><br><span class="line">        channel.setOutputStream(sshClientOutputStream);</span><br><span class="line">        channel.connect();</span><br><span class="line"></span><br><span class="line">        beginRead();</span><br><span class="line">        beginWriteJnativehook();</span><br><span class="line"><span class="comment">//        beginWriteStd();</span></span><br><span class="line"></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1000000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="53-修改idletimeout"><a class="markdownIt-Anchor" href="#53-修改idletimeout"></a> 5.3 修改IdleTimeOut</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;FactoryManager&gt; factoryManagerClass = FactoryManager.class;</span><br><span class="line"></span><br><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> factoryManagerClass.getField(<span class="string">&quot;DEFAULT_IDLE_TIMEOUT&quot;</span>);</span><br><span class="line"><span class="type">Field</span> <span class="variable">modifiersField</span> <span class="operator">=</span> Field.class.getDeclaredField(<span class="string">&quot;modifiers&quot;</span>);</span><br><span class="line">modifiersField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">modifiersField.setInt(field, field.getModifiers() &amp; ~Modifier.FINAL);</span><br><span class="line"></span><br><span class="line">field.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">field.set(<span class="literal">null</span>, TimeUnit.SECONDS.toMillis(config.getIdleIntervalFrontend()));</span><br></pre></td></tr></table></figure>
<h2 id="54-修复显示异常的问题"><a class="markdownIt-Anchor" href="#54-修复显示异常的问题"></a> 5.4 修复显示异常的问题</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stty</span> cols 190 &amp;&amp; <span class="built_in">stty</span> rows 21 &amp;&amp; <span class="built_in">export</span> TERM=xterm-256color &amp;&amp; bash</span><br></pre></td></tr></table></figure>
<h2 id="55-参考"><a class="markdownIt-Anchor" href="#55-参考"></a> 5.5 参考</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/apache/mina-sshd">mina-sshd</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kwhat/jnativehook">jnativehook</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/tabactivity/article/details/50726353">Java 反射修改 final 属性值</a></li>
</ul>
<h1 id="6-sonarqube"><a class="markdownIt-Anchor" href="#6-sonarqube"></a> 6 SonarQube</h1>
<p><a target="_blank" rel="noopener" href="https://docs.sonarqube.org/latest/setup/get-started-2-minutes/">Quick-Start</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name sonarqube -e SONAR_ES_BOOTSTRAP_CHECKS_DISABLE=<span class="literal">true</span> -p 9000:9000 sonarqube:latest</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner-for-maven/">SonarScanner for Maven</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean verify sonar:sonar -DskipTests -Dsonar.login=admin -Dsonar.password=xxxx</span><br></pre></td></tr></table></figure>
<h1 id="7-swagger"><a class="markdownIt-Anchor" href="#7-swagger"></a> 7 Swagger</h1>
<p>下面给一个示例</p>
<h2 id="71-环境"><a class="markdownIt-Anchor" href="#71-环境"></a> 7.1 环境</h2>
<ol>
<li><code>IDEA</code></li>
<li><code>Maven3.3.9</code></li>
<li><code>Spring Boot</code></li>
<li><code>Swagger</code></li>
</ol>
<h2 id="72-demo工程目录结构"><a class="markdownIt-Anchor" href="#72-demo工程目录结构"></a> 7.2 Demo工程目录结构</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── pom.xml</span><br><span class="line">├── src</span><br><span class="line">│   └── main</span><br><span class="line">│       └── java</span><br><span class="line">│           └── org</span><br><span class="line">│               └── liuyehcf</span><br><span class="line">│                   └── swagger</span><br><span class="line">│                       ├── UserApplication.java</span><br><span class="line">│                       ├── config</span><br><span class="line">│                       │   └── SwaggerConfig.java</span><br><span class="line">│                       ├── controller</span><br><span class="line">│                       │   └── UserController.java</span><br><span class="line">│                       └── entity</span><br><span class="line">│                           └── User.java</span><br></pre></td></tr></table></figure>
<h2 id="73-pom文件"><a class="markdownIt-Anchor" href="#73-pom文件"></a> 7.3 pom文件</h2>
<p>引入<code>Spring-boot</code>以及<code>Swagger</code>的依赖即可，完整内容如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.liuyehcf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>org.liuyehcf.swagger.UserApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="74-swagger-config-bean"><a class="markdownIt-Anchor" href="#74-swagger-config-bean"></a> 7.4 Swagger Config Bean</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.liuyehcf.swagger.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;org.liuyehcf.swagger&quot;</span>)) <span class="comment">//包路径</span></span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;Spring Boot - Swagger - Demo&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;THIS IS A SWAGGER DEMO&quot;</span>)</span><br><span class="line">                .termsOfServiceUrl(<span class="string">&quot;http://liuyehcf.github.io&quot;</span>) <span class="comment">//这个不知道干嘛的</span></span><br><span class="line">                .contact(<span class="string">&quot;liuye&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0.0&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><code>@Configuration</code>：让<code>Spring</code>来加载该类配置</li>
<li><code>@EnableSwagger2</code>：启用<code>Swagger2</code></li>
</ol>
<ul>
<li>注意替换<code>.apis(RequestHandlerSelectors.basePackage(&quot;org.liuyehcf.swagger&quot;))</code>这句中的包路径</li>
</ul>
<h2 id="75-controller"><a class="markdownIt-Anchor" href="#75-controller"></a> 7.5 Controller</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.liuyehcf.swagger.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiImplicitParam;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiImplicitParams;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> org.liuyehcf.swagger.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Integer, User&gt; userMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;GET_USER_API_1&quot;, notes = &quot;获取User方式1&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;getApi1/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserByIdAndName1</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(name = &quot;id&quot;, value = &quot;用户id&quot;, required = true)</span> <span class="meta">@PathVariable</span> <span class="type">int</span> id,</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(name = &quot;name&quot;, value = &quot;用户名字&quot;, required = true)</span> <span class="meta">@RequestParam</span> String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (userMap.containsKey(id)) &#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMap.get(id);</span><br><span class="line">            <span class="keyword">if</span> (user.getName().equals(name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> user;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;GET_USER_API_2&quot;, notes = &quot;获取User方式2&quot;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;id&quot;, value = &quot;用户id&quot;, required = true, paramType = &quot;path&quot;, dataType = &quot;int&quot;),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;name&quot;, value = &quot;用户名字&quot;, required = true, paramType = &quot;query&quot;, dataType = &quot;String&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;getApi2/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserByIdAndName2</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> <span class="type">int</span> id,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam</span> String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (userMap.containsKey(id)) &#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMap.get(id);</span><br><span class="line">            <span class="keyword">if</span> (user.getName().equals(name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> user;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;ADD_USER_API_1&quot;, notes = &quot;增加User方式1&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/addUser1&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addUser1</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(name = &quot;user&quot;, value = &quot;用户User&quot;, required = true)</span> <span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (userMap.containsKey(user.getId())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;failure&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        userMap.put(user.getId(), user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;ADD_USER_API_2&quot;, notes = &quot;增加User方式2&quot;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;user&quot;, value = &quot;用户User&quot;, required = true, paramType = &quot;body&quot;, dataType = &quot;User&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/addUser2&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addUser2</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (userMap.containsKey(user.getId())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;failure&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        userMap.put(user.getId(), user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们通过<code>@ApiOperation</code>注解来给<code>API</code>增加说明、通过<code>@ApiParam</code>、<code>@ApiImplicitParams</code>、<code>@ApiImplicitParam</code>注解来给参数增加说明（<strong>其实不加这些注解，<code>API</code>文档也能生成，只不过描述主要来源于函数等命名产生，对用户并不友好，我们通常需要自己增加一些说明来丰富文档内容</strong>）</p>
<ul>
<li><code>@ApiImplicitParam</code>最好指明<code>paramType</code>与<code>dataType</code>属性。<code>paramType</code>可以是<code>path</code>、<code>query</code>、<code>body</code></li>
<li><code>@ApiParam</code>没有<code>paramType</code>与<code>dataType</code>属性，因为该注解可以从参数（参数类型及其<code>Spring MVC</code>注解）中获取这些信息</li>
</ul>
<h3 id="751-user"><a class="markdownIt-Anchor" href="#751-user"></a> 7.5.1 User</h3>
<p><code>Controller</code>中用到的实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.liuyehcf.swagger.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddress</span><span class="params">(String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="76-application"><a class="markdownIt-Anchor" href="#76-application"></a> 7.6 Application</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.liuyehcf.swagger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;org.liuyehcf.swagger.*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        SpringApplication.run(UserApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>成功启动后，即可访问<code>http://localhost:8080/swagger-ui.html</code></p>
<h2 id="77-参考"><a class="markdownIt-Anchor" href="#77-参考"></a> 7.7 参考</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8033ef83a8ed">Spring Boot中使用Swagger2构建强大的RESTful API文档</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/blackmambaprogrammer/article/details/72354007">Spring4集成Swagger：真的只需要四步，五分钟速成</a></li>
<li><a target="_blank" rel="noopener" href="https://swagger.io/">Swagger</a></li>
</ul>
<h1 id="8-dom4j"><a class="markdownIt-Anchor" href="#8-dom4j"></a> 8 dom4j</h1>
<p>这里以一个<code>Spring</code>的配置文件为例，通过一个示例来展示<code>Dom4j</code>如何写和读取<code>xml</code>文件</p>
<ol>
<li>由于<code>Spring</code>配置文件的根元素<code>beans</code>需要带上<code>xmlns</code>，所以在添加根元素时需要填上<code>xmlns</code>所对应的<code>url</code></li>
<li>在读取该带有<code>xmlns</code>的配置文件时，需要为<code>SAXReader</code>绑定<code>xmlns</code></li>
<li>在写<code>xPathExpress</code>时，需要带上<code>xmlns</code>前缀</li>
</ol>
<p><strong>代码清单</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.liuyehcf.dom4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.dom4j.Document;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.DocumentException;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.DocumentHelper;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.Element;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.io.OutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.io.SAXReader;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.io.XMLWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dom4jDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILE_PATH</span> <span class="operator">=</span> <span class="string">&quot;dom4j/src/main/resources/sample.xml&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        writeXml();</span><br><span class="line"></span><br><span class="line">        readXml();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeXml</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> DocumentHelper.createDocument();</span><br><span class="line">        doc.addComment(<span class="string">&quot;a simple demo &quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//注意，xmlns只能在创建Element时才能添加，无法通过addAttribute添加xmlns属性</span></span><br><span class="line">        <span class="type">Element</span> <span class="variable">beansElement</span> <span class="operator">=</span> doc.addElement(<span class="string">&quot;beans&quot;</span>, <span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>);</span><br><span class="line">        beansElement.addAttribute(<span class="string">&quot;xmlns:xsi&quot;</span>, <span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>);</span><br><span class="line">        beansElement.addAttribute(<span class="string">&quot;xsi:schemaLocation&quot;</span>, <span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Element</span> <span class="variable">beanElement</span> <span class="operator">=</span> beansElement.addElement(<span class="string">&quot;bean&quot;</span>);</span><br><span class="line">        beanElement.addAttribute(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;sample&quot;</span>);</span><br><span class="line">        beanElement.addAttribute(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;org.liuyehcf.dom4j.Person&quot;</span>);</span><br><span class="line">        beanElement.addComment(<span class="string">&quot;This is comment&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Element</span> <span class="variable">propertyElement</span> <span class="operator">=</span> beanElement.addElement(<span class="string">&quot;property&quot;</span>);</span><br><span class="line">        propertyElement.addAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;nickName&quot;</span>);</span><br><span class="line">        propertyElement.addAttribute(<span class="string">&quot;value&quot;</span>, <span class="string">&quot;liuye&quot;</span>);</span><br><span class="line"></span><br><span class="line">        propertyElement = beanElement.addElement(<span class="string">&quot;property&quot;</span>);</span><br><span class="line">        propertyElement.addAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>);</span><br><span class="line">        propertyElement.addAttribute(<span class="string">&quot;value&quot;</span>, <span class="string">&quot;25&quot;</span>);</span><br><span class="line"></span><br><span class="line">        propertyElement = beanElement.addElement(<span class="string">&quot;property&quot;</span>);</span><br><span class="line">        propertyElement.addAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;country&quot;</span>);</span><br><span class="line">        propertyElement.addAttribute(<span class="string">&quot;value&quot;</span>, <span class="string">&quot;China&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">OutputFormat</span> <span class="variable">format</span> <span class="operator">=</span> OutputFormat.createPrettyPrint();</span><br><span class="line">        <span class="type">XMLWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            writer = <span class="keyword">new</span> <span class="title class_">XMLWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="keyword">new</span> <span class="title class_">File</span>(FILE_PATH)), format);</span><br><span class="line">            writer.write(doc);</span><br><span class="line">            writer.flush();</span><br><span class="line">            writer.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">readXml</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SAXReader</span> <span class="variable">saxReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;xmlns&quot;</span>, <span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>);</span><br><span class="line">        saxReader.getDocumentFactory().setXPathNamespaceURIs(map);</span><br><span class="line"></span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            doc = saxReader.read(<span class="keyword">new</span> <span class="title class_">File</span>(FILE_PATH));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (DocumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> doc.selectNodes(<span class="string">&quot;/beans/xmlns:bean/xmlns:property&quot;</span>);</span><br><span class="line">        System.out.println(list.size());</span><br><span class="line"></span><br><span class="line">        list = doc.selectNodes(<span class="string">&quot;//xmlns:bean/xmlns:property&quot;</span>);</span><br><span class="line">        System.out.println(list.size());</span><br><span class="line"></span><br><span class="line">        list = doc.selectNodes(<span class="string">&quot;/beans/*/xmlns:property&quot;</span>);</span><br><span class="line">        System.out.println(list.size());</span><br><span class="line"></span><br><span class="line">        list = doc.selectNodes(<span class="string">&quot;//xmlns:property&quot;</span>);</span><br><span class="line">        System.out.println(list.size());</span><br><span class="line"></span><br><span class="line">        list = doc.selectNodes(<span class="string">&quot;/beans//xmlns:property&quot;</span>);</span><br><span class="line">        System.out.println(list.size());</span><br><span class="line"></span><br><span class="line">        list = doc.selectNodes(<span class="string">&quot;//xmlns:property/@value=liuye&quot;</span>);</span><br><span class="line">        System.out.println(list.size());</span><br><span class="line"></span><br><span class="line">        list = doc.selectNodes(<span class="string">&quot;//xmlns:property/@*=liuye&quot;</span>);</span><br><span class="line">        System.out.println(list.size());</span><br><span class="line"></span><br><span class="line">        list = doc.selectNodes(<span class="string">&quot;//xmlns:bean|//xmlns:property&quot;</span>);</span><br><span class="line">        System.out.println(list.size());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>生成的xml文件如下</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--a simple demo --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sample&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.liuyehcf.dom4j.Person&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--This is comment--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;nickName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;liuye&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;country&quot;</span> <span class="attr">value</span>=<span class="string">&quot;China&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>输出如下</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">3</span><br><span class="line">3</span><br><span class="line">3</span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<h2 id="81-基本数据结构"><a class="markdownIt-Anchor" href="#81-基本数据结构"></a> 8.1 基本数据结构</h2>
<p>dom4j几乎所有的数据类型都继承自Node接口，下面介绍几个常用的数据类型</p>
<ol>
<li><strong><code>Document</code></strong>：表示整个xml文件</li>
<li><strong><code>Element</code></strong>：元素</li>
<li><strong><code>Attribute</code></strong>：元素的属性</li>
</ol>
<h2 id="82-nodeselectnodes"><a class="markdownIt-Anchor" href="#82-nodeselectnodes"></a> 8.2 Node.selectNodes</h2>
<p>该方法根据<code>xPathExpress</code>来选取节点，<code>xPathExpress</code>的语法规则如下</p>
<ol>
<li><code>&quot;/beans/bean/property&quot;</code>：从跟节点<code>&lt;beans&gt;</code>开始，经过<code>&lt;bean&gt;</code>节点的所有<code>&lt;property&gt;</code>节点</li>
<li><code>&quot;//property&quot;</code>：所有<code>&lt;property&gt;</code>节点</li>
<li>“property”：<strong>当前节点开始</strong>的所有<code>&lt;property&gt;</code>节点</li>
<li><code>&quot;/beans//property&quot;</code>：从根节点<code>&lt;beans&gt;</code>开始，所有所有<code>&lt;property&gt;</code>节点（无论经过几个中间节点）</li>
<li><code>&quot;/beans/bean/property/@value&quot;</code>：从跟节点<code>&lt;beans&gt;</code>开始，经过<code>&lt;bean&gt;</code>节点，包含属性<code>value</code>的所有<code>&lt;property&gt;</code>节点</li>
<li><code>&quot;/beans/bean/property/@value=liuye&quot;</code>：从跟节点<code>&lt;beans&gt;</code>开始，经过<code>&lt;bean&gt;</code>节点，包含属性<code>value</code>且值为<code>liuye</code>的所有<code>&lt;property&gt;</code>节点</li>
<li><code>&quot;/beans/*/property/@*=liuye&quot;</code>：从跟节点<code>&lt;beans&gt;</code>开始，经过任意节点（注意<code>*</code>与<code>//</code>不同，<code>*</code>只匹配一个节点，<code>//</code>匹配任意零或多层节点），包含任意属性且值为<code>liuye</code>的所有<code>&lt;property&gt;</code>节点</li>
</ol>
<ul>
<li>通配符
<ul>
<li><code>*</code>可以匹配任意节点</li>
<li><code>@*</code>可以匹配任意属性</li>
<li><code>|</code>表示或运算</li>
</ul>
</li>
<li><strong>所有以<code>/</code>或者<code>//</code>开始的<code>xPathExpress</code>都与当前节点的位置无关</strong></li>
</ul>
<p><strong>注意，如果<code>xml</code>文件带有<code>xmlns</code>，那么在写<code>xPathExpress</code>时需要带上<code>xmlns</code>前缀，例如示例中那样的写法</strong></p>
<h2 id="83-参考"><a class="markdownIt-Anchor" href="#83-参考"></a> 8.3 参考</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/53ee5835d997">Dom4J解析XML</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ikuman/archive/2012/12/04/2800872.html">dom4j简单实例</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/larry_lv/article/details/6613379">Dom4j为XML文件要结点添加xmlns属性</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/hekaihaw/article/details/54376656">Dom4j中SelectNodes使用方法</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zxcgy/p/6697557.html">dom4j通过 xpath 处理xmlns</a></li>
</ul>
<h1 id="9-cglib"><a class="markdownIt-Anchor" href="#9-cglib"></a> 9 Cglib</h1>
<h1 id="10-jmh"><a class="markdownIt-Anchor" href="#10-jmh"></a> 10 JMH</h1>
<p>比较的序列化框架如下</p>
<ol>
<li><code>fastjson</code></li>
<li><code>kryo</code></li>
<li><code>hessian</code></li>
<li><code>java-builtin</code></li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.liuyehcf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jmh<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openjdk.jmh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jmh-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openjdk.jmh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jmh-generator-annprocess<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.caucho<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hessian<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.51<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.esotericsoftware<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kryo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.62<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.liuyehcf.jmh.serialize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.openjdk.jmh.annotations.*;</span><br><span class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.Runner;</span><br><span class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.options.Options;</span><br><span class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.options.OptionsBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hechenfeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/10/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Warmup(iterations = 5, time = 1, timeUnit = TimeUnit.SECONDS)</span></span><br><span class="line"><span class="meta">@Measurement(iterations = 5, time = 1, timeUnit = TimeUnit.SECONDS)</span></span><br><span class="line"><span class="meta">@Fork(1)</span></span><br><span class="line"><span class="meta">@BenchmarkMode(Mode.AverageTime)</span></span><br><span class="line"><span class="meta">@OutputTimeUnit(TimeUnit.NANOSECONDS)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializerCmp</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, String&gt; MAP_SIZE_1 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, String&gt; MAP_SIZE_10 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, String&gt; MAP_SIZE_100 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1</span>; i++) &#123;</span><br><span class="line">            MAP_SIZE_1.put(UUID.randomUUID().toString(), UUID.randomUUID().toString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            MAP_SIZE_10.put(UUID.randomUUID().toString(), UUID.randomUUID().toString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            MAP_SIZE_100.put(UUID.randomUUID().toString(), UUID.randomUUID().toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">json_size_1</span><span class="params">()</span> &#123;</span><br><span class="line">        CloneUtils.jsonClone(MAP_SIZE_1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">kryo_size_1</span><span class="params">()</span> &#123;</span><br><span class="line">        CloneUtils.kryoClone(MAP_SIZE_1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hessian_size_1</span><span class="params">()</span> &#123;</span><br><span class="line">        CloneUtils.hessianClone(MAP_SIZE_1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">java_size_1</span><span class="params">()</span> &#123;</span><br><span class="line">        CloneUtils.javaClone(MAP_SIZE_1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">json_size_10</span><span class="params">()</span> &#123;</span><br><span class="line">        CloneUtils.jsonClone(MAP_SIZE_10);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">kryo_size_10</span><span class="params">()</span> &#123;</span><br><span class="line">        CloneUtils.kryoClone(MAP_SIZE_10);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hessian_size_10</span><span class="params">()</span> &#123;</span><br><span class="line">        CloneUtils.hessianClone(MAP_SIZE_10);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">java_size_10</span><span class="params">()</span> &#123;</span><br><span class="line">        CloneUtils.javaClone(MAP_SIZE_10);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">json_size_100</span><span class="params">()</span> &#123;</span><br><span class="line">        CloneUtils.jsonClone(MAP_SIZE_100);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">kryo_size_100</span><span class="params">()</span> &#123;</span><br><span class="line">        CloneUtils.kryoClone(MAP_SIZE_100);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hessian_size_100</span><span class="params">()</span> &#123;</span><br><span class="line">        CloneUtils.hessianClone(MAP_SIZE_100);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">java_size_100</span><span class="params">()</span> &#123;</span><br><span class="line">        CloneUtils.javaClone(MAP_SIZE_100);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Options</span> <span class="variable">opt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OptionsBuilder</span>()</span><br><span class="line">                .include(SerializerCmp.class.getSimpleName())</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Runner</span>(opt).run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注解含义解释</strong></p>
<ol>
<li><code>Warmup</code>：配置预热参数
<ul>
<li><code>iterations</code>: 预测执行次数</li>
<li><code>time</code>：每次执行的时间</li>
<li><code>timeUnit</code>：每次执行的时间单位</li>
</ul>
</li>
<li><code>Measurement</code>：配置测试参数
<ul>
<li><code>iterations</code>: 测试执行次数</li>
<li><code>time</code>：每次执行的时间</li>
<li><code>timeUnit</code>：每次执行的时间单位</li>
</ul>
</li>
<li><code>Fork</code>：总共运行几轮</li>
<li><code>BenchmarkMode</code>：衡量的指标，包括平均值，峰值等</li>
<li><code>OutputTimeUnit</code>：输出结果的时间单位</li>
</ol>
<p><strong>输出</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">Benchmark                       Mode  Cnt      Score       Error  Units</span><br><span class="line">SerializerCmp.hessian_size_1    avgt    5   5307.286 ±   327.709  ns/op</span><br><span class="line">SerializerCmp.hessian_size_10   avgt    5   8745.407 ±   248.948  ns/op</span><br><span class="line">SerializerCmp.hessian_size_100  avgt    5  47200.123 ±  2167.454  ns/op</span><br><span class="line">SerializerCmp.java_size_1       avgt    5   4959.845 ±   300.456  ns/op</span><br><span class="line">SerializerCmp.java_size_10      avgt    5  12948.638 ±   229.580  ns/op</span><br><span class="line">SerializerCmp.java_size_100     avgt    5  97033.259 ±  1465.232  ns/op</span><br><span class="line">SerializerCmp.json_size_1       avgt    5    631.037 ±    39.292  ns/op</span><br><span class="line">SerializerCmp.json_size_10      avgt    5   4364.215 ±   740.259  ns/op</span><br><span class="line">SerializerCmp.json_size_100     avgt    5  57205.805 ±  4211.084  ns/op</span><br><span class="line">SerializerCmp.kryo_size_1       avgt    5   1780.679 ±    84.639  ns/op</span><br><span class="line">SerializerCmp.kryo_size_10      avgt    5   5426.511 ±   264.606  ns/op</span><br><span class="line">SerializerCmp.kryo_size_100     avgt    5  48886.075 ± 13722.655  ns/op</span><br></pre></td></tr></table></figure>
<h2 id="101-参考"><a class="markdownIt-Anchor" href="#101-参考"></a> 10.1 参考</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0da2988b9846">JMH: 最装逼，最牛逼的基准测试工具套件</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/09837e2b4408">使用JMH做Java微基准测试</a></li>
</ul>
<h1 id="11-antlr4"><a class="markdownIt-Anchor" href="#11-antlr4"></a> 11 Antlr4</h1>
<p><a target="_blank" rel="noopener" href="https://github.com/antlr/antlr4">ANTLR</a> (ANother Tool for Language Recognition) is a powerful parser generator for reading, processing, executing, or translating structured text or binary files.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/liuyehcf/JavaLearning/tree/master/antlr4/src/main/java/org/liuyehcf/antlr4">Calculator Demo</a></p>
<h1 id="12-httpclient"><a class="markdownIt-Anchor" href="#12-httpclient"></a> 12 httpclient</h1>
<ul>
<li>RetryConfig: <code>new DefaultHttpRequestRetryHandler(3, true)</code>, this can retry for different IP addresses(maybe including both IPv4/IPv6) which DNS server returns</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.byconity.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.DefaultHttpRequestRetryHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.StandardCopyOption;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">download</span><span class="params">(String url, String localPath)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(localPath);</span><br><span class="line">        <span class="type">RequestConfig</span> <span class="variable">requestConfig</span> <span class="operator">=</span></span><br><span class="line">                RequestConfig.custom().setConnectTimeout(<span class="number">5000</span>).setSocketTimeout(<span class="number">5000</span>).build();</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom()</span><br><span class="line">                .setDefaultRequestConfig(requestConfig)</span><br><span class="line">                .setRetryHandler(<span class="keyword">new</span> <span class="title class_">DefaultHttpRequestRetryHandler</span>(<span class="number">3</span>, <span class="literal">true</span>)).build()) &#123;</span><br><span class="line">            <span class="type">HttpGet</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(url);</span><br><span class="line">            <span class="keyword">try</span> (<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(request)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> response.getEntity().getContent();</span><br><span class="line">                    Files.copy(inputStream, path, StandardCopyOption.REPLACE_EXISTING);</span><br><span class="line">                    System.out.println(<span class="string">&quot;File downloaded: &quot;</span> + path);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(</span><br><span class="line">                            <span class="string">&quot;Failed to download file. HTTP Status: &quot;</span> + response.getStatusLine()</span><br><span class="line">                                    .getStatusCode());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag"># 原创</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/18/Ubuntu-Trial/" rel="prev" title="Ubuntu-Trial">
      <i class="fa fa-chevron-left"></i> Ubuntu-Trial
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/07/10/LLVM-JIT/" rel="next" title="LLVM-JIT">
      LLVM-JIT <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-livere">livere</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane livere" id="comment-livere">
              
  <div class="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC8zMzY0My8xMDE5OA=="></div>
  </div>
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-frequently-used-utils"><span class="nav-text"> 1 Frequently-Used-Utils</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-slf4j"><span class="nav-text"> 2 SLF4J</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#21-log4j2"><span class="nav-text"> 2.1 log4j2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#211-maven"><span class="nav-text"> 2.1.1 Maven</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#212-demo"><span class="nav-text"> 2.1.2 Demo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#213-tips"><span class="nav-text"> 2.1.3 Tips</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2131-command-line-options"><span class="nav-text"> 2.1.3.1 Command-Line Options</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2132-logger-name-pattern"><span class="nav-text"> 2.1.3.2 Logger Name Pattern</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2133-color-configuration"><span class="nav-text"> 2.1.3.3 Color Configuration</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2134-lookups"><span class="nav-text"> 2.1.3.4 Lookups</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2135-spi"><span class="nav-text"> 2.1.3.5 SPI</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#214-issues"><span class="nav-text"> 2.1.4 Issues</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2141-no-appenders-are-available-for-asyncappender"><span class="nav-text"> 2.1.4.1 No appenders are available for AsyncAppender</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2142-binding-to-log4j-1-unexpectedly"><span class="nav-text"> 2.1.4.2 Binding to log4j-1 Unexpectedly</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-logback"><span class="nav-text"> 2.2 Logback</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#221-maven"><span class="nav-text"> 2.2.1 Maven</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#222-demo"><span class="nav-text"> 2.2.2 Demo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#223-tips"><span class="nav-text"> 2.2.3 Tips</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2231-%E9%A2%9C%E8%89%B2"><span class="nav-text"> 2.2.3.1 颜色</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2232-work-with-unit-test"><span class="nav-text"> 2.2.3.2 Work with Unit Test</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2233-spring%E9%9B%86%E6%88%90"><span class="nav-text"> 2.2.3.3 Spring集成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2234-spring-boot%E9%BB%98%E8%AE%A4%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-text"> 2.2.3.4 Spring-Boot默认的配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2235-%E5%85%B3%E4%BA%8Easyncappender%E9%98%BB%E5%A1%9E%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text"> 2.2.3.5 关于AsyncAppender阻塞的问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#224-%E5%8F%82%E8%80%83"><span class="nav-text"> 2.2.4 参考</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#23-tips"><span class="nav-text"> 2.3 Tips</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#231-how-to-make-sure-there-is-only-one-logging-implementation"><span class="nav-text"> 2.3.1 How to make sure there is only one logging implementation</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-test"><span class="nav-text"> 3 Test</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#31-easymock"><span class="nav-text"> 3.1 EasyMock</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#311-%E7%A4%BA%E4%BE%8B"><span class="nav-text"> 3.1.1 示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#312-%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3"><span class="nav-text"> 3.1.2 源码详解</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-lombok"><span class="nav-text"> 4 Lombok</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#41-overview"><span class="nav-text"> 4.1 Overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#42-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="nav-text"> 4.2 构造方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#43-builder"><span class="nav-text"> 4.3 @Builder</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#431-%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-text"> 4.3.1 使用方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#432-%E5%85%B7%E6%9C%89%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB%E7%9A%84dto"><span class="nav-text"> 4.3.2 具有继承关系的DTO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#433-%E5%88%9D%E5%A7%8B%E5%80%BC"><span class="nav-text"> 4.3.3 初始值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#434-equalsandhashcode"><span class="nav-text"> 4.3.4 @EqualsAndHashCode</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#44-gettersetter"><span class="nav-text"> 4.4 @Getter&#x2F;@Setter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#45-tostring"><span class="nav-text"> 4.5 @ToString</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#46-data"><span class="nav-text"> 4.6 @Data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#47-slf4j"><span class="nav-text"> 4.7 @Slf4j</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#48-tips"><span class="nav-text"> 4.8 Tips</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#481-java16%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5"><span class="nav-text"> 4.8.1 java16编译失败</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-mina"><span class="nav-text"> 5 Mina</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#51-maven%E4%BE%9D%E8%B5%96"><span class="nav-text"> 5.1 Maven依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#52-demo"><span class="nav-text"> 5.2 Demo</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#521-basedemo"><span class="nav-text"> 5.2.1 BaseDemo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#522-minasshdemo"><span class="nav-text"> 5.2.2 MinaSshDemo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#523-jschsshdemo"><span class="nav-text"> 5.2.3 JschSshDemo</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#53-%E4%BF%AE%E6%94%B9idletimeout"><span class="nav-text"> 5.3 修改IdleTimeOut</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#54-%E4%BF%AE%E5%A4%8D%E6%98%BE%E7%A4%BA%E5%BC%82%E5%B8%B8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text"> 5.4 修复显示异常的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#55-%E5%8F%82%E8%80%83"><span class="nav-text"> 5.5 参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-sonarqube"><span class="nav-text"> 6 SonarQube</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-swagger"><span class="nav-text"> 7 Swagger</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#71-%E7%8E%AF%E5%A2%83"><span class="nav-text"> 7.1 环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#72-demo%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-text"> 7.2 Demo工程目录结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#73-pom%E6%96%87%E4%BB%B6"><span class="nav-text"> 7.3 pom文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#74-swagger-config-bean"><span class="nav-text"> 7.4 Swagger Config Bean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#75-controller"><span class="nav-text"> 7.5 Controller</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#751-user"><span class="nav-text"> 7.5.1 User</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#76-application"><span class="nav-text"> 7.6 Application</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#77-%E5%8F%82%E8%80%83"><span class="nav-text"> 7.7 参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-dom4j"><span class="nav-text"> 8 dom4j</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#81-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-text"> 8.1 基本数据结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#82-nodeselectnodes"><span class="nav-text"> 8.2 Node.selectNodes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#83-%E5%8F%82%E8%80%83"><span class="nav-text"> 8.3 参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-cglib"><span class="nav-text"> 9 Cglib</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-jmh"><span class="nav-text"> 10 JMH</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#101-%E5%8F%82%E8%80%83"><span class="nav-text"> 10.1 参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-antlr4"><span class="nav-text"> 11 Antlr4</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12-httpclient"><span class="nav-text"> 12 httpclient</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Liuyehcf"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Liuyehcf</p>
  <div class="site-description" itemprop="description">大音希声，大象无形</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">285</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liuyehcf</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'qhEhLuMeMOy1zgcBhkqUS6P8-gzGzoHsz',
      appKey     : 'uhkruDLNLNdL5rQjRBY2X9Ke',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
